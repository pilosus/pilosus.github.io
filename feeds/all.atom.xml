<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Vitaly's Technical Blog</title><link href="https://blog.pilosus.org/" rel="alternate"></link><link href="https://blog.pilosus.org/feeds/all.atom.xml" rel="self"></link><id>https://blog.pilosus.org/</id><updated>2020-01-24T21:35:00+03:00</updated><entry><title>Python logging: why printf-style string formatting may be better than f-strings</title><link href="https://blog.pilosus.org/posts/2020/01/24/python-f-strings-in-logging/" rel="alternate"></link><published>2020-01-24T09:10:00+03:00</published><updated>2020-01-24T21:35:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2020-01-24:/posts/2020/01/24/python-f-strings-in-logging/</id><summary type="html">&lt;p class="first last"&gt;Python logging module provides optimizations when %-formatting is&amp;nbsp;used&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Python provides more than one way to format strings: &lt;a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting"&gt;%-formatting&lt;/a&gt;,
&lt;a class="reference external" href="https://docs.python.org/3/library/string.html#formatstrings"&gt;str.format()&lt;/a&gt;, &lt;a class="reference external" href="https://docs.python.org/3/library/string.html#formatstrings"&gt;string.Template&lt;/a&gt; and &lt;a class="reference external" href="https://www.python.org/dev/peps/pep-0498/"&gt;f-strings&lt;/a&gt;.  What format
developers use is the matter of personal aesthetic reasons rather than
anything else. Still there are use cases where good old printf-style
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;%-formatting&lt;/span&gt;&lt;/tt&gt; may have advantages over other formats. Python&amp;#8217;s
&lt;a class="reference external" href="https://docs.python.org/3/library/logging.html"&gt;logging&lt;/a&gt; module is one of these cases. Let&amp;#8217;s see what are the main
reasons to use &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;%-formatting&lt;/span&gt;&lt;/tt&gt; for logging in&amp;nbsp;Python.&lt;/p&gt;
&lt;div class="section" id="python-logging-optimization-format-string-until-it-cannot-be-avoided"&gt;
&lt;h2&gt;Python logging optimization: format string until it cannot be&amp;nbsp;avoided&lt;/h2&gt;
&lt;p&gt;Python &lt;a class="reference external" href="https://docs.python.org/3/library/logging.html"&gt;logging&lt;/a&gt; methods like &lt;a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.debug"&gt;debug&lt;/a&gt; get in message argument along
with optional &lt;tt class="docutils literal"&gt;args&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;kwargs&lt;/tt&gt;. Args used for message
formatting. &lt;strong&gt;Formatting of these arguments is deferred until it cannot
be avoided&lt;/strong&gt;. That means the final message is not evaluated if its log
level is below the logger&amp;#8217;s log level. On the other hand, f-string is
really an expression that evaluated at runtime and it lacks logging&amp;#8217;s
optimizations. Let&amp;#8217;s see an&amp;nbsp;example:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;logging&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;logging&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;basicConfig&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;level&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;logging&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;logger&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;logging&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;getLogger&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;TestLogger&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;A&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__str__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Unnecessary slow computations are done here!&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__class__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;log level below INFO with args: &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;log level below INFO with f-string: {obj}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Unnecessary&lt;/span&gt; &lt;span class="n"&gt;slow&lt;/span&gt; &lt;span class="n"&gt;computations&lt;/span&gt; &lt;span class="n"&gt;are&lt;/span&gt; &lt;span class="n"&gt;done&lt;/span&gt; &lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;debug&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;log level below INFO with args: &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Unnecessary&lt;/span&gt; &lt;span class="n"&gt;slow&lt;/span&gt; &lt;span class="n"&gt;computations&lt;/span&gt; &lt;span class="n"&gt;are&lt;/span&gt; &lt;span class="n"&gt;done&lt;/span&gt; &lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;info&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;log level INFO with args: &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;obj&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Unnecessary&lt;/span&gt; &lt;span class="n"&gt;slow&lt;/span&gt; &lt;span class="n"&gt;computations&lt;/span&gt; &lt;span class="n"&gt;are&lt;/span&gt; &lt;span class="n"&gt;done&lt;/span&gt; &lt;span class="n"&gt;here&lt;/span&gt;&lt;span class="err"&gt;!&lt;/span&gt;
&lt;span class="n"&gt;INFO&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;TestLogger&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="n"&gt;log&lt;/span&gt; &lt;span class="n"&gt;level&lt;/span&gt; &lt;span class="n"&gt;INFO&lt;/span&gt; &lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see in &lt;strong&gt;step 3&lt;/strong&gt; a message doesn&amp;#8217;t get logged as the root
logger&amp;#8217;s level is higher than &lt;tt class="docutils literal"&gt;debug&lt;/tt&gt;. Logging module&amp;#8217;s inner
optimization makes sure that the message is not formatted in this
case. Compare this to &lt;strong&gt;step 6&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;In &lt;strong&gt;step 4&lt;/strong&gt; the f-string is also not logged because of the low log
level. But it&amp;#8217;s formatted anyway. That&amp;#8217;s why you see &lt;tt class="docutils literal"&gt;obj.__str__&lt;/tt&gt;
called.&lt;/p&gt;
&lt;p&gt;Please note, that logging optimization doesn&amp;#8217;t work for &lt;tt class="docutils literal"&gt;&amp;quot;format
string&amp;quot; % values&lt;/tt&gt; format. You can see that in &lt;strong&gt;step 5&lt;/strong&gt;. The magic
applies for &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;%-format&lt;/span&gt;&lt;/tt&gt; message &lt;strong&gt;if and only if the values for
message formatting are passed in as logger method&amp;#8217;s&amp;nbsp;arguments!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;So &lt;strong&gt;step 3&lt;/strong&gt; shows the optimized way to do message formatting in&amp;nbsp;logging.&lt;/p&gt;
&lt;p&gt;By the way, &lt;a class="reference external" href="https://docs.python.org/3/library/logging.html"&gt;logging&lt;/a&gt; module has other nice &lt;a class="reference external" href="https://docs.python.org/3/howto/logging.html#optimization"&gt;optimizations&lt;/a&gt; that worth&amp;nbsp;learning.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="sentry-integration-with-logging"&gt;
&lt;h2&gt;Sentry integration with&amp;nbsp;logging&lt;/h2&gt;
&lt;p&gt;Sentry is a popular error tracking solution. Sentry &lt;a class="reference external" href="https://docs.sentry.io/platforms/python/logging/"&gt;integrates&lt;/a&gt; with
the Python logging module. &lt;a class="reference external" href="https://docs.sentry.io/data-management/event-grouping/"&gt;Error aggregation&lt;/a&gt; is another great
feature of Sentry. Sentry looks at the event&amp;#8217;s stacktrace, exception,
or message and group it with existing ones if they are the same. If
you get a hundred of exceptions that are all the same they get grouped
into one with nice&amp;nbsp;statistics.&lt;/p&gt;
&lt;p&gt;When integrating Sentry with Python logging, it&amp;#8217;s important to use
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;%-formatting&lt;/span&gt;&lt;/tt&gt;, so that Sentry can group your messages. As an
example, let&amp;#8217;s log failed attempts to retrieve an &lt;span class="caps"&gt;URL&lt;/span&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Failed to retrieve URL &lt;/span&gt;&lt;span class="si"&gt;%s&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;With printf-style formatting your messages will be grouped together no
matter what value &lt;tt class="docutils literal"&gt;url&lt;/tt&gt; variable holds. But in this&amp;nbsp;case:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;logger&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;error&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Failed to retrieve URL {url}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;you get a separate event in Sentry for every single unique &lt;span class="caps"&gt;URL&lt;/span&gt;. If you
get 1000 unique &lt;span class="caps"&gt;URL&lt;/span&gt;, your Sentry dashboard might get&amp;nbsp;messy.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusions"&gt;
&lt;h2&gt;Conclusions&lt;/h2&gt;
&lt;p&gt;Although Python is not Perl, there&amp;#8217;s still more than one way to do
it. Which string formatting style to use is an open question. Your
project may not use Sentry, or you may prefer f-strings for
readability reasons. You may see deferred formatting in logging for
printf-style strings as a futile micro-optimization that won&amp;#8217;t improve
your app performance. But still, there may be cases where using an
oldie but goldie &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;%-formatting&lt;/span&gt;&lt;/tt&gt; is beneficial, even at price of
string formatting&amp;nbsp;inconsistency.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="updates"&gt;
&lt;h2&gt;Updates&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;2020-01-24 21:35&lt;/em&gt;. Many thanks to &lt;a class="reference external" href="https://blog.pilosus.org/posts/2020/01/24/python-f-strings-in-logging/#comment-4769289809"&gt;symmitchry&lt;/a&gt; who stressed out the
importance of passing values for a message to be formatted as
&lt;em&gt;arguments to logger&amp;#8217;s method&lt;/em&gt; (e.g. args to
&lt;tt class="docutils literal"&gt;logger.debug()&lt;/tt&gt;). Probably, that wasn&amp;#8217;t quite clear in the first
edition of the post. I&amp;#8217;ve made this point&amp;nbsp;explicit.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="python"></category><category term="logging"></category><category term="f-string"></category></entry><entry><title>Python third-party tools configuration: pyproject.toml vs setup.cfg</title><link href="https://blog.pilosus.org/posts/2019/12/26/python-third-party-tools-configuration/" rel="alternate"></link><published>2019-12-26T12:10:00+03:00</published><updated>2019-12-26T12:10:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-12-26:/posts/2019/12/26/python-third-party-tools-configuration/</id><summary type="html">&lt;p class="first last"&gt;Universal config file for Python third-party tools in 2020? It&amp;#8217;s a&amp;nbsp;myth&lt;/p&gt;
</summary><content type="html">&lt;p&gt;A couple of years ago two PEPs have been proposed to fix some package
building interface problems. Basically, in order to build a Python
package we need to checkout source of the project, then install a
build system and finally run it. &lt;a class="reference external" href="https://www.python.org/dev/peps/pep-0517/"&gt;&lt;span class="caps"&gt;PEP&lt;/span&gt; 517&lt;/a&gt; defines the last step,
including how to get the build system dynamically specify more
dependencies that the build system requires to perform its job. The
&lt;a class="reference external" href="https://www.python.org/dev/peps/pep-0518/"&gt;&lt;span class="caps"&gt;PEP&lt;/span&gt; 518&lt;/a&gt; defines the second step, including a new configuration file
&lt;tt class="docutils literal"&gt;pyproject.toml&lt;/tt&gt; to be used by the building&amp;nbsp;system.&lt;/p&gt;
&lt;p&gt;As &lt;tt class="docutils literal"&gt;setuptools&lt;/tt&gt; have been dominating in Python packaging field for a
long time, many third-party tools adopted its configuration file
&lt;a class="reference external" href="https://setuptools.readthedocs.io/en/latest/setuptools.html#configuring-setup-using-setup-cfg-files"&gt;setup.cfg&lt;/a&gt; too. Libraries for testing, static code analysis tools
like linters or type checkers along with their custom configuration
files often allow to use &lt;tt class="docutils literal"&gt;setup.cfg&lt;/tt&gt;. After all, it&amp;#8217;s &lt;span class="caps"&gt;INI&lt;/span&gt;-style
configuration format, easy for humans to read and edit it, with no
standard behind it&amp;nbsp;though.&lt;/p&gt;
&lt;p&gt;Moving tool settings to the &lt;tt class="docutils literal"&gt;setup.cfg&lt;/tt&gt; as opposed to supporing a
bunch of custom config files seems to be common practice. But now that
we have the new PEPs, should we abandon &lt;tt class="docutils literal"&gt;setup.cfg&lt;/tt&gt; in favour of the
brand new &lt;tt class="docutils literal"&gt;pyproject.toml&lt;/tt&gt;? Let&amp;#8217;s&amp;nbsp;see.&lt;/p&gt;
&lt;div class="section" id="popular-python-tools-and-their-configs"&gt;
&lt;h2&gt;6 popular Python tools and their&amp;nbsp;configs&lt;/h2&gt;
&lt;p&gt;Here are the 6 Python tools that I use daily both at my job and for
the personal projects: &lt;a class="reference external" href="https://docs.pytest.org/en/latest/"&gt;pytest&lt;/a&gt; for testing, &lt;a class="reference external" href="https://pytest-cov.readthedocs.io/en/latest/"&gt;pytest-cov&lt;/a&gt; as a
pytest plugin for &lt;a class="reference external" href="https://coverage.readthedocs.io/en/coverage-5.0/"&gt;coverage&lt;/a&gt; tool that calculates code coverage,
&lt;a class="reference external" href="http://mypy-lang.org/"&gt;mypy&lt;/a&gt; as a type checker, &lt;a class="reference external" href="http://flake8.pycqa.org/en/latest/"&gt;flake8&lt;/a&gt; as a code style checker, &lt;a class="reference external" href="https://black.readthedocs.io/en/stable/"&gt;black&lt;/a&gt;
for code formatting, and &lt;a class="reference external" href="https://timothycrosley.github.io/isort/"&gt;isort&lt;/a&gt; for sorting&amp;nbsp;imports.&lt;/p&gt;
&lt;p&gt;In a table below you&amp;#8217;ll find these tools along with their versions at
the time of writing, popular and (arguably) universal config files as
well as their &lt;em&gt;native&lt;/em&gt; configuration file&amp;nbsp;formats.&lt;/p&gt;
&lt;table border="1" class="docutils"&gt;
&lt;colgroup&gt;
&lt;col width="14%" /&gt;
&lt;col width="8%" /&gt;
&lt;col width="14%" /&gt;
&lt;col width="22%" /&gt;
&lt;col width="12%" /&gt;
&lt;col width="29%" /&gt;
&lt;/colgroup&gt;
&lt;thead valign="bottom"&gt;
&lt;tr&gt;&lt;th class="head"&gt;tool&lt;/th&gt;
&lt;th class="head"&gt;version&lt;/th&gt;
&lt;th class="head"&gt;&lt;tt class="docutils literal"&gt;setup.cfg&lt;/tt&gt;&lt;/th&gt;
&lt;th class="head"&gt;&lt;tt class="docutils literal"&gt;pyproject.toml&lt;/tt&gt;&lt;/th&gt;
&lt;th class="head"&gt;&lt;tt class="docutils literal"&gt;tox.ini&lt;/tt&gt;&lt;/th&gt;
&lt;th class="head"&gt;custom format&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody valign="top"&gt;
&lt;tr&gt;&lt;td&gt;&lt;a class="reference external" href="https://docs.pytest.org/en/latest/"&gt;pytest&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;5.3.2&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;no (&lt;span class="caps"&gt;WIP&lt;/span&gt;)&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;pytest.ini&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;a class="reference external" href="https://pytest-cov.readthedocs.io/en/latest/"&gt;pytest-cov&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;2.8.1&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;.coveragerc&lt;/tt&gt;, pytest conf&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;a class="reference external" href="http://mypy-lang.org/"&gt;mypy&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;0.750.0&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;no (won&amp;#8217;t fix?)&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;mypy.ini&lt;/tt&gt; (preferred)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;a class="reference external" href="http://flake8.pycqa.org/en/latest/"&gt;flake8&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;3.7.9&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;yes (unofficially)&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;.flake8&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;a class="reference external" href="https://black.readthedocs.io/en/stable/"&gt;black&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;19.10b0&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;no&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--config&lt;/span&gt;&lt;/tt&gt; any &lt;span class="caps"&gt;TOML&lt;/span&gt; file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;&lt;td&gt;&lt;a class="reference external" href="https://timothycrosley.github.io/isort/"&gt;isort&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;4.3.21&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;yes&lt;/td&gt;
&lt;td&gt;&lt;tt class="docutils literal"&gt;.isort.cfg&lt;/tt&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;If there&amp;#8217;s something to take in from the table, then it&amp;#8217;s the
following. First, there&amp;#8217;s no consensus in the Python community over
the usage of &lt;tt class="docutils literal"&gt;pyproject.toml&lt;/tt&gt;. The most notable discussion involves
Guido van Rossum in &lt;a class="reference external" href="https://github.com/python/mypy/issues/5205#issuecomment-410281336"&gt;mypy issue&lt;/a&gt; on the GitHub. &lt;span class="caps"&gt;PEP&lt;/span&gt; 518 is all about
configuration for package building systems like &lt;tt class="docutils literal"&gt;distutils&lt;/tt&gt;,
&lt;tt class="docutils literal"&gt;setuptools&lt;/tt&gt;, &lt;a class="reference external" href="https://github.com/takluyver/flit"&gt;flit&lt;/a&gt;, &lt;a class="reference external" href="https://cournape.github.io/Bento/"&gt;bento&lt;/a&gt;. It says nothing about configuration
for tools outside of the package builing context. But what if package
building process involves type checking or code formatting? Also,
&lt;tt class="docutils literal"&gt;setup.cfg&lt;/tt&gt; is a part of the &lt;tt class="docutils literal"&gt;setuptools&lt;/tt&gt; which is a building
system too. Still, people use it for third-party tools configuration
outside of the package building context, e.g. for imports sorting
checks in their &lt;span class="caps"&gt;CI&lt;/span&gt; pipelines. All in all, mypy has set a precedent for
not supporting &lt;tt class="docutils literal"&gt;pyproject.toml&lt;/tt&gt; on purpose, so that some other tools
developers hesitate either to openly support the new config file like
flake8 does, or just postpone implementation until a consensus is
emerged in the Python&amp;nbsp;community.&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;img alt="How standards prolifirate" class="align-right" src="https://imgs.xkcd.com/comics/standards.png" /&gt;
&lt;/div&gt;
&lt;p&gt;Secondly, there&amp;#8217;s always a &lt;a class="reference external" href="https://black.readthedocs.io/en/stable/"&gt;black&lt;/a&gt; sheep of the family. Being a great
formatting tool that eventually has ended so many holy wars about code
formatting, black doesn&amp;#8217;t support anything except for &lt;span class="caps"&gt;TOML&lt;/span&gt; config
files. Even if you are more inclined towards ol&amp;#8217; reliable
&lt;tt class="docutils literal"&gt;setup.cfg&lt;/tt&gt;, you still has a black sheep in your
setup.cfg-compatible&amp;nbsp;flock.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="https://github.com/toml-lang/toml"&gt;&lt;span class="caps"&gt;TOML&lt;/span&gt;&lt;/a&gt; is a great human-readable, machine-editable, strong typed,
well-defined configuration format. Having Python- and
setuptools-independent configuration file &lt;tt class="docutils literal"&gt;pyproject.toml&lt;/tt&gt; is a
great idea. Still, as the usage of &lt;tt class="docutils literal"&gt;pyproject.toml&lt;/tt&gt; for non-package
building context is not defined, we are in the &lt;a class="reference external" href="https://xkcd.com/927/"&gt;xkcd&lt;/a&gt;
how-standards-proliferate situation. Until consensus is finally set,
it&amp;#8217;s better off either use &lt;tt class="docutils literal"&gt;setup.cfg&lt;/tt&gt; with an annoying exception
for &lt;tt class="docutils literal"&gt;black&lt;/tt&gt;, or stick to the tools custom config formats and&amp;nbsp;files.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="python"></category><category term="tool"></category><category term="standard"></category></entry><entry><title>Python interview questions and answers</title><link href="https://blog.pilosus.org/posts/2019/12/15/python-interview-questions/" rel="alternate"></link><published>2019-12-15T14:00:00+03:00</published><updated>2019-12-15T14:00:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-12-15:/posts/2019/12/15/python-interview-questions/</id><summary type="html">&lt;p class="first last"&gt;Python questions and answers for a technical&amp;nbsp;interview&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Although the questions you find in this blog post are universal, they
are crafted for a technical interview for a web developer&amp;nbsp;position.&lt;/p&gt;
&lt;p&gt;The questions have been tested in real life: I used them in more
than 35 interview sessions. They allowed my team and me to hire three
brilliant developers: a junior developer (ex-Yandex), a middle
developer (ex-Yandex), and a senior&amp;nbsp;one.&lt;/p&gt;
&lt;p&gt;The questions have also been reviewed by my peers and got positive
feedback. Some of my colleagues use these questions in their technical
interviews. I also use the questions when consulting people about
preparing for the interview or getting their first software&amp;nbsp;job.&lt;/p&gt;
&lt;p&gt;The questions are not unique. I&amp;#8217;m not revealing any professional
secrets by posting them. The single most valuable thing about these
questions is the principle they are combined in an interview
session. You can also use these questions to come up with your
questions for the Python interview as an interviewer. Also, you can
use them to prepare for an interview as an&amp;nbsp;interviewee.&lt;/p&gt;
&lt;div class="contents topic" id="table-of-contents"&gt;
&lt;p class="topic-title first"&gt;Table of&amp;nbsp;Contents&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="#introduction" id="id2"&gt;Introduction&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#premises" id="id3"&gt;Premises&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#candidates-cvs" id="id4"&gt;Candidates &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;CVs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#non-technical-questions" id="id5"&gt;Non-technical&amp;nbsp;questions&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#python-questions" id="id6"&gt;Python questions&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#how-language-evolves" id="id7"&gt;How language&amp;nbsp;evolves&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#basic-types-and-data-structures-in-python" id="id8"&gt;Basic types and data structures in&amp;nbsp;Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#function-default-arguments" id="id9"&gt;Function default&amp;nbsp;arguments&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#what-s-decorator" id="id10"&gt;What&amp;#8217;s&amp;nbsp;decorator?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#decorator-that-prints-function-execution-time" id="id11"&gt;Decorator that prints function execution&amp;nbsp;time&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#using-decorator" id="id12"&gt;Using&amp;nbsp;decorator&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#decorated-function-s-name" id="id13"&gt;Decorated function&amp;#8217;s&amp;nbsp;name&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#decorators-for-generators" id="id14"&gt;Decorators for&amp;nbsp;generators&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#decorator-with-arguments" id="id15"&gt;Decorator with&amp;nbsp;arguments&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#class-variables" id="id16"&gt;Class&amp;nbsp;variables&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#list-slices" id="id17"&gt;List&amp;nbsp;slices&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#what-s-list-dict-comprehension" id="id18"&gt;What&amp;#8217;s list/dict&amp;nbsp;comprehension?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#generator-expressions" id="id19"&gt;Generator&amp;nbsp;expressions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#what-useful-functions-from-functools-do-you-know" id="id20"&gt;What useful functions from functools do you&amp;nbsp;know?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#asyncio-multithreading-multiprocessing" id="id21"&gt;Asyncio, multithreading,&amp;nbsp;multiprocessing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#python-ecosystem" id="id22"&gt;Python&amp;nbsp;ecosystem&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#computer-science-questions" id="id23"&gt;Computer science questions&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#time-complexity" id="id24"&gt;Time&amp;nbsp;complexity&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#balanced-brackets-in-a-lisp-program-problem" id="id25"&gt;Balanced brackets in a Lisp-program&amp;nbsp;problem&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#databases" id="id26"&gt;Databases&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#why-rdbms" id="id27"&gt;Why &lt;span class="caps"&gt;RDBMS&lt;/span&gt;?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#mysql-postgresql-queries" id="id28"&gt;MySQL/PostgreSQL&amp;nbsp;queries&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#nosql-overview" id="id29"&gt;NoSQL&amp;nbsp;Overview&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#redis-overview" id="id30"&gt;Redis&amp;nbsp;Overview&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#testing" id="id31"&gt;Testing&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#unit-testing-overview" id="id32"&gt;Unit-testing&amp;nbsp;overview&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#how-do-you-test-a-function-that-changes-data-in-mysql" id="id33"&gt;How do you test a function that changes data in&amp;nbsp;MySQL?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#devops-sysadmin-skills" id="id34"&gt;DevOps/SysAdmin skills&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#broken-response-from-google-com" id="id35"&gt;Broken response from&amp;nbsp;google.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#ip-addresses-top-from-nginx-log" id="id36"&gt;&lt;span class="caps"&gt;IP&lt;/span&gt; addresses top from Nginx&amp;nbsp;log&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#docker" id="id37"&gt;Docker&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#system-design-and-architecture" id="id38"&gt;System Design and Architecture&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#system-design-of-pastebin-like-service" id="id39"&gt;System design of pastebin-like service&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#user-story-business-description" id="id40"&gt;User story (business&amp;nbsp;description)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#assume" id="id41"&gt;Assume&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#hints" id="id42"&gt;Hints&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#capacity-planning-for-3-years" id="id43"&gt;Capacity planning for 3&amp;nbsp;years&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#service-architecture" id="id44"&gt;Service&amp;nbsp;architecture&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#write-api" id="id45"&gt;Write &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#unique-url-path-generation" id="id46"&gt;Unique &lt;span class="caps"&gt;URL&lt;/span&gt; path&amp;nbsp;generation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#request-write-api" id="id47"&gt;Request Write &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#write-api-response" id="id48"&gt;Write &lt;span class="caps"&gt;API&lt;/span&gt;&amp;nbsp;Response&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#request-read-api" id="id49"&gt;Request Read &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#read-api-reponse" id="id50"&gt;Read &lt;span class="caps"&gt;API&lt;/span&gt;&amp;nbsp;Reponse&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#statistics" id="id51"&gt;Statistics&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#sources-and-useful-links" id="id52"&gt;Sources and useful&amp;nbsp;links&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id2"&gt;Introduction&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="premises"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id3"&gt;Premises&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Software development is no longer an art, nor a lifelong quest, but
rather an everyday office job, though highly-skilled one. That&amp;#8217;s why
a candidate&amp;#8217;s abilities for teamwork, coping with chores are super
important. But pure computer science, algorithms are in the
background, whether you like it or&amp;nbsp;not.&lt;/li&gt;
&lt;li&gt;An algorithm-based technical interview is an analogue of &lt;span class="caps"&gt;IQ&lt;/span&gt;-tests
that have been invented in the early &lt;span class="caps"&gt;XX&lt;/span&gt; century in the &lt;span class="caps"&gt;US&lt;/span&gt; for a
quick military recruits categorization. &lt;span class="caps"&gt;IQ&lt;/span&gt; provides some insights
about human intelligence but also has its flaws. Demonstrated
algorithm skill also provides an insight about candidate&amp;#8217;s
intelligence but also has its flaws. Algorithm-based technical
interviews are used by corporations to quickly process a huge queue
of candidates, hire the ones they need and evaluate their grades and
salary. Corporations everybody wants to work for can afford a false
negative in hiring, i.e. not hiring the right person, as many
candidates compete to be hired by these companies. If you are not
one of these companies, then &lt;strong&gt;you&lt;/strong&gt; compete with other companies
for the candidates. So don&amp;#8217;t pretend to be a Google if you are not&amp;nbsp;Google.&lt;/li&gt;
&lt;li&gt;Human intelligence neither is an &amp;#8220;on/off&amp;#8221;, nor a range. Rather,
intelligence is a swiss army knife, a multitool. It may contain an
excellent sharp blade for everyday chores, it may also have a
screwdriver that merely works, and it may also have a corkscrew that
you actually don&amp;#8217;t need at all. Can we evaluate an overall score for
such a multitool? Sure. But why would we? Unless you are Google,
find a multitool with the blades and bits that solve your exact
problems, not the abstract&amp;nbsp;ones.&lt;/li&gt;
&lt;li&gt;You need an interview to find out three things: a) why the candidate
has left (or are ready to leave) his/her previous (current) job; b)
what is he/she looking for at the new company; c) what value can
he/she bring to your&amp;nbsp;team?&lt;/li&gt;
&lt;li&gt;Hiring error can be mitigated by the probationary period. Take it
seriously. Set some goals (tasks) for probation. The same for the
candidate: during probation decide if the company is the right
choice. But hiring error is still an error that costs your company
money and time. You should do your best to avoid this error. The
same for the candidate. That&amp;#8217;s why you never tell lies about your
project and team in the interview. Still, there&amp;#8217;s nothing wrong with
presenting your project positively. Actually, it&amp;#8217;s your duty if you
want to hire someone in a highly competitive job&amp;nbsp;market.&lt;/li&gt;
&lt;li&gt;There are no two identical interviews even for the same grade. The
technical interview is always improvisation. It&amp;#8217;s an attempt to
reveal a candidate&amp;#8217;s boundaries of competence, strengths and
weaknesses in a short period of&amp;nbsp;time.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="candidates-cvs"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id4"&gt;Candidates &lt;span class="amp"&gt;&amp;amp;&lt;/span&gt;&amp;nbsp;CVs&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Not everybody is a &lt;span class="caps"&gt;CV&lt;/span&gt;-ninja.&amp;nbsp;Really&lt;/li&gt;
&lt;li&gt;Too high salary expectations isn&amp;#8217;t a reason to reject a
candidate &lt;span class="caps"&gt;CV&lt;/span&gt;. You always can ask questions that will either lower
the expectations or prove you are interviewing a&amp;nbsp;genius.&lt;/li&gt;
&lt;li&gt;(sarcasm mode on) Of course, an interviewer always knows best!
(sarcasm mode off) But there are no solid grounds for reject
candidate CVs with grammar mistakes or expressions of inexperience or
quirks in their CVs. Asking inadequately complex questions is also
not a good idea. The interview is not about you, it&amp;#8217;s about the&amp;nbsp;candidate.&lt;/li&gt;
&lt;li&gt;Don&amp;#8217;t afraid of people with some irrelevant background,
e.g. designers, analysts, etc., who changed his/her profession to a
technical one. Be honest, your boring &lt;span class="caps"&gt;REST&lt;/span&gt; &lt;span class="caps"&gt;API&lt;/span&gt; doesn&amp;#8217;t require a
university graduate&amp;nbsp;program.&lt;/li&gt;
&lt;li&gt;A candidate&amp;#8217;s technology stack may not be 100% yours. Still, he/she
may be a good match for your team. Should you hire someone with 3+
years of experience with Flask but no Django experience for your
Django project? Probably you&amp;nbsp;should.&lt;/li&gt;
&lt;li&gt;The only way to hire someone quickly is to do as many interviews as
you&amp;nbsp;can.&lt;/li&gt;
&lt;li&gt;Average interview time for an interviewer is about 2.5 hours (skim
over the CVs, prepare for the interview, the interview itself,
discussion with an &lt;span class="caps"&gt;HR&lt;/span&gt; specialist and a &lt;span class="caps"&gt;CTO&lt;/span&gt;)&lt;/li&gt;
&lt;li&gt;Don&amp;#8217;t make a technical interview for too long. 2 hour is enough. 1.5
hours is&amp;nbsp;optimal.&lt;/li&gt;
&lt;li&gt;Three interviews a week is a good pace. More than 3 is too much for
the interviewer and his/her team. Less than 3 makes your search&amp;nbsp;longer.&lt;/li&gt;
&lt;li&gt;Average time for hiring a Python developer depends on the project,
expected experience and your offer conditions. As a rule of thumb, 3
months from submitting an open position to &lt;span class="caps"&gt;HR&lt;/span&gt; department to the
first working day is&amp;nbsp;okay.&lt;/li&gt;
&lt;li&gt;Not every software engineer is an introvert. There are people with
outstanding &amp;#8220;selling&amp;#8221; skills who are prepared for typical interview
questions, present themselves, but still lack solid knowledge of
software development. Don&amp;#8217;t let them trick you! Ask whiteboard
programming&amp;nbsp;questions!&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="non-technical-questions"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id5"&gt;Non-technical&amp;nbsp;questions&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What have you done in your previous/current&amp;nbsp;project?&lt;/li&gt;
&lt;li&gt;Describe your team line-up (frontend/backend developers, &lt;span class="caps"&gt;QA&lt;/span&gt;
engineers, &lt;span class="caps"&gt;SRE&lt;/span&gt;/DevOps/SysAdmins, product/project managers,&amp;nbsp;etc)?&lt;/li&gt;
&lt;li&gt;How planning, code review, etc. are organized in your project? What
you liked and disliked about&amp;nbsp;it?&lt;/li&gt;
&lt;li&gt;Why did you decice to leave (have already left) the&amp;nbsp;project?&lt;/li&gt;
&lt;li&gt;What do you expect from the new project (things to develop, processes,&amp;nbsp;etc)?&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="python-questions"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id6"&gt;Python&amp;nbsp;questions&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="how-language-evolves"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id7"&gt;How language&amp;nbsp;evolves&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What&amp;#8217;s new in the latest Python version? (&lt;a class="reference external" href="https://docs.python.org/3/whatsnew/3.8.html"&gt;Python 3.8&lt;/a&gt; at the moment of&amp;nbsp;writing)&lt;/li&gt;
&lt;li&gt;How Python 3+ differs from Python 2.7? (&lt;a class="reference external" href="https://docs.python.org/3.0/whatsnew/3.0.html"&gt;What&amp;#8217;s new in Python 3&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;What new syntax has been introduced since Python 2.7? (minimal expectations: asyncio, type&amp;nbsp;hinting)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="basic-types-and-data-structures-in-python"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id8"&gt;Basic types and data structures in&amp;nbsp;Python&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What are the basic types in&amp;nbsp;Python?&lt;/li&gt;
&lt;li&gt;What are the basic data structures in&amp;nbsp;Python?&lt;/li&gt;
&lt;li&gt;All data types and structures in Python can be divided into two groups. Name these groups (mutable,&amp;nbsp;immutable)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Problem. What lines of the following code raise exceptions? What&amp;nbsp;expectations?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;       &lt;span class="c1"&gt;# TypeError: unhashable type: &amp;#39;list&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;])]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="c1"&gt;# TypeError: unhashable type: &amp;#39;list&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="function-default-arguments"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id9"&gt;Function default&amp;nbsp;arguments&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Problem. We have got a&amp;nbsp;function:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun_default&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lst&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[])&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;lst&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;lst&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What the following print statements will print after the block of assignments is&amp;nbsp;executed?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;l1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fun_default&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;l2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fun_default&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[])&lt;/span&gt;
&lt;span class="n"&gt;l3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fun_default&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# [1, 3]&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# [2]&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# [1, 3]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;How would you fix the function so that print statements print [1], [2], [3]&amp;nbsp;respectively?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun_default_fixed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lst&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;lst&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;lst&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="n"&gt;lst&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;lst&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="what-s-decorator"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id10"&gt;What&amp;#8217;s&amp;nbsp;decorator?&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What&amp;#8217;s&amp;nbsp;decorator?&lt;/li&gt;
&lt;li&gt;What decorators from the standard library you&amp;nbsp;know?&lt;/li&gt;
&lt;li&gt;Tell about &lt;a class="reference external" href="https://docs.python.org/3.7/howto/descriptor.html"&gt;descriptor protocol&lt;/a&gt; (complex&amp;nbsp;question)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="decorator-that-prints-function-execution-time"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id11"&gt;Decorator that prints function execution&amp;nbsp;time&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;We have got a function that queries a database. We want each function
call to print time of its execution. Implement it with a decorator.
Assume: decorated function may have any number of positional or
keyword&amp;nbsp;arguments.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Wrapper function&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time elapsed: {after - before} seconds&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="using-decorator"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id12"&gt;Using&amp;nbsp;decorator&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;How do you apply your decorator to a function &lt;cite&gt;fun&lt;/cite&gt; using syntactic
sugar and without&amp;nbsp;it?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# with syntactic sugar&lt;/span&gt;
&lt;span class="nd"&gt;@measure&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;

&lt;span class="c1"&gt;# sugar free&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# function&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="decorated-function-s-name"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id13"&gt;Decorated function&amp;#8217;s&amp;nbsp;name&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;What is function &lt;cite&gt;docstring&lt;/cite&gt; and &lt;cite&gt;name&lt;/cite&gt; after decorator is&amp;nbsp;applied?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;  &lt;span class="c1"&gt;# &amp;#39;wrapper&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__doc__&lt;/span&gt;  &lt;span class="c1"&gt;# &amp;#39;Wrapper function&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;How do you return the original name and docstring to the decorated&amp;nbsp;function?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;functools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;wraps&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="nd"&gt;@wraps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Wrapper function&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time elapsed: {after - before} seconds&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;

&lt;span class="nd"&gt;@measure&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;My func&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;

&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;  &lt;span class="c1"&gt;# &amp;#39;fun&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__doc__&lt;/span&gt;   &lt;span class="c1"&gt;# &amp;#39;My func&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;How would you do that without &lt;cite&gt;functools.wraps&lt;/cite&gt;?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Wrapper function&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time elapsed: {after - before} seconds&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
    &lt;span class="n"&gt;wrapper&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__doc__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__doc__&lt;/span&gt;
    &lt;span class="n"&gt;wrapper&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="decorators-for-generators"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id14"&gt;Decorators for&amp;nbsp;generators&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;What time do we get if we decorate a generator function like the&amp;nbsp;following?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;typing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Generator&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Any&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun_gen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Generator&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Any&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Why time we see is so small? How would you measure the real time of
iteration over the whole&amp;nbsp;generator?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;typing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Generator&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Any&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;measure_gen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;yield from&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time elapsed: {after - before} seconds&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;

&lt;span class="nd"&gt;@measure_gen&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun_gen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Generator&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Any&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="decorator-with-arguments"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id15"&gt;Decorator with&amp;nbsp;arguments&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Rewrite the decorator from the previous question so that it could take
in an argument for a limit. Execution time is printed if it exceeds
the&amp;nbsp;limit.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;limit&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Don&amp;#39;t forget to set limit when decorating a function!&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;outer_wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;inner_wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

            &lt;span class="n"&gt;elapsed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;before&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;elapsed&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;limit&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time elapsed: {after - before} seconds&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;inner_wrapper&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;outer_wrapper&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;How do we decorate a function using syntactic sugar and without&amp;nbsp;it?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;new_measure&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;new_measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;

&lt;span class="c1"&gt;# sugar free&lt;/span&gt;
&lt;span class="n"&gt;new_measure&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;new_measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="class-variables"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id16"&gt;Class&amp;nbsp;variables&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;What&amp;#8217;s a class&amp;nbsp;variable?&lt;/p&gt;
&lt;p&gt;Problem.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Parent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Child1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Child2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What will the following print statements&amp;nbsp;print?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# 1 1 1&lt;/span&gt;

&lt;span class="n"&gt;Child1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# 1 2 1&lt;/span&gt;

&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# 3 2 3&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="list-slices"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id17"&gt;List&amp;nbsp;slices&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Problem. What are the results of this code block&amp;nbsp;execution?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;  &lt;span class="c1"&gt;# [2]&lt;/span&gt;
&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;  &lt;span class="c1"&gt;# [1, 2, 3, 4]&lt;/span&gt;
&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:]&lt;/span&gt;  &lt;span class="c1"&gt;# []&lt;/span&gt;
&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;   &lt;span class="c1"&gt;# IndexError&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="what-s-list-dict-comprehension"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id18"&gt;What&amp;#8217;s list/dict&amp;nbsp;comprehension?&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Implement a list of even numbers in a range [0, 10) to the power 2
using list&amp;nbsp;comprehension.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Implement the same using map and&amp;nbsp;filter.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="generator-expressions"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id19"&gt;Generator&amp;nbsp;expressions&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;What&amp;#8217;s the easiest way to turn the above list comprehension into a
generator (generator&amp;nbsp;expression)?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="what-useful-functions-from-functools-do-you-know"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id20"&gt;What useful functions from functools do you&amp;nbsp;know?&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;The question may be a follow-up for decorator questions and
&lt;cite&gt;functools.wraps&lt;/cite&gt;. functools is a great module with loads of useful
things. What would be great to hear from the candidate is something
like &lt;cite&gt;reduce&lt;/cite&gt; and &lt;cite&gt;partial&lt;/cite&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="asyncio-multithreading-multiprocessing"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id21"&gt;Asyncio, multithreading,&amp;nbsp;multiprocessing&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What&amp;#8217;s the difference between a process and a&amp;nbsp;thread?&lt;/li&gt;
&lt;li&gt;Problem. We have got a list of 1000 URLs, we have to iterate over it
and make &lt;span class="caps"&gt;GET&lt;/span&gt; requests. How would you do that? (&lt;span class="caps"&gt;IO&lt;/span&gt;-bound tasks -&amp;gt;
asyncio, Tornado etc или&amp;nbsp;multithreading)&lt;/li&gt;
&lt;li&gt;Problem. We have got 1000 video files than should be rendered
somehow using Python. How would you do that? (&lt;span class="caps"&gt;CPU&lt;/span&gt;-bound tasks -&amp;gt;&amp;nbsp;multiprocessing)&lt;/li&gt;
&lt;li&gt;Give an overview of &lt;cite&gt;asyncio&lt;/cite&gt; or similar libraries for asynchronous
programming. How does it work? (huge question, expectations are
covered in &lt;a class="reference external" href="https://trio.readthedocs.io/en/latest/tutorial.html"&gt;Trio tutorial&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="python-ecosystem"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id22"&gt;Python&amp;nbsp;ecosystem&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What do you use for background tasks in a Python project? (&lt;cite&gt;celery&lt;/cite&gt;)&lt;/li&gt;
&lt;li&gt;How do you pack your Python code? (&lt;cite&gt;wheels&lt;/cite&gt;, &lt;cite&gt;eggs&lt;/cite&gt;, what&amp;#8217;s the&amp;nbsp;difference?)&lt;/li&gt;
&lt;li&gt;How do you document your Python project? (&lt;cite&gt;sphinx-doc&lt;/cite&gt;)&lt;/li&gt;
&lt;li&gt;What do you use for &lt;span class="caps"&gt;REST&lt;/span&gt; &lt;span class="caps"&gt;API&lt;/span&gt; documenting? (&lt;cite&gt;swagger&lt;/cite&gt;)&lt;/li&gt;
&lt;li&gt;What &lt;span class="caps"&gt;ORM&lt;/span&gt; do you use? (&lt;cite&gt;SQLAlchemy&lt;/cite&gt;, &lt;cite&gt;Django &lt;span class="caps"&gt;ORM&lt;/span&gt;&lt;/cite&gt;)&lt;/li&gt;
&lt;li&gt;What static analysis tools and linters for Python code do you use?
(&lt;cite&gt;mypy&lt;/cite&gt;, &lt;cite&gt;flake8&lt;/cite&gt;)&lt;/li&gt;
&lt;li&gt;What web frameworks do you use? (&lt;cite&gt;Flask&lt;/cite&gt;, &lt;cite&gt;Django&lt;/cite&gt;, &lt;cite&gt;aiohttp&lt;/cite&gt;,
&lt;cite&gt;sanic&lt;/cite&gt;,&amp;nbsp;etc.)&lt;/li&gt;
&lt;li&gt;What package management tools do you use? (&lt;cite&gt;pip&lt;/cite&gt;, &lt;cite&gt;pipenv&lt;/cite&gt;,
&lt;cite&gt;poetry&lt;/cite&gt;,&amp;nbsp;etc.)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="computer-science-questions"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id23"&gt;Computer science&amp;nbsp;questions&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="time-complexity"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id24"&gt;Time&amp;nbsp;complexity&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What&amp;#8217;s time&amp;nbsp;complexity?&lt;/li&gt;
&lt;li&gt;What&amp;#8217;s Big&amp;nbsp;O?&lt;/li&gt;
&lt;li&gt;What&amp;#8217;s time complexity for the following&amp;nbsp;algorithm?&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# O(n^2)&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
         &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What&amp;#8217;s time complexity for each of these&amp;nbsp;statements?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="c1"&gt;# where type(s) is list/tuple # O(n)&lt;/span&gt;
&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="c1"&gt;# where type(s) is set        # O(1)&lt;/span&gt;
&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;                               &lt;span class="c1"&gt;# O(1)&lt;/span&gt;
&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;insert&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;                               &lt;span class="c1"&gt;# O(n)&lt;/span&gt;
&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;                                 &lt;span class="c1"&gt;# O(1)&lt;/span&gt;
&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;                                   &lt;span class="c1"&gt;# O(n log n)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Check out other data structures &lt;a class="reference external" href="https://wiki.python.org/moin/TimeComplexity"&gt;time complexity&lt;/a&gt; if&amp;nbsp;needed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="balanced-brackets-in-a-lisp-program-problem"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id25"&gt;Balanced brackets in a Lisp-program&amp;nbsp;problem&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Problem. I like to code in Racket, which is a Lisp dialect that uses a
&lt;a class="reference external" href="https://blog.pilosus.org/images/git-the-princess.png"&gt;lot of brackets&lt;/a&gt;.  Implement a Python function that takes in text
and returns &lt;cite&gt;True&lt;/cite&gt; if brackets in the text are balanced, and returns
&lt;cite&gt;False&lt;/cite&gt; otherwise.&lt;/p&gt;
&lt;p&gt;Examples of balanced&amp;nbsp;brackets:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;()&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;(())&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;(custom-set-variables &amp;#39;(inhibit-startup-screen t) &amp;#39;(package-selected-packages (quote&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;indent&lt;/span&gt; &lt;span class="n"&gt;magit&lt;/span&gt; &lt;span class="n"&gt;dockerfile&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;yaml&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;gitlab&lt;/span&gt; &lt;span class="n"&gt;markdown&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;lorem&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ipsum&lt;/span&gt; &lt;span class="n"&gt;jedi&lt;/span&gt;
&lt;span class="n"&gt;elpy&lt;/span&gt; &lt;span class="n"&gt;anaconda&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;afternoon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;(hello [world {!}])&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Examples of unbalanced&amp;nbsp;brackets:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;(&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;)(&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;())&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;({))&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;balance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;  Return True if string&amp;#39;s parentheses are balanced, False otherwise&lt;/span&gt;

&lt;span class="sd"&gt;  &amp;gt;&amp;gt;&amp;gt; balance(&amp;quot;&amp;quot;)&lt;/span&gt;
&lt;span class="sd"&gt;  True&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;gt;&amp;gt;&amp;gt; balance(&amp;quot;(())&amp;quot;)&lt;/span&gt;
&lt;span class="sd"&gt;  True&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;gt;&amp;gt;&amp;gt; balance(&amp;quot;))((&amp;quot;)&lt;/span&gt;
&lt;span class="sd"&gt;  False&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;gt;&amp;gt;&amp;gt; balance(&amp;quot;()()(())(()())&amp;quot;)&lt;/span&gt;
&lt;span class="sd"&gt;  True&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;gt;&amp;gt;&amp;gt; balance(&amp;quot;(]&amp;quot;)&lt;/span&gt;
&lt;span class="sd"&gt;  False&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;opening&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;(&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;[&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;{&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;closing&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;]&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;zip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;opening&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;closing&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
  &lt;span class="n"&gt;stack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;ch&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;ch&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;opening&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="n"&gt;stack&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mapping&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ch&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;ch&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;closing&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;stack&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ch&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;stack&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pop&lt;/span&gt;&lt;span class="p"&gt;()):&lt;/span&gt;
              &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;stack&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If needed the function can be simplified to check only for round&amp;nbsp;brackets.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="databases"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id26"&gt;Databases&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="why-rdbms"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id27"&gt;Why &lt;span class="caps"&gt;RDBMS&lt;/span&gt;?&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Problem. We are a startup with &lt;span class="caps"&gt;CTO&lt;/span&gt;, &lt;span class="caps"&gt;CEO&lt;/span&gt; and a couple of devs. We have
no admins yet. We are developing authentication service (users
registration, access rights, etc) in Python. Why do we need a
database? Why not using a simple text file? Python has all we need to
write to and read from a text file. We can just write user login and
password hash to the file when the user is signing up. And then we
read the credentials when the user is signing in in. It&amp;#8217;s easy. It
doesn&amp;#8217;t require database admin work. Why not a text&amp;nbsp;file?&lt;/p&gt;
&lt;p&gt;If needed, the question can be put this way: what mechanisms of a
relational database do you know, that are complex enough to implement,
but are necessary for our&amp;nbsp;case?&lt;/p&gt;
&lt;p&gt;&lt;span class="caps"&gt;DB&lt;/span&gt; features that the candidate expected to&amp;nbsp;mention:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;index&lt;/li&gt;
&lt;li&gt;relations&lt;/li&gt;
&lt;li&gt;transactions&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The candidate may be asked to elaborate on each of these features. For
example, you can ask him/her about&amp;nbsp;indices:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What&amp;#8217;s time complexity for searching using the&amp;nbsp;index?&lt;/li&gt;
&lt;li&gt;Problem. In table &lt;cite&gt;candidates&lt;/cite&gt; we have a &lt;cite&gt;is_interviewed&lt;/cite&gt; column
with possible values 0 or 1. How adding an index for this column
will affect search&amp;nbsp;performance?&lt;/li&gt;
&lt;li&gt;What&amp;#8217;s composite index (or multicolumn index)? What are the rules of
using composite&amp;nbsp;index?&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="mysql-postgresql-queries"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id28"&gt;MySQL/PostgreSQL&amp;nbsp;queries&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Problem. We have got service like iTunes where users can buy or rent a
video. This is a PostgreSQL database schema for the&amp;nbsp;service:&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;a class="reference external image-reference" href="https://blog.pilosus.org/images/sql-tables.pdf"&gt;&lt;img alt="PostgreSQL dababase schema for technical interview questions" class="responsive" src="https://blog.pilosus.org/images/sql-tables.jpg" /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Write a &lt;span class="caps"&gt;SQL&lt;/span&gt; query to select top-20 movies starring actor John Doe. The
query also&amp;nbsp;selects:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Movie&amp;nbsp;title&lt;/li&gt;
&lt;li&gt;Movie&amp;nbsp;language&lt;/li&gt;
&lt;li&gt;Movie release&amp;nbsp;year&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Results should be ordered in descendant order by a release&amp;nbsp;year.&lt;/p&gt;
&lt;p&gt;(If help needed) use tables: &lt;cite&gt;film&lt;/cite&gt;, &lt;cite&gt;language&lt;/cite&gt;, &lt;cite&gt;film_actor&lt;/cite&gt;, &lt;cite&gt;actor&lt;/cite&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;release_year&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;film&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;
&lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="k"&gt;language&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;language_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;language_id&lt;/span&gt;
&lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;film_actor&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;fa&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;fa&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;film_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;film_id&lt;/span&gt;
&lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;actor&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;actor_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fa&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;actor_id&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;John&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Doe&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;release_year&lt;/span&gt; &lt;span class="k"&gt;DESC&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Write a &lt;span class="caps"&gt;SQL&lt;/span&gt; query to select top-10 customers who paid most, but not
less than 100. The query also&amp;nbsp;selects:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Customer&amp;#8217;s &lt;span class="caps"&gt;ID&lt;/span&gt; and full&amp;nbsp;name&lt;/li&gt;
&lt;li&gt;Customer sum of&amp;nbsp;payments&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(If help needed) use tables: &lt;cite&gt;payment&lt;/cite&gt;, &lt;cite&gt;customer&lt;/cite&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;SUM&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;money&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;payment&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;
&lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;customer&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;
&lt;span class="k"&gt;GROUP&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;
&lt;span class="k"&gt;HAVING&lt;/span&gt; &lt;span class="k"&gt;SUM&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;money&lt;/span&gt; &lt;span class="k"&gt;DESC&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="nosql-overview"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id29"&gt;NoSQL&amp;nbsp;Overview&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What&amp;#8217;s&amp;nbsp;NoSQL?&lt;/li&gt;
&lt;li&gt;What types of NoSQL do you&amp;nbsp;know?&lt;/li&gt;
&lt;li&gt;What NoSQL &lt;span class="caps"&gt;DB&lt;/span&gt; did you&amp;nbsp;use?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Minimal expected answer: NoSQL is a database for collections of
data. Data is denormalized, &lt;span class="caps"&gt;JOIN&lt;/span&gt; is not supported (usually implemented
in your&amp;nbsp;app).&lt;/p&gt;
&lt;p&gt;Types of NoSQL&amp;nbsp;DBs:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;key-value store (hash table implementation: Redis,&amp;nbsp;AeroSpike)&lt;/li&gt;
&lt;li&gt;document-store (like key-value but with documents, e.g &lt;span class="caps"&gt;JSON&lt;/span&gt;, for
values:&amp;nbsp;MongoDB)&lt;/li&gt;
&lt;li&gt;wide column store (HBase,&amp;nbsp;Cassandra)&lt;/li&gt;
&lt;li&gt;graph database&amp;nbsp;(Neo4j)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="redis-overview"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id30"&gt;Redis&amp;nbsp;Overview&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What&amp;#8217;s Redis is used&amp;nbsp;for?&lt;/li&gt;
&lt;li&gt;Why it&amp;#8217;s so popular for caching&amp;nbsp;layer?&lt;/li&gt;
&lt;li&gt;How Redis is different from MySQL when it comes to data&amp;nbsp;storage?&lt;/li&gt;
&lt;li&gt;What happens if a machine that runs Redis server is&amp;nbsp;rebooted?&lt;/li&gt;
&lt;li&gt;What high availability mechanisms for Redis do you&amp;nbsp;know?&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Expectations: Redis is an in-memory key-value &lt;span class="caps"&gt;DB&lt;/span&gt;. Data snapshot
mechanism can be used in Redis to dump data to the disk. Redis
Sentinel is a mechanism for high&amp;nbsp;availability.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="testing"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id31"&gt;Testing&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="unit-testing-overview"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id32"&gt;Unit-testing&amp;nbsp;overview&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What&amp;#8217;s&amp;nbsp;unit-testing?&lt;/li&gt;
&lt;li&gt;How it&amp;#8217;s different from integration or functional&amp;nbsp;testing?&lt;/li&gt;
&lt;li&gt;What libraries did you use for testing in Python? (&lt;cite&gt;unittest&lt;/cite&gt;,
&lt;cite&gt;pytest&lt;/cite&gt;) How they are different from each&amp;nbsp;other?&lt;/li&gt;
&lt;li&gt;When you write a unit-test? (in the existing project, in the new
project, when fixing a bug, when implementing a new&amp;nbsp;feature)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="how-do-you-test-a-function-that-changes-data-in-mysql"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id33"&gt;How do you test a function that changes data in&amp;nbsp;MySQL?&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Problem. We&amp;#8217;ve got a function that executes a &lt;cite&gt;&lt;span class="caps"&gt;INSERT&lt;/span&gt;&lt;/cite&gt; &lt;span class="caps"&gt;SQL&lt;/span&gt; query in
the test database. Other developers in your team use the same
database. We need to write a unittest for the function. But we don&amp;#8217;t
want to change test &lt;span class="caps"&gt;DB&lt;/span&gt; on each test run. How do you do&amp;nbsp;it?&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;mock&lt;/li&gt;
&lt;li&gt;transaction&amp;nbsp;rollback&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="devops-sysadmin-skills"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id34"&gt;DevOps/SysAdmin&amp;nbsp;skills&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="broken-response-from-google-com"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id35"&gt;Broken response from&amp;nbsp;google.com&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Problem. When I open a browser, go to &lt;cite&gt;https://www.google.com&lt;/cite&gt; and see
the raw response, it&amp;#8217;s normal&amp;nbsp;text.&lt;/p&gt;
&lt;p&gt;Here I do a &lt;span class="caps"&gt;GET&lt;/span&gt; request using &lt;cite&gt;curl&lt;/cite&gt;, but a response seems to be&amp;nbsp;broken.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt; GET / HTTP/2
&amp;gt; Host: www.google.com
&amp;gt; User-Agent: curl/7.58.0
&amp;gt; Accept: */*
&amp;gt; Accept-Encoding: gzip, deflate

%�j��~d+.K�W��me&lt;span class="sb"&gt;`&lt;/span&gt;�,x�x�m�G�67��&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="nv"&gt;$#&lt;/span&gt;������~&lt;span class="o"&gt;{&lt;/span&gt;d���&lt;span class="o"&gt;]&lt;/span&gt;�.&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;����
����Q���Mʥu���&amp;lt;�O&lt;span class="o"&gt;)&lt;/span&gt;,�&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;�����,���E�.���_�
&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;�I&lt;span class="se"&gt;\�&lt;/span&gt;�p��#&lt;span class="o"&gt;]&lt;/span&gt;�,�����K+����p�vk
j���k&lt;span class="s2"&gt;&amp;quot;�fe�=�`�J4�I/��m6{�E���;3+�v�BT1T��(W��J��m�yO��&lt;/span&gt;
&lt;span class="s2"&gt;�j��&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Why is it&amp;nbsp;so?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -v &lt;span class="s2"&gt;&amp;quot;https://www.google.com&amp;quot;&lt;/span&gt; --header &lt;span class="s2"&gt;&amp;quot;Accept-Encoding: gzip, deflate&amp;quot;&lt;/span&gt; --output -
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="ip-addresses-top-from-nginx-log"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id36"&gt;&lt;span class="caps"&gt;IP&lt;/span&gt; addresses top from Nginx&amp;nbsp;log&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Problem. Our service is under high load because of DDoS-attack. It
makes hard for our legitimate customers to get a response from the
service. We want to ban &lt;span class="caps"&gt;IP&lt;/span&gt; addresses bots get used of. To do so we
want to make a top of &lt;span class="caps"&gt;IP&lt;/span&gt; addresses with the most requests. We ask our
admins to provide web server logs as a file &lt;cite&gt;nginx.log&lt;/cite&gt;.&lt;/p&gt;
&lt;p&gt;Using console &lt;span class="caps"&gt;GNU&lt;/span&gt; utils create a file with top &lt;span class="caps"&gt;IP&lt;/span&gt;-addresses with most
requests in descending order. Assume that &lt;span class="caps"&gt;IP&lt;/span&gt;-address is in 9th column
in the log, columns are separated by &lt;cite&gt;t&lt;/cite&gt;.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;awk &lt;span class="s1"&gt;&amp;#39;{print $9}&amp;#39;&lt;/span&gt; nginx.log &lt;span class="p"&gt;|&lt;/span&gt; sort &lt;span class="p"&gt;|&lt;/span&gt; uniq -c &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $1&amp;quot;,&amp;quot;$2}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort -r -t, -nk1 &amp;gt; bots.csv
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="docker"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id37"&gt;Docker&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;What&amp;#8217;s a docker&amp;nbsp;container?&lt;/li&gt;
&lt;li&gt;What&amp;#8217;s the difference between docker and virtualbox or other virtual&amp;nbsp;machines?&lt;/li&gt;
&lt;li&gt;Why docker? We can just copy files to the real hardware&amp;nbsp;machine&lt;/li&gt;
&lt;li&gt;Why not using virtualenv instead of&amp;nbsp;Docker?&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="system-design-and-architecture"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id38"&gt;System Design and&amp;nbsp;Architecture&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Parental advisory: highly opinionated content&amp;nbsp;(35+)&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="system-design-of-pastebin-like-service"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id39"&gt;System design of pastebin-like&amp;nbsp;service&lt;/a&gt;&lt;/h3&gt;
&lt;div class="section" id="user-story-business-description"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id40"&gt;User story (business&amp;nbsp;description)&lt;/a&gt;&lt;/h4&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;A user submits text&amp;nbsp;(copypasta)&lt;/li&gt;
&lt;li&gt;Text is saved, the user gets a unique &lt;span class="caps"&gt;URL&lt;/span&gt; (base serive &lt;span class="caps"&gt;URL&lt;/span&gt; + short&amp;nbsp;path)&lt;/li&gt;
&lt;li&gt;User goes to the &lt;span class="caps"&gt;URL&lt;/span&gt; and sees his/her original&amp;nbsp;text&lt;/li&gt;
&lt;li&gt;Text is stored until it&amp;#8217;s&amp;nbsp;expired&lt;/li&gt;
&lt;li&gt;Service deletes expired&amp;nbsp;texts&lt;/li&gt;
&lt;li&gt;Once the text is expired, it&amp;#8217;s not accessible anymore by its &lt;span class="caps"&gt;URL&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Service is operating under high&amp;nbsp;load&lt;/li&gt;
&lt;li&gt;A product owner needs monthly statistics for URLs&amp;nbsp;visits&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="assume"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id41"&gt;Assume&lt;/a&gt;&lt;/h4&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Copypasta can be in text format&amp;nbsp;only&lt;/li&gt;
&lt;li&gt;The product owner doesn&amp;#8217;t need realtime&amp;nbsp;statistics&lt;/li&gt;
&lt;li&gt;Service gets 10 million new copypastas a month (3.85 &lt;span class="caps"&gt;RPS&lt;/span&gt;)&lt;/li&gt;
&lt;li&gt;Service has 100 million copypasta reads a month (38.5 &lt;span class="caps"&gt;RPS&lt;/span&gt;)&lt;/li&gt;
&lt;li&gt;We need capacity planning (hardware planning) for 3&amp;nbsp;years&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="hints"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id42"&gt;Hints&lt;/a&gt;&lt;/h4&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Average text size is&amp;nbsp;1Kb&lt;/li&gt;
&lt;li&gt;Short &lt;span class="caps"&gt;URL&lt;/span&gt; path takes 7 bytes in &lt;span class="caps"&gt;DB&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span class="caps"&gt;URL&lt;/span&gt; expiry (or &lt;span class="caps"&gt;TTL&lt;/span&gt;) takes 4 bytes in &lt;span class="caps"&gt;DB&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;&lt;span class="caps"&gt;URL&lt;/span&gt; timestamp takes 5 bytes in &lt;span class="caps"&gt;DB&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;File path to a copypasta takes 255 bytes in &lt;span class="caps"&gt;DB&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;In total: 1.27 &lt;span class="caps"&gt;KB&lt;/span&gt; per copypasta or 1.27 Gb of copypasta a&amp;nbsp;month&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="capacity-planning-for-3-years"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id43"&gt;Capacity planning for 3&amp;nbsp;years&lt;/a&gt;&lt;/h4&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;36 * 12.7 = 457 Gb of&amp;nbsp;copypasta&lt;/li&gt;
&lt;li&gt;36 * 10 = 360 million&amp;nbsp;URLs&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="service-architecture"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id44"&gt;Service&amp;nbsp;architecture&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  Client
    |
    V
Load Balancer
    |
    V
 Web Server (Reverse Proxy, i.e. Nginx)
  |      |
  V      V
Write   Read                                Analytics (MapReduce)
API     API---------------------------       |         |
 |       |        |                  |       |         |
 |       V        |                  |       |         |
 |      Cache     |                  |       |         V
 ------------------------------      |       |       SQL for Analytics
 V                |            |     |       |
SQL-----------    |            V     V       V
 |_Master    |    |           Object (File) Store
 |_Slave     V    |
            SQL   V
 ^              Read-only Replica
 |
 |
Periodic Task
(remove expired)
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="write-api"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id45"&gt;Write &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Generate a &lt;span class="caps"&gt;URL&lt;/span&gt;, check for unique constraint in &lt;span class="caps"&gt;SQL&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;If the &lt;span class="caps"&gt;URL&lt;/span&gt; is unique, make an &lt;span class="caps"&gt;INSERT&lt;/span&gt; into &lt;span class="caps"&gt;DB&lt;/span&gt; table, otherwise go to&amp;nbsp;1.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;shortlink&lt;/span&gt; &lt;span class="nb"&gt;char&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;
&lt;span class="n"&gt;expiration_in_minutes&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;
&lt;span class="n"&gt;created_at&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;
&lt;span class="n"&gt;paste_path&lt;/span&gt; &lt;span class="nb"&gt;varchar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;
&lt;span class="k"&gt;PRIMARY&lt;/span&gt; &lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;shortlink&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;INDEX&lt;/span&gt; &lt;span class="n"&gt;shortlink_idx&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;pastes&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;shortlink&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;USING&lt;/span&gt; &lt;span class="n"&gt;BTREE&lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;INDEX&lt;/span&gt; &lt;span class="n"&gt;created_at_idx&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;pastes&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;created_at&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;USING&lt;/span&gt; &lt;span class="n"&gt;BTREE&lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="unique-url-path-generation"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id46"&gt;Unique &lt;span class="caps"&gt;URL&lt;/span&gt; path&amp;nbsp;generation&lt;/a&gt;&lt;/h4&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Generate a random string md5(&amp;#8220;user &lt;span class="caps"&gt;IP&lt;/span&gt; address string&amp;#8221; + &amp;#8220;timestamp&amp;nbsp;string&amp;#8221;)&lt;/li&gt;
&lt;li&gt;Encode string from 1 with &lt;cite&gt;Base 62&lt;/cite&gt; (like Base 64 but without escape&amp;nbsp;characters)&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;base_encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;62&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;digits&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="n"&gt;num&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
      &lt;span class="n"&gt;remainder&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;modulo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;remainder&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;num&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;divide&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;digits&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reverse&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;ol class="arabic simple" start="3"&gt;
&lt;li&gt;Get first 7 characters from base62 string: it&amp;#8217;s 62**7 possible
short paths (which is much more than we need in our 3 years plan,
i.e. 360 million&amp;nbsp;URLs)&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;base_encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ip_address&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;timestamp&lt;/span&gt;&lt;span class="p"&gt;))[:&lt;/span&gt;&lt;span class="n"&gt;URL_LENGTH&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="request-write-api"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id47"&gt;Request Write &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ curl -X POST https://pastebin.com/api/v1.0/paste &lt;span class="se"&gt;\&lt;/span&gt;
       --data &lt;span class="s1"&gt;&amp;#39;{ &amp;quot;expiration_in_minutes&amp;quot;: &amp;quot;60&amp;quot;, &amp;quot;paste_contents&amp;quot;: &amp;quot;My paste&amp;quot; }&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="write-api-response"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id48"&gt;Write &lt;span class="caps"&gt;API&lt;/span&gt;&amp;nbsp;Response&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;shortlink&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;xJlsmeT&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="request-read-api"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id49"&gt;Request Read &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ curl https://pastebin.com/api/v1.0/paste?shortlink&lt;span class="o"&gt;=&lt;/span&gt;xJlsmeT
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="read-api-reponse"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id50"&gt;Read &lt;span class="caps"&gt;API&lt;/span&gt;&amp;nbsp;Reponse&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;paste&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;My paste&amp;quot;&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;YYYY-MM-DD HH:MM:SS&amp;quot;&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;expiration_in_minutes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;60&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="statistics"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id51"&gt;Statistics&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;Since we don&amp;#8217;t need realtime analytics, let&amp;#8217;s use Nginx logs and process them in&amp;nbsp;MapReduce&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;HitCounts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MRJob&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;extract_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Extract the generated url from the log line.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="o"&gt;...&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;extract_year_month&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Return the year and month portions of the timestamp.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="o"&gt;...&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;mapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Parse each log line, extract and transform relevant lines.&lt;/span&gt;

&lt;span class="sd"&gt;        Emit key value pairs of the form:&lt;/span&gt;

&lt;span class="sd"&gt;        (2016-01, url0), 1&lt;/span&gt;
&lt;span class="sd"&gt;        (2016-01, url0), 1&lt;/span&gt;
&lt;span class="sd"&gt;        (2016-01, url1), 1&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extract_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;period&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extract_year_month&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;period&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;reducer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Sum values for each key.&lt;/span&gt;

&lt;span class="sd"&gt;        (2016-01, url0), 2&lt;/span&gt;
&lt;span class="sd"&gt;        (2016-01, url1), 1&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="sources-and-useful-links"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id52"&gt;Sources and useful&amp;nbsp;links&lt;/a&gt;&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.toptal.com/python/interview-questions"&gt;Toptal Python Interview&amp;nbsp;Questions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Python Interview Questions (&lt;a class="reference external" href="https://luminousmen.com/post/6"&gt;junior&lt;/a&gt;, &lt;a class="reference external" href="https://luminousmen.com/post/7"&gt;middle&lt;/a&gt;, &lt;a class="reference external" href="https://luminousmen.com/post/8"&gt;senior&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/checkcheckzz/system-design-interview"&gt;System design&amp;nbsp;interview&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docs.python.org/3.8/reference/index.html"&gt;The Python Language&amp;nbsp;Reference&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://www.postgresqltutorial.com/"&gt;PostgreSQL&amp;nbsp;Tutorial&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="python"></category><category term="interview"></category></entry><entry><title>Вопросы и ответы для собеседования веб-разработчика на Python</title><link href="https://blog.pilosus.org/posts/2019/12/08/python-interview-questions-ru/" rel="alternate"></link><published>2019-12-08T14:57:00+03:00</published><updated>2019-12-08T14:57:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-12-08:/posts/2019/12/08/python-interview-questions-ru/</id><summary type="html">&lt;p class="first last"&gt;Вопросы и ответы для технического собеседования&amp;nbsp;Python-разработчика&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Ниже вы найдете принципы проведения и вопросы для технического
собеседования на позицию Python-разработчика. Хотя вопросы довольно
универсальны, больше всего они подойдут для области&amp;nbsp;веб-разработки.&lt;/p&gt;
&lt;p&gt;Вопросы прошли испытания боем: с их помощью было прособеседовано
больше 35 кандидатов. Из них 3 (2 экс-Яндекс) стали частью моей
команды в 2018 году, и еще 1 кандидат вышел в параллельную&amp;nbsp;команду.&lt;/p&gt;
&lt;p&gt;Вопросы получили положительный отклик коллег: люди используют их в
каком-то объеме для собеседований в своих компаниях. Я также
использую эти вопросы для консультации людей, которые готовятся к
прохождению технического&amp;nbsp;собеседования.&lt;/p&gt;
&lt;p&gt;В то же время вопросы едва ли можно считать уникальными. Здесь нет
никаких профессиональных тайн. На мой взгляд, основное преимущество
вопросов &amp;#8212; их система и принципы. На их основе можно составлять свои
интересные и полезные вопросы для проведения собеседования, скроенные
для ваших нужд. Или готовиться к техническому интервью в качестве&amp;nbsp;кандидата.&lt;/p&gt;
&lt;div class="contents topic" id="id1"&gt;
&lt;p class="topic-title first"&gt;Содержание&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id2" id="id36"&gt;Введение&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id3" id="id37"&gt;Предпосылки&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id4" id="id38"&gt;Отбор&amp;nbsp;кандидатов&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id5" id="id39"&gt;Гуманитарные&amp;nbsp;вопросы&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id6" id="id40"&gt;Python&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id7" id="id41"&gt;Проверка знаний, как развивается&amp;nbsp;язык&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id8" id="id42"&gt;Основные типы и структуры данных в&amp;nbsp;Python&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id9" id="id43"&gt;Порядок вычисления дефолтных аргументов&amp;nbsp;функций&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id10" id="id44"&gt;Что такое&amp;nbsp;декоратор?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#stdout" id="id45"&gt;Декоратор, выводящий в stdout время выполнения&amp;nbsp;функции&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id11" id="id46"&gt;Применение&amp;nbsp;декоратора&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id12" id="id47"&gt;Имя декорированной&amp;nbsp;функции&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id13" id="id48"&gt;Декоратор для&amp;nbsp;генераторов&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id14" id="id49"&gt;Декоратор с&amp;nbsp;аргументами&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id15" id="id50"&gt;Переменные&amp;nbsp;класса&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id16" id="id51"&gt;Слайсы в&amp;nbsp;списках&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#list-dict-comprehensions" id="id52"&gt;Что такое list/dict&amp;nbsp;comprehensions?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#generator-expressions" id="id53"&gt;Generator&amp;nbsp;expressions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#functools" id="id54"&gt;Какие полезные функции из модуля functools ты&amp;nbsp;знаешь?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#asyncio-multithreading-multiprocessing" id="id55"&gt;Asyncio, multithreading,&amp;nbsp;multiprocessing&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id17" id="id56"&gt;Экосистема&amp;nbsp;языка&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id18" id="id57"&gt;Алгоритмы&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id19" id="id58"&gt;Временная&amp;nbsp;сложность&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#lisp" id="id59"&gt;Проверка сбалансированности скобок в&amp;nbsp;Lisp-программе&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id20" id="id60"&gt;Базы данных&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#rdbms" id="id61"&gt;Зачем нужна &lt;span class="caps"&gt;RDBMS&lt;/span&gt;?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#mysql-postgresql" id="id62"&gt;Запросы в&amp;nbsp;MySQL/PostgreSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#nosql" id="id63"&gt;Общие представления о&amp;nbsp;NoSQL&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#redis" id="id64"&gt;Общие представления о&amp;nbsp;Redis&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id21" id="id65"&gt;Тестирование&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#unit" id="id66"&gt;Общие представления о&amp;nbsp;unit-тестировании&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#mysql" id="id67"&gt;Как протестировать функцию, которая изменяет запись в&amp;nbsp;MySQL?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#devops" id="id68"&gt;DevOps/Администрирование&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#google-com" id="id69"&gt;Проблема с нечитаемым ответом&amp;nbsp;google.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#ip-nginx" id="id70"&gt;Топ &lt;span class="caps"&gt;IP&lt;/span&gt; адресов из лога &lt;span class="caps"&gt;NGINX&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#docker" id="id71"&gt;Docker&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id22" id="id72"&gt;Архитектура&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#pastebin" id="id73"&gt;Проектирование сервиса копипасты pastebin&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id23" id="id74"&gt;Бизнес-описание&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id24" id="id75"&gt;Ограничения и&amp;nbsp;допущения&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id25" id="id76"&gt;Ответить соискателю, если&amp;nbsp;спросит&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id26" id="id77"&gt;Крупноблочная схема&amp;nbsp;архитектуры&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#write-api" id="id78"&gt;Write &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id27" id="id79"&gt;Создание уникального&amp;nbsp;урла&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id28" id="id80"&gt;Запрос к Write &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id29" id="id81"&gt;Ответ Write &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#read-api" id="id82"&gt;Запрос к Read &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id30" id="id83"&gt;Ответ Read &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id31" id="id84"&gt;Аналитика&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a class="reference internal" href="#id32" id="id85"&gt;Полезные&amp;nbsp;ссылки&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id2"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id36"&gt;Введение&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="id3"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id37"&gt;Предпосылки&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Разработка софта больше не искусство, не дело жизни, а обычная, хотя
и высококвалифицированная офисная работа. Поэтому особенно ценно в
кандидате то, как он работает в команде, как справляется с
повседневной работой. Как бы банально и избито это ни звучало. А вот
гениальные технические озарения и хитрые алгоритмы, на втором
плане. Те, для кого на первом, сами знают, каким должно быть
техническое&amp;nbsp;собеседование.&lt;/li&gt;
&lt;li&gt;Алгоритмическое собеседование это аналог &lt;span class="caps"&gt;IQ&lt;/span&gt;-тестов, изобретенных
американскими учеными в начале &lt;span class="caps"&gt;XX&lt;/span&gt; века для быстрой категоризации
больших масс призывников по родам войск. &lt;span class="caps"&gt;IQ&lt;/span&gt; дает представление об
интеллекте человека, но не исключает ошибок. Умение решать
алгоритмические задачи тоже дает представление об интеллекте
человека, но не лишено недостатков. Алгоритмические собеседования
нужны крупным компаниям, которым требуется быстро отобрать нужных
людей из огромных масс кандидатов и установить на входе грейд и
зарплату. Они могут позволить себе ошибку ненайма, потому что
кандидаты конкурируют за позиции в этих компаниях, а не наоборот,
как большинстве других случаев. Не стройте из себя Google, если вы
им не&amp;nbsp;являетесь.&lt;/li&gt;
&lt;li&gt;Интеллект человека это не бинарное &amp;#8220;есть/нет&amp;#8221; и не
диапазон. Интеллект &amp;#8212; это что-то вроде швейцарского армейского
ножа-мультитула. В нем может быть острое и практичное лезвие для
повседневного использования, не слишком удобный штопор, которым все
же можно пользоваться, и бесполезная отвертка, которой не сделаешь
ничего. Можно ли дать интегральную оценку такому мультитулу?
Наверное, можно. Но непонятно, зачем. Если вы не Google,
конечно. Подбирайте нож под свои задачи и исходя из своих&amp;nbsp;возможностей.&lt;/li&gt;
&lt;li&gt;Собеседование нужно, чтобы понять, почему человек ушел (или готов
уйти) с текущего места работы, что он ищет на новом месте и что он
может предложить&amp;nbsp;команде.&lt;/li&gt;
&lt;li&gt;Ошибка найма обычно компенсируется испытательным сроком. Нужно
отнестись к нему серьезно и выдать задание на этот
период. Аналогично со стороны сотрудника. И все-таки ошибка найма &amp;#8212;
это ошибка, которая стоит вам времени и денег. Лучшее ее не
совершать. Аналогично для сотрудника. Поэтому врать про проект не
стоит. Но уметь его красиво преподнести нисколько не
зазорно. Напротив, в условиях конкуренции компаний за кандидатов,
это ваша прямая&amp;nbsp;обязанность.&lt;/li&gt;
&lt;li&gt;Не бывает двух одинаковых собеседований даже для кандидатов одного
уровня. Техническое собеседование это всегда импровизация, попытка
найти границы компетентности и сильные стороны кандидата за короткий
промежуток&amp;nbsp;времени.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id4"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id38"&gt;Отбор&amp;nbsp;кандидатов&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Не все люди умеют составлять&amp;nbsp;резюме.&lt;/li&gt;
&lt;li&gt;Слишком высокие зарплатные ожидания у интересного кандидата – не
повод отказываться от собеседования. Всегда можно позадавать
вопросы, которые снизят неоправданные зарплатные ожидания. Или
подтвердят, что перед вами&amp;nbsp;гений.&lt;/li&gt;
&lt;li&gt;Интевьюер, несомненно, самый умный и замечательный. Но это не повод
забраковывать резюме с грамматическими ошибками (как учат вас горе
HRы), смешными формулировками с проявлениями юношеской неопытности и
всяким таким прочим. Задавать неоправданно сложные вопросы тоже не
стоит. Оставьте высокомерие при&amp;nbsp;себе.&lt;/li&gt;
&lt;li&gt;Не нужно бояться звать на собеседование человека, который раньше
работал дизайнером/юристом/прорабом на заводе, но переучился на
разработчика. Будем же честны, разрабатывать вашу скучную &lt;span class="caps"&gt;REST&lt;/span&gt; &lt;span class="caps"&gt;API&lt;/span&gt;
много ума не надо, а профильное образование нужно далеко не&amp;nbsp;везде.&lt;/li&gt;
&lt;li&gt;У кандидата может не быть 100% попадания в ваш технологический стэк,
что не помешает ему в нем очень быстро разобраться. Скорее всего,
неразумно отвергать кандидата с опытом работы с Flask 3 года, но без
опыта работы с Django, на ваш заурядный Django-проект. Ну&amp;nbsp;правда.&lt;/li&gt;
&lt;li&gt;Единственный способ быстро найти разработчика: провести как можно
больше&amp;nbsp;собеседований&lt;/li&gt;
&lt;li&gt;Среднее время, которое затратит интервьюер на 1 собеседование: ~2.5
часа (отсмотр резюме, подготовка к интервью, само интервью, общение
с &lt;span class="caps"&gt;HR&lt;/span&gt; и &lt;span class="caps"&gt;CTO&lt;/span&gt;).&lt;/li&gt;
&lt;li&gt;Не стоит делать техническое интервью дольше 2 часов. Идеально 1.5&amp;nbsp;часа.&lt;/li&gt;
&lt;li&gt;3 собеседования в неделю – это хороший темп. Больше – тяжело
(физически для интервьюера, для &lt;span class="caps"&gt;HR&lt;/span&gt; в смыле поиска кандидата и для
проекта в смысле отсутствия лида во время собеседований). Меньше –
подбор сотрудника&amp;nbsp;затянется.&lt;/li&gt;
&lt;li&gt;Среднее время поиска Python-разработчика зависит от проекта, грейда
и того, что может предложить ваша компания. В среднем 3 месяца от
размещения заявки в &lt;span class="caps"&gt;HR&lt;/span&gt; до первого дня работы нового сотрудника это&amp;nbsp;нормально.&lt;/li&gt;
&lt;li&gt;Ваш главный союзник в общегуманитарных вопросах собеседования - ваш
&lt;span class="caps"&gt;HR&lt;/span&gt;.&lt;/li&gt;
&lt;li&gt;Не все разработчики – это тихие интроверты. Есть достаточное
количество людей, которые умеют говорить, продавать себя и выучивать
ответы для собеседований, не имея глубоких знаний. Не дайте себя
обмануть, обязательно давайте&amp;nbsp;задачки.&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id5"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id39"&gt;Гуманитарные&amp;nbsp;вопросы&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Что кандидат делал на прошлых местах работы. Какую позицию&amp;nbsp;занимал?&lt;/li&gt;
&lt;li&gt;Какой состав команды был на прошлых проектах (фронт, бэк, &lt;span class="caps"&gt;QA&lt;/span&gt;,
админы,&amp;nbsp;менеджеры)?&lt;/li&gt;
&lt;li&gt;Как был организован процесс планирования, постановки задач и ревью?
Какие в этом были плюсы и&amp;nbsp;минусы?&lt;/li&gt;
&lt;li&gt;Почему кандидат решил уйти (или уже ушел) с прошлого места&amp;nbsp;работы?&lt;/li&gt;
&lt;li&gt;Что хотелось бы от нового проекта? В смысле задач и&amp;nbsp;процессов?&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id6"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id40"&gt;Python&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="id7"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id41"&gt;Проверка знаний, как развивается&amp;nbsp;язык&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Расскажи, что появилось в последней версии Python? (&lt;a class="reference external" href="https://docs.python.org/3/whatsnew/3.8.html"&gt;Python 3.8&lt;/a&gt; на момент создания&amp;nbsp;статьи)&lt;/li&gt;
&lt;li&gt;В чем состоят &lt;a class="reference external" href="https://docs.python.org/3.0/whatsnew/3.0.html"&gt;основные различия&lt;/a&gt; между Python 2.7 и&amp;nbsp;3.0&lt;/li&gt;
&lt;li&gt;Какие синтаксические изменения произошли в языке после Python 2.7?
(хочется услышать как минимум об asyncio и type&amp;nbsp;hinting)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id8"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id42"&gt;Основные типы и структуры данных в&amp;nbsp;Python&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Назови основные типы данных в&amp;nbsp;Python&lt;/li&gt;
&lt;li&gt;Расскажи, какие структуры данных есть в&amp;nbsp;Python&lt;/li&gt;
&lt;li&gt;На какие два больших класса можно разделить типы/структуры данных? (mutable,&amp;nbsp;immutable)&lt;/li&gt;
&lt;li&gt;Зачем вообще нужны immutable объекты? Почему нельзя везде использовать&amp;nbsp;mutable?&lt;/li&gt;
&lt;li&gt;Какие строки в примере ниже выбросят исключение? Какие&amp;nbsp;исключения?&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;d&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{}&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;)]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt; &lt;span class="c1"&gt;# TypeError: unhashable type: &amp;#39;list&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;d&lt;/span&gt;&lt;span class="p"&gt;[(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;])]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt; &lt;span class="c1"&gt;# TypeError: unhashable type: &amp;#39;list&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id9"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id43"&gt;Порядок вычисления дефолтных аргументов&amp;nbsp;функций&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;У нас есть&amp;nbsp;функция:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun_default&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lst&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="p"&gt;[])&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;lst&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;lst&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Какие значения будут иметь следующие списки после выполнения всего блока&amp;nbsp;присваиваний:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;l1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fun_default&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;l2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fun_default&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="p"&gt;[])&lt;/span&gt;
&lt;span class="n"&gt;l3&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fun_default&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# [1, 3]&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l2&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# [2]&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# [1, 3]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Как поправить эту функцию, чтобы ответ был [1], [2], [3]&amp;nbsp;соответственно?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun_default_fixed&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lst&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;lst&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="n"&gt;lst&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="n"&gt;lst&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;val&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;lst&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id10"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id44"&gt;Что такое&amp;nbsp;декоратор?&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Что такое&amp;nbsp;декоратор?&lt;/li&gt;
&lt;li&gt;Какие декораторы из коробки&amp;nbsp;знаешь?&lt;/li&gt;
&lt;li&gt;Расскажи про &lt;a class="reference external" href="https://docs.python.org/3.7/howto/descriptor.html"&gt;протокол descriptor&lt;/a&gt; (сложный вопрос, можно раскручивать&amp;nbsp;долго)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="stdout"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id45"&gt;Декоратор, выводящий в stdout время выполнения&amp;nbsp;функции&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;У нас есть функция, которая обращается в БД. Хочется, чтобы каждый
вызов этой функции показывал в консоли время ее выполнения. Реализуй
этот функционал с помощью декоратора. Допущение: декорируемая функция
может иметь любое количество позиционных и непозиционных&amp;nbsp;аргументов.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Wrapper function&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time elapsed: {after - before} seconds&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id11"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id46"&gt;Применение&amp;nbsp;декоратора&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Как можно применить декоратор к функции &lt;cite&gt;fun&lt;/cite&gt;, используя синтаксический сахар и без&amp;nbsp;него?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# with syntactic sugar&lt;/span&gt;
&lt;span class="nd"&gt;@measure&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;

&lt;span class="c1"&gt;# sugar free&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="c1"&gt;# function&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id12"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id47"&gt;Имя декорированной&amp;nbsp;функции&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Какое имя и &lt;cite&gt;docstring&lt;/cite&gt; будут у функции после применения к ней&amp;nbsp;декоратора?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;  &lt;span class="c1"&gt;# &amp;#39;wrapper&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__doc__&lt;/span&gt;  &lt;span class="c1"&gt;# &amp;#39;Wrapper function&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Как вернуть задекорированной функции оригинальное имя и &lt;cite&gt;doctring&lt;/cite&gt;?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;functools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;wraps&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="nd"&gt;@wraps&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Wrapper function&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time elapsed: {after - before} seconds&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;

&lt;span class="nd"&gt;@measure&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;My func&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;

&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;  &lt;span class="c1"&gt;# &amp;#39;fun&amp;#39;&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__doc__&lt;/span&gt;  &lt;span class="c1"&gt;# &amp;#39;My func&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Как добиться того же эффекта без &lt;cite&gt;functools.wraps&lt;/cite&gt;?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Wrapper function&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time elapsed: {after - before} seconds&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
    &lt;span class="n"&gt;wrapper&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__doc__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__doc__&lt;/span&gt;
    &lt;span class="n"&gt;wrapper&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__name__&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id13"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id48"&gt;Декоратор для&amp;nbsp;генераторов&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Какое время будет выводиться, если применить декоратор к&amp;nbsp;генератору?&lt;/p&gt;
&lt;p&gt;Допустим, мы применим написанный выше декоратор к такой&amp;nbsp;функции:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;typing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Generator&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Any&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun_gen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Generator&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Any&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Почему в консоли время, выведенное декоратором, такое маленькое?
Как замерить время итерации по всему&amp;nbsp;генератору?&lt;/p&gt;
&lt;p&gt;Этот вариант декоратора прокрутит генератор до конца и выведет общее время&amp;nbsp;итерирования:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;time&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;typing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Generator&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Any&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;measure_gen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="k"&gt;yield from&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time elapsed: {after - before} seconds&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;wrapper&lt;/span&gt;

&lt;span class="nd"&gt;@measure_gen&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun_gen&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Generator&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Any&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id14"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id49"&gt;Декоратор с&amp;nbsp;аргументами&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Перепиши декоратор из задачи выше так, чтобы в него можно было
передать аргумент, который будет устанавливать пороговое значение,
начиная с которого будет выводиться время исполнения декорируемой&amp;nbsp;функции:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;limit&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# Don&amp;#39;t forget to set limit when decorating a function!&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;outer_wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;inner_wrapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="n"&gt;before&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
            &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;func&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;args&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;kwargs&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
            &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;time&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

            &lt;span class="n"&gt;elapsed&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;after&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;before&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;elapsed&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;limit&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;Time elapsed: {after - before} seconds&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;inner_wrapper&lt;/span&gt;
    &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;outer_wrapper&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Покажи, как использовать этот декоратор с синтаксическим сахаром и без&amp;nbsp;него.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# syntactic sugar&lt;/span&gt;
&lt;span class="nd"&gt;@measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;

&lt;span class="c1"&gt;# sugar free&lt;/span&gt;
&lt;span class="n"&gt;new_measure&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;new_measure&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;fun&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id15"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id50"&gt;Переменные&amp;nbsp;класса&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Что такое переменная&amp;nbsp;класса?&lt;/p&gt;
&lt;p&gt;Даны следующие&amp;nbsp;классы:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Parent&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Child1&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Child2&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;pass&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Что выведут следующие&amp;nbsp;строки?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# 1 1 1&lt;/span&gt;

&lt;span class="n"&gt;Child1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# 1 2 1&lt;/span&gt;

&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Parent&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child1&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Child2&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="c1"&gt;# 3 2 3&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id16"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id51"&gt;Слайсы в&amp;nbsp;списках&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Как исполнятся следующие&amp;nbsp;строки?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;l&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;  &lt;span class="c1"&gt;# [2]&lt;/span&gt;
&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;[:&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;  &lt;span class="c1"&gt;# [1, 2, 3, 4]&lt;/span&gt;
&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;:]&lt;/span&gt;  &lt;span class="c1"&gt;# []&lt;/span&gt;
&lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;  &lt;span class="c1"&gt;# IndexError&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="list-dict-comprehensions"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id52"&gt;Что такое list/dict&amp;nbsp;comprehensions?&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Создай список квадрат четных чисел от [0, 10), используя list&amp;nbsp;comprehension&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;То же самое, используя map и&amp;nbsp;filter?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;filter&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="generator-expressions"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id53"&gt;Generator&amp;nbsp;expressions&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Как превратить первый пример в generator (generator&amp;nbsp;expression)?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;%&lt;/span&gt; &lt;span class="mi"&gt;2&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="functools"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id54"&gt;Какие полезные функции из модуля functools ты&amp;nbsp;знаешь?&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Этот вопрос можно задавать после вопроса про декораторы и
functools.wraps. В functools много всякого интересного.  Хотелось бы
услышать про reduce и особенно про&amp;nbsp;partial.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="asyncio-multithreading-multiprocessing"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id55"&gt;Asyncio, multithreading,&amp;nbsp;multiprocessing&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;В чем разница между процессом и&amp;nbsp;трэдом?&lt;/li&gt;
&lt;li&gt;Есть лист из 1к урлов, по каждому из них нужно сделать &lt;span class="caps"&gt;GET&lt;/span&gt;
запрос. Как это сделать быстрее и дешевле? (&lt;span class="caps"&gt;IO&lt;/span&gt;-bound tasks -&amp;gt;
asyncio, Tornado etc или&amp;nbsp;multithreading)&lt;/li&gt;
&lt;li&gt;Есть 1к видеофайлов, которые надо отрендерить, или 1к программ,
которые надо скомпилировать. Как это сделать быстрее? (&lt;span class="caps"&gt;CPU&lt;/span&gt;-bound
tasks -&amp;gt;&amp;nbsp;multiprocessing)&lt;/li&gt;
&lt;li&gt;Как устроен asyncio или аналогичные библиотеки для асинхронного
программирования в Python? (огромный вопрос, который можно превратить
в целое собеседование. Хочется как минимум понимания на уровне
&lt;a class="reference external" href="https://trio.readthedocs.io/en/latest/tutorial.html"&gt;туториала Trio&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id17"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id56"&gt;Экосистема&amp;nbsp;языка&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Какие решения существуют для выполнения фоновых отложенных задач? (&lt;cite&gt;celery&lt;/cite&gt;)&lt;/li&gt;
&lt;li&gt;Как сделать package из Python-кода? (wheels, eggs, в чем&amp;nbsp;отличия?)&lt;/li&gt;
&lt;li&gt;Какие есть решения для документирования кода на Python? (&lt;cite&gt;sphinx-doc&lt;/cite&gt;)&lt;/li&gt;
&lt;li&gt;Какие есть решения для документирования &lt;span class="caps"&gt;REST&lt;/span&gt; &lt;span class="caps"&gt;API&lt;/span&gt; (&lt;cite&gt;swagger&lt;/cite&gt;)&lt;/li&gt;
&lt;li&gt;Назови &lt;span class="caps"&gt;ORM&lt;/span&gt;, с которыми ты работал (&lt;cite&gt;SQLAlchemy&lt;/cite&gt;, &lt;cite&gt;Django &lt;span class="caps"&gt;ORM&lt;/span&gt;&lt;/cite&gt;)&lt;/li&gt;
&lt;li&gt;Какие статические анализаторы кода, линтеры для Python ты знаешь? (&lt;cite&gt;mypy&lt;/cite&gt;, &lt;cite&gt;flake8&lt;/cite&gt;)&lt;/li&gt;
&lt;li&gt;Какие web-фреймворки тебе известны? (&lt;cite&gt;Flask&lt;/cite&gt;, &lt;cite&gt;Django&lt;/cite&gt;, &lt;cite&gt;aiohttp&lt;/cite&gt;, &lt;cite&gt;sanic&lt;/cite&gt;,&amp;nbsp;etc.)&lt;/li&gt;
&lt;li&gt;Какие package management tools ты знаешь? (&lt;cite&gt;pip&lt;/cite&gt;, &lt;cite&gt;pipenv&lt;/cite&gt;, &lt;cite&gt;poetry&lt;/cite&gt;,&amp;nbsp;etc.)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id18"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id57"&gt;Алгоритмы&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="id19"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id58"&gt;Временная&amp;nbsp;сложность&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Что такое временная сложность (time&amp;nbsp;complexity)?&lt;/li&gt;
&lt;li&gt;Что такое большая&amp;nbsp;O?&lt;/li&gt;
&lt;li&gt;Какая временная сложность вот такой&amp;nbsp;операции:&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# O(n^2)&lt;/span&gt;
&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
         &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;y&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Какова временная сложность для следующих&amp;nbsp;стейтментов?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="c1"&gt;# где type(s) is list/tuple # O(n)&lt;/span&gt;
&lt;span class="n"&gt;x&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt;&lt;span class="o"&gt;/&lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt; &lt;span class="c1"&gt;# где type(s) is set        # O(1)&lt;/span&gt;
&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;                             &lt;span class="c1"&gt;# O(1)&lt;/span&gt;
&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;insert&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;                             &lt;span class="c1"&gt;# O(n)&lt;/span&gt;
&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;index&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;                               &lt;span class="c1"&gt;# O(1)&lt;/span&gt;
&lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sort&lt;/span&gt;                                 &lt;span class="c1"&gt;# O(n log n)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Можно еще поспрашивать временную сложность операций над &lt;a class="reference external" href="https://wiki.python.org/moin/TimeComplexity"&gt;другими
структурами данных&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="lisp"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id59"&gt;Проверка сбалансированности скобок в&amp;nbsp;Lisp-программе&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Я обожаю программировать на Racket – это диалект Lisp, который
славится большим &lt;a class="reference external" href="https://blog.pilosus.org/images/git-the-princess.png"&gt;количеством скобочек&lt;/a&gt;. Напиши функцию на Python,
которая будет получать на вход текст (строку) и возвращать &lt;cite&gt;True&lt;/cite&gt;,
если скобки в тексте сбалансированы и &lt;cite&gt;False&lt;/cite&gt; в противном&amp;nbsp;случае.&lt;/p&gt;
&lt;p&gt;Примеры сбалансированных&amp;nbsp;скобочек:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;()&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;(())&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;(custom-set-variables &amp;#39;(inhibit-startup-screen t) &amp;#39;(package-selected-packages (quote&lt;/span&gt;
&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sql&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;indent&lt;/span&gt; &lt;span class="n"&gt;magit&lt;/span&gt; &lt;span class="n"&gt;dockerfile&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;yaml&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;gitlab&lt;/span&gt; &lt;span class="n"&gt;markdown&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;lorem&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;ipsum&lt;/span&gt; &lt;span class="n"&gt;jedi&lt;/span&gt;
&lt;span class="n"&gt;elpy&lt;/span&gt; &lt;span class="n"&gt;anaconda&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;mode&lt;/span&gt; &lt;span class="n"&gt;afternoon&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;theme&lt;/span&gt;&lt;span class="p"&gt;))))&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;(hello [world {!}])&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Примеры несбалансированных&amp;nbsp;скобочек:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;(&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;)(&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;())&amp;quot;&lt;/span&gt;
&lt;span class="s2"&gt;&amp;quot;({))&amp;quot;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;balance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;  Return True if string&amp;#39;s parentheses are balanced, False otherwise&lt;/span&gt;

&lt;span class="sd"&gt;  &amp;gt;&amp;gt;&amp;gt; balance(&amp;quot;&amp;quot;)&lt;/span&gt;
&lt;span class="sd"&gt;  True&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;gt;&amp;gt;&amp;gt; balance(&amp;quot;(())&amp;quot;)&lt;/span&gt;
&lt;span class="sd"&gt;  True&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;gt;&amp;gt;&amp;gt; balance(&amp;quot;))((&amp;quot;)&lt;/span&gt;
&lt;span class="sd"&gt;  False&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;gt;&amp;gt;&amp;gt; balance(&amp;quot;()()(())(()())&amp;quot;)&lt;/span&gt;
&lt;span class="sd"&gt;  True&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;gt;&amp;gt;&amp;gt; balance(&amp;quot;(]&amp;quot;)&lt;/span&gt;
&lt;span class="sd"&gt;  False&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;opening&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;(&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;[&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;{&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;closing&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;)&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;]&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;}&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;}&lt;/span&gt;
  &lt;span class="n"&gt;mapping&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;dict&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;zip&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;opening&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;closing&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
  &lt;span class="n"&gt;stack&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
  &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;ch&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;s&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;ch&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;opening&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="n"&gt;stack&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mapping&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;ch&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;
      &lt;span class="k"&gt;elif&lt;/span&gt; &lt;span class="n"&gt;ch&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;closing&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;stack&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="ow"&gt;or&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ch&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;stack&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;pop&lt;/span&gt;&lt;span class="p"&gt;()):&lt;/span&gt;
              &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
  &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="n"&gt;stack&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Если кандидату трудно придумать решение для скобочек разных типов,
можно упростить задание до поверки, например, только круглых&amp;nbsp;скобочек.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id20"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id60"&gt;Базы&amp;nbsp;данных&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="rdbms"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id61"&gt;Зачем нужна &lt;span class="caps"&gt;RDBMS&lt;/span&gt;?&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;У нас стартап из &lt;span class="caps"&gt;CTO&lt;/span&gt;, &lt;span class="caps"&gt;CEO&lt;/span&gt; и одного разработчика. Админов нету. Мы
пишем сервис аутентификации – регистрация пользотелей, проверка прав –
на Python. Зачем нам нужна БД? Почему бы не использовать текстовый
файл?  Стандартная библиотека языка имеет все необходимое для работы с
файлами. Записываем логин и хэш пароля при регистрации, читаем при
запросе доступа. Это просто. Не требует админитрирования, избавляет от
зависимостей.  При сложностях, можно переформулировать вопрос так –
какие существуют механизмы реляционной БД, достаточно сложные для их
самостоятельно реализации, но необходимые для нашего&amp;nbsp;случая?&lt;/p&gt;
&lt;p&gt;От кандидата хочется услышать упоминания следующих&amp;nbsp;механизмов:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;индекс&lt;/li&gt;
&lt;li&gt;связи&amp;nbsp;таблиц&lt;/li&gt;
&lt;li&gt;транзакции&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Про каждый механизм можно поспрашивать отдельно. Например, про индекс
можно&amp;nbsp;спросить:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;временная сложность для поиска по&amp;nbsp;индексу&lt;/li&gt;
&lt;li&gt;в таблице &lt;cite&gt;candidates&lt;/cite&gt; есть колонка &lt;cite&gt;is_interviewed&lt;/cite&gt; с возможными
значениями 0 и 1. какой прирост произодительности для поиска по этой
колонке даст индекс для&amp;nbsp;нее?&lt;/li&gt;
&lt;li&gt;что такое составные индексы? есть ли какие-то правила для запросов
по колонкам, участвующим в составном&amp;nbsp;индексе?&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="mysql-postgresql"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id62"&gt;Запросы в&amp;nbsp;MySQL/PostgreSQL&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;У нас есть сервис по типу iTunes, где можно арендовать/покупать
видео. Вот схема таблиц реляционной базы, положим, в&amp;nbsp;PostgreSQL&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;a class="reference external image-reference" href="https://blog.pilosus.org/images/sql-tables.pdf"&gt;&lt;img alt="Схема таблиц реляционной базы данных для технического собеседования" class="responsive" src="https://blog.pilosus.org/images/sql-tables.jpg" /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;Напиши запрос, который выведет топ-20 фильмов, в которых играет актер John Doe. Запрос должен&amp;nbsp;выводить:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Название&amp;nbsp;фильма&lt;/li&gt;
&lt;li&gt;Язык&amp;nbsp;издания&lt;/li&gt;
&lt;li&gt;Год&amp;nbsp;выпуска&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Результаты нужно упорядочить по убыванию года&amp;nbsp;выпуска.&lt;/p&gt;
&lt;p&gt;(Если нужна подсказка) на основе таблиц: &lt;cite&gt;film&lt;/cite&gt;, &lt;cite&gt;language&lt;/cite&gt;, &lt;cite&gt;film_actor&lt;/cite&gt;, &lt;cite&gt;actor&lt;/cite&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;title&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;release_year&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;film&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;
&lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="k"&gt;language&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;language_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;language_id&lt;/span&gt;
&lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;film_actor&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;fa&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;fa&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;film_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;film_id&lt;/span&gt;
&lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;actor&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;actor_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fa&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;actor_id&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;John&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;AND&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last_name&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Doe&amp;#39;&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;release_year&lt;/span&gt; &lt;span class="k"&gt;DESC&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Напиши запрос, который выведет топ-10 клиентов, которые оставили в
сервисе больше всего денег, но не менее 100 у.е. Запрос должен&amp;nbsp;выводить:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;span class="caps"&gt;ID&lt;/span&gt; и полное имя&amp;nbsp;клиента&lt;/li&gt;
&lt;li&gt;сумму всех заказов&amp;nbsp;юзера&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(Если нужна подсказка) на основе таблиц: &lt;cite&gt;payment&lt;/cite&gt;, &lt;cite&gt;customer&lt;/cite&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;SELECT&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;first_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;last_name&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;SUM&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;money&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;payment&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;
&lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;customer&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;
&lt;span class="k"&gt;GROUP&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="k"&gt;c&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;
&lt;span class="k"&gt;HAVING&lt;/span&gt; &lt;span class="k"&gt;SUM&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;p&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;amount&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;100&lt;/span&gt;
&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;money&lt;/span&gt; &lt;span class="k"&gt;DESC&lt;/span&gt;
&lt;span class="k"&gt;LIMIT&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="nosql"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id63"&gt;Общие представления о&amp;nbsp;NoSQL&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Что такое NoSQL БД? Какие типы NoSQL БД выделяют?&amp;nbsp;Примеры&lt;/p&gt;
&lt;p&gt;Хочется услышать хотя бы самые общие вещи: NoSQL БД &amp;#8212; коллекция
данных в одном из форматов (см. типы ниже). Данные денормализованы,
&lt;span class="caps"&gt;JOIN&lt;/span&gt; реализуют обычно на уровне&amp;nbsp;приложения.&lt;/p&gt;
&lt;p&gt;Типы NoSQL&amp;nbsp;БД:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;key-value store (реализация hash table: Redis,&amp;nbsp;AeroSpike)&lt;/li&gt;
&lt;li&gt;document-store (аналогично key-value, но в качестве значения документ, например, &lt;span class="caps"&gt;JSON&lt;/span&gt;:&amp;nbsp;MongoDB)&lt;/li&gt;
&lt;li&gt;wide column store (HBase,&amp;nbsp;Cassandra)&lt;/li&gt;
&lt;li&gt;graph database&amp;nbsp;(Neo4j)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="redis"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id64"&gt;Общие представления о&amp;nbsp;Redis&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Что такое Redis? Почему его так любят использовать для хранения кэшей?
Чем, с точки зрения хранения данных, он принципиально отличается от,
например, MySQL? Что произойдет с данными в Redis, если прозойдет
рестарт сервера?  Какие существуют механизмы для High Availability в&amp;nbsp;Redis?&lt;/p&gt;
&lt;p&gt;Ожидания от ответа: Redis – это in-memory key-value БД. У нее есть
механизм снапшотов данных из памяти на диск. Для &lt;span class="caps"&gt;HA&lt;/span&gt; используют,
например, Redis&amp;nbsp;Sentinel&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id21"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id65"&gt;Тестирование&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="unit"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id66"&gt;Общие представления о&amp;nbsp;unit-тестировании&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Что это&amp;nbsp;такое?&lt;/li&gt;
&lt;li&gt;Чем отличается от интеграционного, функционального&amp;nbsp;тестирования?&lt;/li&gt;
&lt;li&gt;Какие библиотеки для Python использовал для этого? (&lt;cite&gt;unittest&lt;/cite&gt;,
&lt;cite&gt;pytest&lt;/cite&gt;, в чем&amp;nbsp;разница?)&lt;/li&gt;
&lt;li&gt;Когда нужно писать unit-тест? (в существующем проекте, в новом
проекте, при починке бага, при реализации&amp;nbsp;фичи)&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="mysql"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id67"&gt;Как протестировать функцию, которая изменяет запись в&amp;nbsp;MySQL?&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Есть функция, которая выполняет &lt;cite&gt;&lt;span class="caps"&gt;INSERT&lt;/span&gt;&lt;/cite&gt; в тестовой базе данных MySQL,
которой пользуются все разработчики команды. Нужно написать тест на
эту функцию. Но не хочется вносить изменения в общую базу. Как можно
решить эту&amp;nbsp;проблему?&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;mock&lt;/li&gt;
&lt;li&gt;transaction&amp;nbsp;rollback&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="devops"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id68"&gt;DevOps/Администрирование&lt;/a&gt;&lt;/h2&gt;
&lt;div class="section" id="google-com"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id69"&gt;Проблема с нечитаемым ответом&amp;nbsp;google.com&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Я захожу на &lt;cite&gt;https://www.google.com&lt;/cite&gt; в браузере, открываю исходный код
и вижу вполне читаемый&amp;nbsp;текст.&lt;/p&gt;
&lt;p&gt;Но если я делаю такой запрос через &lt;cite&gt;curl&lt;/cite&gt; то вижу нечто нечитаемое,
похожее на бинарный&amp;nbsp;файл:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&amp;gt; GET / HTTP/2
&amp;gt; Host: www.google.com
&amp;gt; User-Agent: curl/7.58.0
&amp;gt; Accept: */*
&amp;gt; Accept-Encoding: gzip, deflate

%�j��~d+.K�W��me&lt;span class="sb"&gt;`&lt;/span&gt;�,x�x�m�G�67��&lt;span class="sb"&gt;`&lt;/span&gt;&lt;span class="nv"&gt;$#&lt;/span&gt;������~&lt;span class="o"&gt;{&lt;/span&gt;d���&lt;span class="o"&gt;]&lt;/span&gt;�.&lt;span class="err"&gt;&amp;#39;&lt;/span&gt;����
����Q���Mʥu���&amp;lt;�O&lt;span class="o"&gt;)&lt;/span&gt;,�&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;�����,���E�.���_�
&lt;span class="p"&gt;&amp;amp;&lt;/span&gt;�I&lt;span class="se"&gt;\�&lt;/span&gt;�p��#&lt;span class="o"&gt;]&lt;/span&gt;�,�����K+����p�vk
j���k&lt;span class="s2"&gt;&amp;quot;�fe�=�`�J4�I/��m6{�E���;3+�v�BT1T��(W��J��m�yO��&lt;/span&gt;
&lt;span class="s2"&gt;�j��&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Почему так&amp;nbsp;происходит?&lt;/p&gt;
&lt;p&gt;Для&amp;nbsp;интервьюера:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;curl -v &lt;span class="s2"&gt;&amp;quot;https://www.google.com&amp;quot;&lt;/span&gt; --header &lt;span class="s2"&gt;&amp;quot;Accept-Encoding: gzip, deflate&amp;quot;&lt;/span&gt; --output -
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="ip-nginx"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id70"&gt;Топ &lt;span class="caps"&gt;IP&lt;/span&gt; адресов из лога &lt;span class="caps"&gt;NGINX&lt;/span&gt;&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Наш сервис парсят боты. Это создает большую нагрузку, мешающую
нормальным пользователям. Мы решаем забанить ботов по &lt;span class="caps"&gt;IP&lt;/span&gt;-адресам. Для
этого мы хотим составить топ &lt;span class="caps"&gt;IP&lt;/span&gt;-адресов, с которых приходили
запросы. Мы просим админов сделать выгрузку логов за 1&amp;nbsp;час.&lt;/p&gt;
&lt;p&gt;С помощью стандартных &lt;span class="caps"&gt;GNU&lt;/span&gt; utils создай файл с топом &lt;span class="caps"&gt;IP&lt;/span&gt;-адресов в
порядке убывания частоты запросов.  Предположим, что &lt;span class="caps"&gt;IP&lt;/span&gt;-адрес
находится в 9-й колонке лога, колонки отделяются через &lt;cite&gt;t&lt;/cite&gt;&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;awk &lt;span class="s1"&gt;&amp;#39;{print $9}&amp;#39;&lt;/span&gt; nginx.log &lt;span class="p"&gt;|&lt;/span&gt; sort &lt;span class="p"&gt;|&lt;/span&gt; uniq -c &lt;span class="p"&gt;|&lt;/span&gt; awk &lt;span class="s1"&gt;&amp;#39;{print $1&amp;quot;,&amp;quot;$2}&amp;#39;&lt;/span&gt; &lt;span class="p"&gt;|&lt;/span&gt; sort -r -t, -nk1 &amp;gt; bots.csv
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="docker"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id71"&gt;Docker&lt;/a&gt;&lt;/h3&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Что такое докер&amp;nbsp;контейнер?&lt;/li&gt;
&lt;li&gt;В чем отличие от virtualbox и других виртуальных&amp;nbsp;машин?&lt;/li&gt;
&lt;li&gt;Зачем использовать докер, если можно просто скопировать файлы на&amp;nbsp;машину?&lt;/li&gt;
&lt;li&gt;Почему нельзя просто использовать&amp;nbsp;virtualenv?&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id22"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id72"&gt;Архитектура&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;Parental advisory: highly opinionated content&amp;nbsp;(35+)&lt;/strong&gt;&lt;/p&gt;
&lt;div class="section" id="pastebin"&gt;
&lt;h3&gt;&lt;a class="toc-backref" href="#id73"&gt;Проектирование сервиса копипасты&amp;nbsp;pastebin&lt;/a&gt;&lt;/h3&gt;
&lt;div class="section" id="id23"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id74"&gt;Бизнес-описание&lt;/a&gt;&lt;/h4&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Пользователь сабмитит&amp;nbsp;текст&lt;/li&gt;
&lt;li&gt;Текст сохраняется, ему присваивается уникальный &lt;span class="caps"&gt;URL&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;По переходу по сгенерированному &lt;span class="caps"&gt;URL&lt;/span&gt; мы видим&amp;nbsp;текст&lt;/li&gt;
&lt;li&gt;Текст хранится какой-то срок (в&amp;nbsp;минутах)&lt;/li&gt;
&lt;li&gt;Сервис удаляет просроченные&amp;nbsp;тексты&lt;/li&gt;
&lt;li&gt;Сервис&amp;nbsp;высоконагруженый&lt;/li&gt;
&lt;li&gt;Нужна статистика для посещения различных урлов по&amp;nbsp;месяцам&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id24"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id75"&gt;Ограничения и&amp;nbsp;допущения&lt;/a&gt;&lt;/h4&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Пасты только&amp;nbsp;текстовые&lt;/li&gt;
&lt;li&gt;Аналитика может быть не&amp;nbsp;реалтаймовой&lt;/li&gt;
&lt;li&gt;10 миллионов записей в месяц
(3.85 &lt;span class="caps"&gt;RPS&lt;/span&gt;)&lt;/li&gt;
&lt;li&gt;100 миллионов чтений в месяц
(38.5 &lt;span class="caps"&gt;RPS&lt;/span&gt;)&lt;/li&gt;
&lt;li&gt;Железо планируем на 3 года&amp;nbsp;вперед&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
&lt;div class="section" id="id25"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id76"&gt;Ответить соискателю, если&amp;nbsp;спросит&lt;/a&gt;&lt;/h4&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Средний размер пасты&amp;nbsp;1Kb&lt;/li&gt;
&lt;li&gt;Короткая ссылка длиной 7 байт в&amp;nbsp;БД&lt;/li&gt;
&lt;li&gt;&lt;span class="caps"&gt;TTL&lt;/span&gt; ссылки в минутах 4 байта в&amp;nbsp;БД&lt;/li&gt;
&lt;li&gt;Время создания ссылки 5&amp;nbsp;байт&lt;/li&gt;
&lt;li&gt;Путь хранения файла пасты - 255&amp;nbsp;байт&lt;/li&gt;
&lt;li&gt;Итого: 1.27 Кбайт на 1&amp;nbsp;пасту&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1.27 Гб пасты в месяц
За 3 года:
- 36 * 12.7 = 457 Гб пасты
- 36 * 10 = 360 млн&amp;nbsp;урлов&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="id26"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id77"&gt;Крупноблочная схема&amp;nbsp;архитектуры&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;  Client
    |
    V
Load Balancer
    |
    V
 Web Server (Reverse Proxy, i.e. Nginx)
  |      |
  V      V
Write   Read                                Analytics (MapReduce)
API     API---------------------------       |         |
 |       |        |                  |       |         |
 |       V        |                  |       |         |
 |      Cache     |                  |       |         V
 ------------------------------      |       |       SQL for Analytics
 V                |            |     |       |
SQL-----------    |            V     V       V
 |_Master    |    |           Object (File) Store
 |_Slave     V    |
            SQL   V
 ^              Read-only Replica
 |
 |
Periodic Task
(remove expired)
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="write-api"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id78"&gt;Write &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Генерит &lt;span class="caps"&gt;URL&lt;/span&gt;, проверяет уникальность в &lt;span class="caps"&gt;SQL&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Если уникальное, делает &lt;span class="caps"&gt;INSERT&lt;/span&gt; в таблицу, иначе идет в п.&amp;nbsp;1&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;shortlink&lt;/span&gt; &lt;span class="nb"&gt;char&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;
&lt;span class="n"&gt;expiration_in_minutes&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;
&lt;span class="n"&gt;created_at&lt;/span&gt; &lt;span class="n"&gt;datetime&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;
&lt;span class="n"&gt;paste_path&lt;/span&gt; &lt;span class="nb"&gt;varchar&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;255&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;NOT&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;
&lt;span class="k"&gt;PRIMARY&lt;/span&gt; &lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;shortlink&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;INDEX&lt;/span&gt; &lt;span class="n"&gt;shortlink_idx&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;pastes&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;shortlink&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;USING&lt;/span&gt; &lt;span class="n"&gt;BTREE&lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;INDEX&lt;/span&gt; &lt;span class="n"&gt;created_at_idx&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;pastes&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;created_at&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;USING&lt;/span&gt; &lt;span class="n"&gt;BTREE&lt;/span&gt;&lt;span class="p"&gt;;;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id27"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id79"&gt;Создание уникального&amp;nbsp;урла&lt;/a&gt;&lt;/h4&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Берем рандомную строку (или &lt;span class="caps"&gt;IP&lt;/span&gt; address юзера + timestamp) и вычисляем &lt;span class="caps"&gt;MD5&lt;/span&gt;&lt;/li&gt;
&lt;li&gt;Кодируем &lt;cite&gt;Base 62&lt;/cite&gt; (как Base 64 но без&amp;nbsp;escape-символов)&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;base_encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;62&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="n"&gt;digits&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
    &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="n"&gt;num&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
      &lt;span class="n"&gt;remainder&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;modulo&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;push&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;remainder&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
      &lt;span class="n"&gt;num&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;divide&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;num&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;base&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
    &lt;span class="n"&gt;digits&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;digits&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;reverse&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;От строки в Base 62 можем взять 7 символов это даст 62**7 возможных
значений (это намного больше чем 360 миллионов урлов, которые мы
планируем на 3&amp;nbsp;года)&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;base_encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;md5&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ip_address&lt;/span&gt;&lt;span class="o"&gt;+&lt;/span&gt;&lt;span class="n"&gt;timestamp&lt;/span&gt;&lt;span class="p"&gt;))[:&lt;/span&gt;&lt;span class="n"&gt;URL_LENGTH&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id28"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id80"&gt;Запрос к Write &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ curl -X POST https://pastebin.com/api/v1.0/paste &lt;span class="se"&gt;\&lt;/span&gt;
       --data &lt;span class="s1"&gt;&amp;#39;{ &amp;quot;expiration_in_minutes&amp;quot;: &amp;quot;60&amp;quot;, &amp;quot;paste_contents&amp;quot;: &amp;quot;My paste&amp;quot; }&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id29"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id81"&gt;Ответ Write &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;shortlink&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;xJlsmeT&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="read-api"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id82"&gt;Запрос к Read &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ curl https://pastebin.com/api/v1.0/paste?shortlink&lt;span class="o"&gt;=&lt;/span&gt;xJlsmeT
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id30"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id83"&gt;Ответ Read &lt;span class="caps"&gt;API&lt;/span&gt;&lt;/a&gt;&lt;/h4&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;paste&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;My paste&amp;quot;&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;created_at&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;YYYY-MM-DD HH:MM:SS&amp;quot;&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;expiration_in_minutes&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;60&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id31"&gt;
&lt;h4&gt;&lt;a class="toc-backref" href="#id84"&gt;Аналитика&lt;/a&gt;&lt;/h4&gt;
&lt;p&gt;Поскольку не нужен реалтайм, будем брать логи с реверс прокси и
скартимливать их в&amp;nbsp;MapReduce&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;HitCounts&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;MRJob&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;extract_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Extract the generated url from the log line.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="o"&gt;...&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;extract_year_month&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Return the year and month portions of the timestamp.&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="o"&gt;...&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;mapper&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;_&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Parse each log line, extract and transform relevant lines.&lt;/span&gt;

&lt;span class="sd"&gt;        Emit key value pairs of the form:&lt;/span&gt;

&lt;span class="sd"&gt;        (2016-01, url0), 1&lt;/span&gt;
&lt;span class="sd"&gt;        (2016-01, url0), 1&lt;/span&gt;
&lt;span class="sd"&gt;        (2016-01, url1), 1&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="n"&gt;url&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extract_url&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="n"&gt;period&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;extract_year_month&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;line&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;period&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;url&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;reducer&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Sum values for each key.&lt;/span&gt;

&lt;span class="sd"&gt;        (2016-01, url0), 2&lt;/span&gt;
&lt;span class="sd"&gt;        (2016-01, url1), 1&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;sum&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;values&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="id32"&gt;
&lt;h2&gt;&lt;a class="toc-backref" href="#id85"&gt;Полезные&amp;nbsp;ссылки&lt;/a&gt;&lt;/h2&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;a class="reference external" href="https://www.toptal.com/python/interview-questions"&gt;Toptal Python Interview&amp;nbsp;Questions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Python Interview Questions (&lt;a class="reference external" href="https://luminousmen.com/post/6"&gt;junior&lt;/a&gt;, &lt;a class="reference external" href="https://luminousmen.com/post/7"&gt;middle&lt;/a&gt;, &lt;a class="reference external" href="https://luminousmen.com/post/8"&gt;senior&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://github.com/checkcheckzz/system-design-interview"&gt;System design&amp;nbsp;interview&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="https://docs.python.org/3.8/reference/index.html"&gt;The Python Language&amp;nbsp;Reference&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="reference external" href="http://www.postgresqltutorial.com/"&gt;PostgreSQL&amp;nbsp;Tutorial&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="python"></category><category term="interview"></category><category term="ru"></category></entry><entry><title>PostgreSQL: update by spliting result set into evenly sized chunks using window function</title><link href="https://blog.pilosus.org/posts/2019/12/07/postgresql-update-rows-in-chunks/" rel="alternate"></link><published>2019-12-07T14:58:00+03:00</published><updated>2019-12-07T14:58:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-12-07:/posts/2019/12/07/postgresql-update-rows-in-chunks/</id><summary type="html">&lt;p class="first last"&gt;How do you update result set by spliting it into evenly
sized chunks using window function&amp;nbsp;row_number()&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Sometimes you need to process your database data in batches. It may be
absolutely necessary to retrieve the rows from the database in your
application first, and then process it in the code iterating over the
results. In this case you split the result set from the database query
into chunks in you code like in the following Python&amp;nbsp;snippet:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;typing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;Any&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Sequence&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Iterator&lt;/span&gt;

&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;get_chunks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sequence&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Sequence&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Any&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="n"&gt;chunk_size&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Iterator&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Any&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="nb"&gt;range&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sequence&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="n"&gt;chunk_size&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;yield&lt;/span&gt; &lt;span class="n"&gt;sequence&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;chunk_size&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

&lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;ids_chunk&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;get_chunks&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;sequence&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;account_ids_from_db&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;chunk_size&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="c1"&gt;# do something with a chunk here&lt;/span&gt;
    &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;account_id&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;ids_chunk&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="o"&gt;...&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Depending on the number of rows to be retrieved from the database, the
&lt;span class="caps"&gt;SQL&lt;/span&gt; query plan and some other factors, you may need to use &lt;cite&gt;&lt;span class="caps"&gt;LIMIT&lt;/span&gt;&lt;/cite&gt; and
&lt;cite&gt;&lt;span class="caps"&gt;OFFSET&lt;/span&gt;&lt;/cite&gt; clauses in your &lt;span class="caps"&gt;SQL&lt;/span&gt; and make multiple queries, instead of
selecting all the rows at once. It saves you some memory in the&amp;nbsp;application.&lt;/p&gt;
&lt;p&gt;But sometimes you may fully rely on the &lt;span class="caps"&gt;DBMS&lt;/span&gt; features to process data
in batches. Let&amp;#8217;s take a look at the&amp;nbsp;example.&lt;/p&gt;
&lt;div class="section" id="problem-update-blacklist-expiration-timestamps-in-chunks"&gt;
&lt;h2&gt;Problem: update blacklist expiration timestamps in&amp;nbsp;chunks&lt;/h2&gt;
&lt;p&gt;We&amp;#8217;ve got a black list of customers. Each item in the blacklist table
in the database may have an optional value in expiration timestamp
column. If the value is &lt;cite&gt;&lt;span class="caps"&gt;NULL&lt;/span&gt;&lt;/cite&gt; then a client considered permanentely
blacklisted. Otherwise a row will be removed from the blacklist table
(possibly by a cronjob task), once an expiration timestamp is less
than current&amp;nbsp;time.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Problem:&lt;/strong&gt; we want to set an expiration date to all permanently
blacklisted customers so that they get removed from the list in
batches of size 10 a day. When splitting into chunks, we want to order
the rows so that the customers with the most recent suspicious
activity come first. The activity log defined in another database&amp;nbsp;table.&lt;/p&gt;
&lt;p&gt;In other words we want to update all rows in the table where some
conditions met (&lt;cite&gt;expiry&lt;/cite&gt; value equals to &lt;cite&gt;&lt;span class="caps"&gt;NULL&lt;/span&gt;&lt;/cite&gt; in this case). But we
have to do it in chunks of the constant&amp;nbsp;size.&lt;/p&gt;
&lt;p&gt;We can do it like in the example above: select all the rows that
satisfy the condition, then iterate over batches of size 10 and
update. But in this case there&amp;#8217;s nothing that a modern &lt;span class="caps"&gt;RDBMS&lt;/span&gt; couldn&amp;#8217;t
achieve by itself, without writing any extra code. So let&amp;#8217;s see how to
do it using pure PostgreSQL 9+&amp;nbsp;query.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="solution-postgresql-query-for-updating-rows-in-chunks-using-row-number-function"&gt;
&lt;h2&gt;Solution: PostgreSQL query for updating rows in chunks using row_number()&amp;nbsp;function&lt;/h2&gt;
&lt;p&gt;First, let&amp;#8217;s see how the table&amp;#8217;s schema may look&amp;nbsp;like.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;CREATE&lt;/span&gt; &lt;span class="k"&gt;TABLE&lt;/span&gt; &lt;span class="n"&gt;balcklist&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
  &lt;span class="n"&gt;customer_id&lt;/span&gt; &lt;span class="nb"&gt;INTEGER&lt;/span&gt; &lt;span class="k"&gt;PRIMARY&lt;/span&gt; &lt;span class="k"&gt;KEY&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="n"&gt;expiry&lt;/span&gt; &lt;span class="k"&gt;TIMESTAMP&lt;/span&gt; &lt;span class="k"&gt;WITHOUT&lt;/span&gt; &lt;span class="n"&gt;TIME&lt;/span&gt; &lt;span class="k"&gt;ZONE&lt;/span&gt; &lt;span class="k"&gt;default&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
  &lt;span class="k"&gt;timestamp&lt;/span&gt; &lt;span class="k"&gt;TIMESTAMP&lt;/span&gt; &lt;span class="k"&gt;WITHOUT&lt;/span&gt; &lt;span class="n"&gt;TIME&lt;/span&gt; &lt;span class="k"&gt;ZONE&lt;/span&gt; &lt;span class="k"&gt;default&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;now&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="k"&gt;at&lt;/span&gt; &lt;span class="n"&gt;time&lt;/span&gt; &lt;span class="k"&gt;zone&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;utc&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;A log of suspicious activity is stored in &lt;cite&gt;suspicious_activity&lt;/cite&gt;
database table that we can join using &lt;cite&gt;customer_id&lt;/cite&gt; column.&lt;/p&gt;
&lt;p&gt;The algorithm we are going to use when writing final &lt;span class="caps"&gt;SQL&lt;/span&gt; query is the&amp;nbsp;following:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Join activity table, filter and select the data to be&amp;nbsp;updated&lt;/li&gt;
&lt;li&gt;Get row numbers using PostgreSQL&amp;#8217;s window function &lt;a class="reference external" href="http://www.postgresqltutorial.com/postgresql-row_number/"&gt;row_number()&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Get batch numbers using simple arithmetic operations (row number
integer division by chunk&amp;nbsp;size)&lt;/li&gt;
&lt;li&gt;Get new expiry timestamps using current batch number and
PostgreSQL&amp;#8217;s &lt;a class="reference external" href="http://www.postgresqltutorial.com/postgresql-interval/"&gt;interval type&lt;/a&gt; arithmetic&amp;nbsp;operations&lt;/li&gt;
&lt;li&gt;Wrap up all previous steps into a subquery; update &lt;cite&gt;expiry&lt;/cite&gt; column
for customers selected in the&amp;nbsp;subquery.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The final &lt;span class="caps"&gt;SQL&lt;/span&gt; query then is the&amp;nbsp;following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;-- main: update expiry timestamp column in chunks&lt;/span&gt;
&lt;span class="k"&gt;UPDATE&lt;/span&gt; &lt;span class="n"&gt;blacklist&lt;/span&gt;
&lt;span class="k"&gt;SET&lt;/span&gt; &lt;span class="n"&gt;expiry&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;subquery&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;new_expiry_timestamp&lt;/span&gt;
&lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
  &lt;span class="c1"&gt;-- subquery 3: get new expiration timestamps based on a chunk number&lt;/span&gt;
  &lt;span class="k"&gt;SELECT&lt;/span&gt;
    &lt;span class="n"&gt;row_num&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;row_batched&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;customer_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;NOW&lt;/span&gt;&lt;span class="p"&gt;()::&lt;/span&gt;&lt;span class="k"&gt;TIMESTAMP&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;row_batched&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt; &lt;span class="nb"&gt;INTERVAL&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;1 day&amp;#39;&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;new_expiry_timestamp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;latest_suspicious_activity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;blacklist_timestamp&lt;/span&gt;
  &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="c1"&gt;-- subquery 2: get chunk numbers based on a row number&lt;/span&gt;
    &lt;span class="k"&gt;SELECT&lt;/span&gt;
      &lt;span class="n"&gt;row_num&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;row_num&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;/&lt;/span&gt; &lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;row_batched&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="n"&gt;customer_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="n"&gt;latest_suspicious_activity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
      &lt;span class="n"&gt;blacklist_timestamp&lt;/span&gt;
    &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
      &lt;span class="c1"&gt;-- subquery 1: get row numbers&lt;/span&gt;
      &lt;span class="k"&gt;SELECT&lt;/span&gt;
        &lt;span class="n"&gt;row_number&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt; &lt;span class="n"&gt;OVER&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;latest_suspicious_activity&lt;/span&gt; &lt;span class="k"&gt;DESC&lt;/span&gt; &lt;span class="n"&gt;NULLS&lt;/span&gt; &lt;span class="k"&gt;LAST&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;row_num&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;customer_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;latest_suspicious_activity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
        &lt;span class="n"&gt;blacklist_timestamp&lt;/span&gt;
      &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="c1"&gt;-- subquery 0: order blacklist&lt;/span&gt;
        &lt;span class="k"&gt;SELECT&lt;/span&gt;
          &lt;span class="n"&gt;blacklist&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;customer_id&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="k"&gt;MAX&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;suspicious_activity&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;created&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;latest_suspicious_activity&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
          &lt;span class="n"&gt;blacklist&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="k"&gt;timestamp&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;blacklist_timestamp&lt;/span&gt;
        &lt;span class="k"&gt;FROM&lt;/span&gt; &lt;span class="n"&gt;blacklist&lt;/span&gt;
        &lt;span class="k"&gt;INNER&lt;/span&gt; &lt;span class="k"&gt;JOIN&lt;/span&gt; &lt;span class="n"&gt;suspicious_activity&lt;/span&gt; &lt;span class="k"&gt;ON&lt;/span&gt; &lt;span class="n"&gt;blacklist&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;suspicious_activity&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;
        &lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;blacklist&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;expiry_timestamp&lt;/span&gt; &lt;span class="k"&gt;is&lt;/span&gt; &lt;span class="k"&gt;NULL&lt;/span&gt;
        &lt;span class="k"&gt;GROUP&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;blacklist&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;
        &lt;span class="k"&gt;ORDER&lt;/span&gt; &lt;span class="k"&gt;BY&lt;/span&gt; &lt;span class="n"&gt;latest_suspicious_activity&lt;/span&gt; &lt;span class="k"&gt;DESC&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;blacklist_timestamp&lt;/span&gt; &lt;span class="k"&gt;DESC&lt;/span&gt;
       &lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;ordered&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;numbered&lt;/span&gt;
  &lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;offsetted&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;AS&lt;/span&gt; &lt;span class="n"&gt;subquery&lt;/span&gt;
&lt;span class="k"&gt;WHERE&lt;/span&gt; &lt;span class="n"&gt;blacklist&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;subquery&lt;/span&gt;&lt;span class="p"&gt;.&lt;/span&gt;&lt;span class="n"&gt;customer_id&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The &lt;span class="caps"&gt;SQL&lt;/span&gt; above may not be &lt;span class="caps"&gt;SQL&lt;/span&gt;-standard compatible and is guaranteed to
work on PostgreSQL 9.6 or&amp;nbsp;later.&lt;/p&gt;
&lt;p&gt;Comments, labels and the algorithm above should make the query
self-explanatory, although some basic knowledge of &lt;span class="caps"&gt;SQL&lt;/span&gt; is needed to
understand what the query really&amp;nbsp;does.&lt;/p&gt;
&lt;p&gt;Basically, we need only &lt;cite&gt;new_expiry_timestamp&lt;/cite&gt; and &lt;cite&gt;customer_id&lt;/cite&gt;
columns from the subquery. But some extra columns are passed from the
deepest subquery all the way to the top
(e.g. &lt;cite&gt;latest_suspicious_activity&lt;/cite&gt;, &lt;cite&gt;row_num&lt;/cite&gt;, etc), so that you can
run the subquery only and see how new expiry timestamps are calculated
before doing any updates to the data. &lt;cite&gt;&lt;span class="caps"&gt;BEGIN&lt;/span&gt;/&lt;span class="caps"&gt;ROLLBACK&lt;/span&gt;&lt;/cite&gt; may also be of
great help&amp;nbsp;here.&lt;/p&gt;
&lt;p&gt;All in all, the query&amp;nbsp;above:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Easy to&amp;nbsp;read&lt;/li&gt;
&lt;li&gt;Requires no extra code and does all the batch processing using PostgreSQL query&amp;nbsp;language&lt;/li&gt;
&lt;li&gt;Executed much faster than when doing extra processing in your app&amp;#8217;s&amp;nbsp;code&lt;/li&gt;
&lt;li&gt;Can easily take advantage of PostgreSQL transaction and &lt;a class="reference external" href="https://www.2ndquadrant.com/en/blog/postgresql-anti-patterns-read-modify-write-cycles/"&gt;atomic&amp;nbsp;updates&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="sql"></category><category term="postgres"></category><category term="python"></category></entry><entry><title>Switching between Kubernetes clusters and namespaces: kubectx and kubens</title><link href="https://blog.pilosus.org/posts/2019/09/28/kubernetes-context-switch/" rel="alternate"></link><published>2019-09-28T14:12:00+03:00</published><updated>2019-09-28T14:12:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-09-28:/posts/2019/09/28/kubernetes-context-switch/</id><summary type="html">&lt;p class="first last"&gt;Save your time by using command line tools kubectx and
kubens in multi-cluster environment with more than one
default namespace&amp;nbsp;each.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Having more than one Kubernetes cluster is a common pattern. You may
have one cluster dedicated to production environment, another one for
staging and the third one for testing&amp;nbsp;environment.&lt;/p&gt;
&lt;p&gt;The same thing with Kubernetes namespaces: it&amp;#8217;s great abstraction
allowing you to separate workloads by their purpose. You may have
multiple namespaces for different test environments or a dedicated
namespace for app-related pods and another namespace for logging and
monitoring&amp;nbsp;services.&lt;/p&gt;
&lt;p&gt;Configuring access to multiple Kubernetes clusters is well documented
in official &lt;a class="reference external" href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/"&gt;k8s documentation&lt;/a&gt;. Still switching context and
specifying namespace for each &lt;tt class="docutils literal"&gt;kubectl&lt;/tt&gt; invocation is tedious. This
is where &lt;a class="reference external" href="https://github.com/ahmetb/kubectx/"&gt;kubectx and kubens&lt;/a&gt; come into play. But let&amp;#8217;s configure
multiple clusters&amp;nbsp;first.&lt;/p&gt;
&lt;div class="section" id="kubernetes-configuration-file-multiple-clusters"&gt;
&lt;h2&gt;Kubernetes configuration file: multiple&amp;nbsp;clusters&lt;/h2&gt;
&lt;p&gt;You find an extensive guide in the &lt;a class="reference external" href="https://kubernetes.io/docs/tasks/access-application-cluster/configure-access-multiple-clusters/"&gt;k8s documentation&lt;/a&gt;. All in all,
your &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;~/.kube/config&lt;/span&gt;&lt;/tt&gt; should include three&amp;nbsp;lists:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Clusters&lt;/li&gt;
&lt;li&gt;Users&lt;/li&gt;
&lt;li&gt;Contexts&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Context defines a cluster, it&amp;#8217;s namespace and a user. When the user
switches to the context, he or she is working with the cluster and the
namespaces of the&amp;nbsp;context.&lt;/p&gt;
&lt;p&gt;Each cluster may define master node&amp;#8217;s server hostname and optionaly
other entities like base64-encoded&amp;nbsp;certificates.&lt;/p&gt;
&lt;p&gt;Users may also be defined by autherntication options that covered in
&lt;a class="reference external" href="https://kubernetes.io/docs/reference/access-authn-authz/authentication/"&gt;Kubernetes authentication guide&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;An example configuration file for two Kubernetes clusters and two
users with different authentication types may look like&amp;nbsp;this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;span class="nt"&gt;clusters&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;cluster&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;certificate-authority-data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;YOUR-CERT-AUTHORITY-DATA-CLUSTER-1&lt;/span&gt;
    &lt;span class="nt"&gt;server&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;https://YOUR-SERVER-ADDRESS-1&lt;/span&gt;
  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cluster1&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;cluster&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;certificate-authority-data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;YOUR-CERT-AUTHORITY-DATA-CLUSTER-2&lt;/span&gt;
    &lt;span class="nt"&gt;server&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;https://YOUR-SERVER-ADDRESS-2&lt;/span&gt;
  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cluster2&lt;/span&gt;
&lt;span class="nt"&gt;contexts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;context&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;cluster&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cluster1&lt;/span&gt;
    &lt;span class="nt"&gt;namespace&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;production&lt;/span&gt;
    &lt;span class="nt"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;user1&lt;/span&gt;
  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;context1&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;context&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;cluster&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;cluster2&lt;/span&gt;
    &lt;span class="nt"&gt;namespace&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;test&lt;/span&gt;
    &lt;span class="nt"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;user2&lt;/span&gt;
  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;context2&lt;/span&gt;
&lt;span class="nt"&gt;current-context&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;context1&lt;/span&gt;
&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Config&lt;/span&gt;
&lt;span class="nt"&gt;preferences&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;{}&lt;/span&gt;
&lt;span class="nt"&gt;users&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;user1&lt;/span&gt;
  &lt;span class="nt"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;client-certificate-data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;YOUR-CLIENT-CERT-DATA-1&lt;/span&gt;
    &lt;span class="nt"&gt;client-key-data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;YOUR-CLIENT-KEY-DATA-1&lt;/span&gt;
&lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;user2&lt;/span&gt;
  &lt;span class="nt"&gt;user&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;auth-provider&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="nt"&gt;config&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="nt"&gt;access-token&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;YOUR-ACCESS-TOKEN&lt;/span&gt;
        &lt;span class="nt"&gt;cmd-args&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;config config-helper --format=json&lt;/span&gt;
        &lt;span class="nt"&gt;cmd-path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/PATH/TO/google-cloud-sdk/bin/gcloud&lt;/span&gt;
        &lt;span class="nt"&gt;expiry&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;quot;2019-09-28T00:00:00Z&amp;quot;&lt;/span&gt;
        &lt;span class="nt"&gt;expiry-key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;{.credential.token_expiry}&amp;#39;&lt;/span&gt;
        &lt;span class="nt"&gt;token-key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;&amp;#39;{.credential.access_token}&amp;#39;&lt;/span&gt;
      &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;gcp&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="kubectx-and-kubens"&gt;
&lt;h2&gt;kubectx and&amp;nbsp;kubens&lt;/h2&gt;
&lt;p&gt;Although switching context is easy with &lt;tt class="docutils literal"&gt;kubectl config &lt;span class="pre"&gt;use-context&lt;/span&gt;&lt;/tt&gt;,
working with both contexts and namespaces require way too many key strokes!
&lt;a class="reference external" href="https://github.com/ahmetb/kubectx/"&gt;kubectx and kubens&lt;/a&gt; command line tools allow you to switch context this&amp;nbsp;easy:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ kubectx context2  # the same as kubectl config use-context context2
&lt;/pre&gt;
&lt;p&gt;Chaning context with &lt;tt class="docutils literal"&gt;kubectx&lt;/tt&gt; changes your config file&amp;#8217;s
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;current-context&lt;/span&gt;&lt;/tt&gt; field the same way the &lt;tt class="docutils literal"&gt;kubectl config
&lt;span class="pre"&gt;use-context&lt;/span&gt;&lt;/tt&gt; does.&lt;/p&gt;
&lt;p&gt;Now, instead of typing &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--namespace&lt;/span&gt; &lt;span class="pre"&gt;your-namespace&lt;/span&gt;&lt;/tt&gt; or &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;-n&lt;/span&gt;
&lt;span class="pre"&gt;your-namespace&lt;/span&gt;&lt;/tt&gt; in every &lt;tt class="docutils literal"&gt;kubectl&lt;/tt&gt; invokation, change namespace
once with &lt;tt class="docutils literal"&gt;kubens&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ kubens test2     # your current k8s namespace is test2 now
$ kubectl get po   # the same as invoking with --namespace test2
# kubens test1     # your current k8s namespace is test1 now
&lt;/pre&gt;
&lt;p&gt;Using &lt;tt class="docutils literal"&gt;kubectx&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;kubens&lt;/tt&gt; allow you to save some key strokes
and really come in handy when you switch over multiple Kubernetes
clusters with more than one default&amp;nbsp;namespace.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="k8s"></category><category term="kubectx"></category><category term="kubens"></category></entry><entry><title>Application configs: files or environment variables? Actually both!</title><link href="https://blog.pilosus.org/posts/2019/06/07/application-configs-files-or-environment-variables-actually-both/" rel="alternate"></link><published>2019-06-07T20:30:00+03:00</published><updated>2019-06-07T20:30:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-06-07:/posts/2019/06/07/application-configs-files-or-environment-variables-actually-both/</id><summary type="html">&lt;p&gt;App configuration is highly opinionated topic. It&amp;#8217;s technology stack-
and infrastructure-dependent. When it comes to configs there are a few
parties with a possible conflict of interests. Software developers
want an easy access to app&amp;#8217;s configuration, versioning, readability,
language support for the config format. Security guys want security …&lt;/p&gt;</summary><content type="html">&lt;p&gt;App configuration is highly opinionated topic. It&amp;#8217;s technology stack-
and infrastructure-dependent. When it comes to configs there are a few
parties with a possible conflict of interests. Software developers
want an easy access to app&amp;#8217;s configuration, versioning, readability,
language support for the config format. Security guys want security!
&lt;span class="caps"&gt;SRE&lt;/span&gt;/Administrators want an easy deployment and scaling as well as
infrastructure native support for configuration format of
choice. Managers, well, they probably want to smile at conferences and
don&amp;#8217;t want you all to spend too much time on such a miserable question
like configuration&amp;nbsp;architecture!&lt;/p&gt;
&lt;p&gt;In software development some things change rapidly. Ideas, manifests
and frameworks rise and fall. So lets review what&amp;#8217;s application
configuration today and what it could&amp;nbsp;be.&lt;/p&gt;
&lt;div class="section" id="environment-variables-good-and-bad-parts"&gt;
&lt;h2&gt;Environment variables: good and bad&amp;nbsp;parts&lt;/h2&gt;
&lt;p&gt;&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Environment_variable"&gt;Environment variables&lt;/a&gt; (&lt;em&gt;env vars&lt;/em&gt; or &lt;em&gt;env&lt;/em&gt;) are often recommended
as the only way to store application configs (see &lt;a class="reference external" href="https://12factor.net/config"&gt;The Twelve-Factor
App&lt;/a&gt; rule &lt;span class="caps"&gt;III&lt;/span&gt;). Envs are &lt;strong&gt;good&lt;/strong&gt; bacause they&amp;nbsp;are:&lt;/p&gt;
&lt;div class="section" id="secure"&gt;
&lt;h3&gt;Secure&lt;/h3&gt;
&lt;p&gt;Environment variables are set by who&amp;#8217;s responsible for the deployment
environment: by developer on local machines, by
&lt;span class="caps"&gt;SRE&lt;/span&gt;/Administrator/DevOps in production. With env you won&amp;#8217;t compromise
your production credentials even if your code&amp;#8217;s leaked to the
public. It&amp;#8217;s also harder for developers to break something in
production, because they simply don&amp;#8217;t have access to production&amp;nbsp;credentials.&lt;/p&gt;
&lt;p&gt;Messing up with envs in the runtime may also be tricky, as you cannot
change environment variables for the parent process in *nix&amp;nbsp;systems.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="universal"&gt;
&lt;h3&gt;Universal&lt;/h3&gt;
&lt;p&gt;Environment variables are everywhere! On &lt;span class="caps"&gt;GNU&lt;/span&gt;/Linux, MacOS,
Windows. Every production-ready programming language supports envs out
of&amp;nbsp;box.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="easy-to-use"&gt;
&lt;h3&gt;Easy to&amp;nbsp;use&lt;/h3&gt;
&lt;p&gt;Env is flat. Basically it&amp;#8217;s a key-value pair with string value. So
loading envs is&amp;nbsp;easy.&lt;/p&gt;
&lt;p&gt;There are some &lt;strong&gt;bad&lt;/strong&gt; things about envs too. Envs&amp;nbsp;are:&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="unexpressive"&gt;
&lt;h3&gt;Unexpressive&lt;/h3&gt;
&lt;p&gt;The flip side of the &amp;#8220;easy&amp;#8221; coin is unexpressiveness. Envs are flat
key-value strings. You cannot store the whole config as en env. So you
need to read envs in your code and then construct some sort of the
final configuration, possible overly&amp;nbsp;complex.&lt;/p&gt;
&lt;p&gt;Flat env structure also get you into a grey area of bad variable
names. Consider the following &lt;span class="caps"&gt;YAML&lt;/span&gt;&amp;nbsp;config:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
cluster:
  host_weight:
    node00.example.com: 0.8
    node01.example.com: 0.8
    node02.example.com: 1.0
    node03.example.com: 0.5
db: 1
user: app
password: my_password
&lt;/pre&gt;
&lt;p&gt;It may translate to the following envs to substitute values in the
config&amp;nbsp;above:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
CLUSTER_HOST_NODE_00=0.8
CLUSTER_HOST_NODE_01=0.8
CLUSTER_HOST_NODE_02=1.0
CLUSTER_HOST_NODE_03=0.5
CLUSTER_DB=1
CLUSTER_USER=app
CLUSTER_PASSWORD=my_password
&lt;/pre&gt;
&lt;p&gt;So, you still store some kind of configuration file in your app&amp;#8217;s
version control system (&lt;span class="caps"&gt;VCS&lt;/span&gt;). Usually it&amp;#8217;s a module in you programming
language (e.g. &lt;tt class="docutils literal"&gt;config.py&lt;/tt&gt; in Python) with some language-specific
data structures and even some logic. Values (at least some of them)
are stored as envs with quite awkward names. These configs are much
less readable as the &lt;span class="caps"&gt;YAML&lt;/span&gt;&amp;nbsp;above.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="need-to-be-stored-somewhere-eventually"&gt;
&lt;h3&gt;Need to be stored somewhere&amp;nbsp;eventually&lt;/h3&gt;
&lt;p&gt;Envrironment variables are stored somewhere eventually: in your admins
repository, orchestration system&amp;#8217;s manifest files that also checked in
the &lt;span class="caps"&gt;VCS&lt;/span&gt;. So even separated from the app&amp;#8217;s code repo, envs are still
stored in files that potentially could be accessed by more people than
they&amp;nbsp;should.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="may-break-release-determinism"&gt;
&lt;h3&gt;May break release&amp;nbsp;determinism&lt;/h3&gt;
&lt;p&gt;If you use config files checked into your app&amp;#8217;s repository, your
config is also a part of the app&amp;#8217;s releases. You can effectively
rollback to a stable release whenever&amp;nbsp;needed.&lt;/p&gt;
&lt;p&gt;In the case of envs your app&amp;#8217;s releases are separated from the
configs. Ideally environment variables should be versioned too. Both
app&amp;#8217;s and config&amp;#8217;s releases should be synchornized somehow. Otherwise
your release determinism may break, rollback to previous versions with
zero downtime may become&amp;nbsp;difficult.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="configuration-files-good-and-bad-parts"&gt;
&lt;h2&gt;Configuration files: good and bad&amp;nbsp;parts&lt;/h2&gt;
&lt;p&gt;Configuration files have their strengths and weakness too. First, the
&lt;strong&gt;good&lt;/strong&gt; things. Files&amp;nbsp;are:&lt;/p&gt;
&lt;div class="section" id="readable"&gt;
&lt;h3&gt;Readable&lt;/h3&gt;
&lt;p&gt;You don&amp;#8217;t write config files as program&amp;#8217;s module (e.g. &lt;tt class="docutils literal"&gt;config.py&lt;/tt&gt;
in Python). Instead you use some language-agnostic format for humans
like &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;YAML&lt;/span&gt;&lt;/tt&gt;. Then you have both readability and (to some extent)
separation code and&amp;nbsp;configs.&lt;/p&gt;
&lt;p&gt;You write clean, self-sufficient configs. No more ugly things&amp;nbsp;like:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
HOSTNAME = os.environ.get('DB_HOSTNAME', 'db.example.com')
&lt;/pre&gt;
&lt;p&gt;Developers often group config files by deployment enviroment:
&lt;tt class="docutils literal"&gt;testing.yaml&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;development.yaml&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;production.yaml&lt;/tt&gt;. Sometimes
you cannot reach 100% &lt;a class="reference external" href="https://12factor.net/dev-prod-parity"&gt;deploy environments parity&lt;/a&gt;. So having all
configs at hand may help when fixing a&amp;nbsp;bug.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="part-of-release"&gt;
&lt;h3&gt;Part of&amp;nbsp;release&lt;/h3&gt;
&lt;p&gt;As I said earlier, if a config is checked into app&amp;#8217;s repository it a
part of app release history. It makes your app releases more
deterministic allowing to rollback to earlier releases if necessary
with no extra&amp;nbsp;efforts.&lt;/p&gt;
&lt;p&gt;There are &lt;strong&gt;bad&lt;/strong&gt; things about files&amp;nbsp;too:&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="formats-hell"&gt;
&lt;h3&gt;Formats&amp;nbsp;hell&lt;/h3&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;XML&lt;/span&gt;&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;YAML&lt;/span&gt;&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;ini&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;TOML&lt;/span&gt;&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;JSON&lt;/span&gt;&lt;/tt&gt;, you name it! Probably
you don&amp;#8217;t have a luxuary of having the only one way to do it in your
language. Even in &lt;tt class="docutils literal"&gt;JavaScript&lt;/tt&gt; &lt;span class="caps"&gt;JSON&lt;/span&gt; is not the only configuration
format in use. But in popular general-purpose languages like
&lt;tt class="docutils literal"&gt;Python&lt;/tt&gt; it&amp;#8217;s even&amp;nbsp;worse.&lt;/p&gt;
&lt;p&gt;In a complex project with legacy components you may find all sorts of
configuration file formats. It&amp;#8217;s&amp;nbsp;annoying.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="insecure"&gt;
&lt;h3&gt;Insecure&lt;/h3&gt;
&lt;p&gt;Junior developers, people on probation period, QAs, admins, maybe even
developers from other teams and departments may have access to your
app&amp;#8217;s secrets when they are in the config files checked into a
&lt;span class="caps"&gt;VCS&lt;/span&gt;. That&amp;#8217;s a huge security problem, even if your network operation
center engineers, admins and devops do a great job isolating
production services and&amp;nbsp;networks.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="taking-good-parts-from-both-envs-and-files"&gt;
&lt;h2&gt;Taking good parts from both envs and&amp;nbsp;files&lt;/h2&gt;
&lt;p&gt;But what if we take the good parts from both enrionment variables and
config files, combine them and throw away the bad parts? Sounds great,
doesn&amp;#8217;t&amp;nbsp;it?&lt;/p&gt;
&lt;p&gt;First, we need to take a closer look at what&amp;#8217;s really important when
it comes to &lt;em&gt;security&lt;/em&gt;. Actually, it&amp;#8217;s credentials (login/password,
private &lt;span class="caps"&gt;API&lt;/span&gt; keys, cryptographic certificates, etc.) that if kept in
secret solve most of the problems that your config files stored in the
&lt;span class="caps"&gt;VCS&lt;/span&gt; have. If your production database hostname leaks but username and
password are kept in secret you are probably okay. Brutforce attacks,
unpatched software vulnerabilities are still real. But your customer
database isn&amp;#8217;t leaked immediately even if bad guys know your database
&lt;span class="caps"&gt;URL&lt;/span&gt;.&lt;/p&gt;
&lt;p&gt;Second, we really want to have nice language-agnostic non-flat file
format for our configs. It&amp;#8217;s opinionated, but I personally think that
&lt;a class="reference external" href="https://yaml.org/"&gt;&lt;span class="caps"&gt;YAML&lt;/span&gt;&lt;/a&gt; is superior to all other formats. It&amp;#8217;s&amp;nbsp;beautiful!&lt;/p&gt;
&lt;p&gt;So what if we use a &lt;span class="caps"&gt;YAML&lt;/span&gt; file and substitute our secrets with
environment variables&amp;nbsp;tokens?&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;db&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;login&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;user&lt;/span&gt;
  &lt;span class="nt"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;${DB_PASSWORD}&lt;/span&gt;
&lt;span class="nt"&gt;mail&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;login&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;user&lt;/span&gt;
  &lt;span class="nt"&gt;password&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;${MAIL_PASSWORD:-my_default_password}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then our app loads the &lt;span class="caps"&gt;YAML&lt;/span&gt; and &lt;strong&gt;interpolates environment variables&lt;/strong&gt;
in&amp;nbsp;it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;db&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;login&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;my_db_password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;},&lt;/span&gt;
&lt;span class="s1"&gt;&amp;#39;mail&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;login&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;user&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;my_default_password&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;}}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In the above snippet a database password has been loaded from the
&lt;tt class="docutils literal"&gt;$DB_PASSWORD&lt;/tt&gt; environment variable. Email password had to be loaded
from &lt;tt class="docutils literal"&gt;$MAIL_PASSWORD&lt;/tt&gt;. It&amp;#8217;s defined as Bash-style env with default
value. It seems that at the time of config loading the
&lt;tt class="docutils literal"&gt;$MAIL_PASSWORD&lt;/tt&gt; wasn&amp;#8217;t set so a default value
&lt;tt class="docutils literal"&gt;'my_default_password'&lt;/tt&gt; is&amp;nbsp;used.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="proof-of-concept"&gt;
&lt;h2&gt;Proof of&amp;nbsp;concept&lt;/h2&gt;
&lt;p&gt;As a proof of concept I&amp;#8217;ve just released a Python library called
&lt;a class="reference external" href="https://github.com/pilosus/piny"&gt;Piny&lt;/a&gt;. It does exactly&amp;nbsp;this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Reads your &lt;span class="caps"&gt;YAML&lt;/span&gt;-config file marked up with environments&amp;nbsp;variables&lt;/li&gt;
&lt;li&gt;Interpolates environment variables with their&amp;nbsp;values&lt;/li&gt;
&lt;li&gt;Creates a Python object with configuration ready for use in your&amp;nbsp;app&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;When using &lt;a class="reference external" href="https://github.com/pilosus/piny"&gt;Piny&lt;/a&gt; consider best practices for your configuration&amp;nbsp;files:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Maintain healthy security/convenience balance for your&amp;nbsp;config&lt;/li&gt;
&lt;li&gt;Mark up entity as an environment variable in your &lt;span class="caps"&gt;YAML&lt;/span&gt; if and only
if it really is a &lt;em&gt;secret&lt;/em&gt; (login/passwords, private &lt;span class="caps"&gt;API&lt;/span&gt; keys,
crypto keys, certificates, or maybe &lt;span class="caps"&gt;DB&lt;/span&gt; hostname too? You&amp;nbsp;decide)&lt;/li&gt;
&lt;li&gt;Once config loaded by Piny, validate it using your favourite
validation tool (some integrations are coming in the future&amp;nbsp;releases)&lt;/li&gt;
&lt;li&gt;Store your config files in the version control systems along with
you app&amp;#8217;s&amp;nbsp;code.&lt;/li&gt;
&lt;li&gt;Environment variables are set by whomever is responsible for the
deployment. Modern orchestration systems like &lt;a class="reference external" href="https://kubernetes.io/"&gt;Kubernetes&lt;/a&gt; make
it easy to keep envs secure (see &lt;a class="reference external" href="https://kubernetes.io/docs/concepts/configuration/secret/"&gt;Secrets&lt;/a&gt; and &lt;a class="reference external" href="https://www.vaultproject.io/"&gt;Vault&lt;/a&gt;).&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;Piny stands for &lt;em&gt;Piny is not &lt;span class="caps"&gt;YAML&lt;/span&gt;&lt;/em&gt;. It&amp;#8217;s not only a library name, but
also a name for &lt;span class="caps"&gt;YAML&lt;/span&gt; marked up with environment&amp;nbsp;variables.&lt;/p&gt;
&lt;p&gt;You can download Piny at &lt;a class="reference external" href="https://pypi.org/project/piny/"&gt;PyPi&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="architecture"></category><category term="config"></category><category term="k8s"></category></entry><entry><title>Helm stable/prometheus-operator: adding new scraping targets and troubleshooting</title><link href="https://blog.pilosus.org/posts/2019/06/01/prometheus-operator-no-active-targets/" rel="alternate"></link><published>2019-06-01T14:12:00+03:00</published><updated>2019-06-01T14:12:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-06-01:/posts/2019/06/01/prometheus-operator-no-active-targets/</id><summary type="html">&lt;p class="first last"&gt;How to add new services for Prometheus to scrape and what to
do if no active targets found. Post covers Prometheus
deployed in Kubernetes cluster using Helm
stable/prometheus-operator&amp;nbsp;chart.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Today I Learned (&lt;span class="caps"&gt;TIL&lt;/span&gt;) that Kubernetes named ports usage may be quite&amp;nbsp;frustrating.&lt;/p&gt;
&lt;p&gt;Recently I&amp;#8217;ve deployed monitoring stack (Prometheus, Grafana) in
Kubernetes using Helm &lt;a class="reference external" href="https://github.com/helm/charts/tree/master/stable/prometheus-operator"&gt;stable/prometheus-operator&lt;/a&gt;. Setting up
monitoring for Kubernetes cluster itself is covered by &lt;a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-digitalocean-kubernetes-cluster-monitoring-with-helm-and-prometheus-operator"&gt;this&lt;/a&gt;
wonderful guide. But for setting up monitoring for other services one
need to learn what &lt;a class="reference external" href="https://cloud.google.com/blog/products/containers-kubernetes/best-practices-for-building-kubernetes-operators-and-stateful-apps"&gt;Kubernetes Operator&lt;/a&gt; is, and create his/her own
&lt;tt class="docutils literal"&gt;ServiceMonitor&lt;/tt&gt; for &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;Prometheus-Operator&lt;/span&gt;&lt;/tt&gt; (see
&lt;a class="reference external" href="https://github.com/helm/charts/tree/master/stable/prometheus-operator"&gt;stable/prometheus-operator&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;ServiceMotitor&lt;/tt&gt; is a custom resource. It tells Prometheus what k8s
&lt;tt class="docutils literal"&gt;Service&lt;/tt&gt; exposes metrics and where: service label selectors, its
namespace, path, port, etc. Say, we&amp;#8217;ve got a web application
&lt;tt class="docutils literal"&gt;Service&lt;/tt&gt; in the &lt;tt class="docutils literal"&gt;default&lt;/tt&gt; namespace with label &lt;tt class="docutils literal"&gt;app: pili&lt;/tt&gt; that
exposes &lt;tt class="docutils literal"&gt;/metrics&lt;/tt&gt; endpoint on the named port called &lt;tt class="docutils literal"&gt;uwsgi&lt;/tt&gt; . We
are going to deploy &lt;tt class="docutils literal"&gt;ServiceMonitor&lt;/tt&gt; for Prometheus to scrape the
metrics every 15 seconds in &lt;tt class="docutils literal"&gt;monitoring&lt;/tt&gt; namespace and with certain
labels. Then we apply a&amp;nbsp;manifest:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;monitoring.coreos.com/v1&lt;/span&gt;
&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ServiceMonitor&lt;/span&gt;
&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;monitoring-pili&lt;/span&gt;
  &lt;span class="nt"&gt;namespace&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;monitoring&lt;/span&gt;
  &lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pili-service-monitor&lt;/span&gt;
&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;matchLabels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="c1"&gt;# Target app service&lt;/span&gt;
      &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pili&lt;/span&gt;
  &lt;span class="nt"&gt;endpoints&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;interval&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;15s&lt;/span&gt;
    &lt;span class="nt"&gt;path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/metrics&lt;/span&gt;
    &lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;uwsgi&lt;/span&gt;
  &lt;span class="nt"&gt;namespaceSelector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;matchNames&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;default&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Following this steps I&amp;#8217;m sucessfully deployed a few service monitors:
for a PostgreSQL cluster, RabbitMQ, ElasticSearch, etc. All of them
allowed Prometheus to scrape metrics just as expected. But my own
application still showed 0 active targets in Prometheus. I could
manually &lt;tt class="docutils literal"&gt;curl&lt;/tt&gt; my app service&amp;#8217;s &lt;tt class="docutils literal"&gt;/metrics&lt;/tt&gt; endpoint and see that
all the metrics are exposed correctly. Still Prometheus was unable to
scrape&amp;nbsp;it.&lt;/p&gt;
&lt;p&gt;I doublechecked label selectors as they often happen to be a culrpit
(see this &lt;a class="reference external" href="https://stackoverflow.com/questions/52991038/how-to-create-a-servicemonitor-for-prometheus-operator"&gt;StackOverflow&lt;/a&gt; question). Everything was fine. I could see
that my app&amp;#8217;s &lt;tt class="docutils literal"&gt;Service&lt;/tt&gt; exposed Kubernetes endpoints&amp;nbsp;correctly:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ kubectl get endpoint --namespace default
...
pili  10.244.0.136:8080,10.244.0.144:8080,10.244.0.185:8080  6d16h
...
&lt;/pre&gt;
&lt;p&gt;Eventually, it turned out that &lt;tt class="docutils literal"&gt;ServiceMonitor&lt;/tt&gt; didn&amp;#8217;t see my app
service&amp;#8217;s &lt;strong&gt;named port&lt;/strong&gt;!&lt;/p&gt;
&lt;p&gt;My &lt;tt class="docutils literal"&gt;Service&lt;/tt&gt; manifest look like&amp;nbsp;this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pili&lt;/span&gt;
  &lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pili&lt;/span&gt;
&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ClusterIP&lt;/span&gt;
  &lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;protocol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
    &lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
    &lt;span class="nt"&gt;targetPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;uwsgi&lt;/span&gt;
  &lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pili-web&lt;/span&gt;
    &lt;span class="nt"&gt;tier&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In that case &lt;tt class="docutils literal"&gt;Service&lt;/tt&gt; targeted named port &lt;tt class="docutils literal"&gt;uwsgi&lt;/tt&gt; from app&amp;#8217;s
&lt;tt class="docutils literal"&gt;Deployment&lt;/tt&gt;. The port was also used in &lt;tt class="docutils literal"&gt;Ingress&lt;/tt&gt; sucessfully:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
...
- backend:
    serviceName: pili
    servicePort: uwsgi
...
&lt;/pre&gt;
&lt;p&gt;It wasn&amp;#8217;t untill I &lt;em&gt;explicitly&lt;/em&gt; named the port (with the same name) in
&lt;tt class="docutils literal"&gt;Service&lt;/tt&gt; that &lt;tt class="docutils literal"&gt;ServiceMonitor&lt;/tt&gt; could discover my target. So I
rewrote my &lt;tt class="docutils literal"&gt;Service&lt;/tt&gt; manifest:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pili&lt;/span&gt;
  &lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pili&lt;/span&gt;
&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;type&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ClusterIP&lt;/span&gt;
  &lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;uwsgi&lt;/span&gt;
    &lt;span class="nt"&gt;protocol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
    &lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
    &lt;span class="nt"&gt;targetPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;uwsgi&lt;/span&gt;
  &lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;pili-web&lt;/span&gt;
    &lt;span class="nt"&gt;tier&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;backend&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So the only change that really helped was this&amp;nbsp;one:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;   ports:
&lt;span class="gd"&gt;-  - protocol: TCP&lt;/span&gt;
&lt;span class="gi"&gt;+  - name: uwsgi&lt;/span&gt;
&lt;span class="gi"&gt;+    protocol: TCP&lt;/span&gt;
     port: 8080
     targetPort: uwsgi
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Service&amp;#8217;s port should be explicitly named even if has the same name as
target port&amp;#8217;s name. &lt;tt class="docutils literal"&gt;ServiceMonitor&lt;/tt&gt; understands only explicitly
named &lt;tt class="docutils literal"&gt;Service&lt;/tt&gt; ports, although other entities, e.g. an &lt;tt class="docutils literal"&gt;Ingress&lt;/tt&gt;,
work well without explicit naming.&amp;nbsp;Beware!&lt;/p&gt;
&lt;p&gt;&lt;span class="caps"&gt;P.S.&lt;/span&gt; At the time of writing I used &lt;tt class="docutils literal"&gt;kubectl v1.14.2&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;helm v2.14.0&lt;/tt&gt;.&lt;/p&gt;
</content><category term="Blog"></category><category term="k8s"></category><category term="helm"></category><category term="prometheus"></category><category term="kubernetes-operator"></category><category term="til"></category></entry><entry><title>Grafana Dashboard for Prometheus official Python client with Flask App metrics</title><link href="https://blog.pilosus.org/posts/2019/06/01/grafana-dashboard-flask-app/" rel="alternate"></link><published>2019-06-01T11:00:00+03:00</published><updated>2019-06-01T20:50:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-06-01:/posts/2019/06/01/grafana-dashboard-flask-app/</id><summary type="html">&lt;p class="first last"&gt;A dashboard with 12 panels showing &lt;span class="caps"&gt;RPS&lt;/span&gt;, latency, errors for
web app&amp;#8217;s endpoints as well as host and app&amp;#8217;s resource usage
and some extra&amp;nbsp;details.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;I&amp;#8217;ve just &lt;a class="reference external" href="https://github.com/pilosus/prometheus-client-python-app-grafana-dashboard"&gt;open-sourced&lt;/a&gt; my Grafana dashboard. The dashboard designed
for a Flask web application that exposes metrics with
my &lt;a class="reference external" href="https://github.com/pilosus/flask_prometheus_metrics"&gt;flask_prometheus_metrics&lt;/a&gt; Flask&amp;nbsp;extension.&lt;/p&gt;
&lt;p&gt;Dashboard aimed at the apps deployed with Kubernetes, although it can
be easily tweaked to be&amp;nbsp;infrastructure-agnostic.&lt;/p&gt;
&lt;a class="reference external image-reference" href="https://raw.githubusercontent.com/pilosus/prometheus-client-python-app-grafana-dashboard/master/docs/flask-app-1.png"&gt;&lt;img alt="Grfana dashboard: RPS and latency panels" class="responsive" src="https://raw.githubusercontent.com/pilosus/prometheus-client-python-app-grafana-dashboard/master/docs/flask-app-1.png" /&gt;&lt;/a&gt;
&lt;p&gt;12 dasboard&amp;#8217;s panels covers the following&amp;nbsp;metrics:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Requests per second per host, endpoint, &lt;span class="caps"&gt;HTTP&lt;/span&gt; method&amp;nbsp;etc.&lt;/li&gt;
&lt;li&gt;Latency&lt;/li&gt;
&lt;li&gt;Percentiles (latency within which certain percent of requests&amp;nbsp;served)&lt;/li&gt;
&lt;li&gt;Number of 4xx, 5xx errors per&amp;nbsp;second&lt;/li&gt;
&lt;li&gt;Error count by&amp;nbsp;endpoint&lt;/li&gt;
&lt;li&gt;&lt;span class="caps"&gt;CPU&lt;/span&gt; usage per&amp;nbsp;host&lt;/li&gt;
&lt;li&gt;Memory usage per&amp;nbsp;host&lt;/li&gt;
&lt;li&gt;Open file descriptors per&amp;nbsp;host&lt;/li&gt;
&lt;li&gt;App&amp;#8217;s uptime per&amp;nbsp;host&lt;/li&gt;
&lt;li&gt;App&amp;#8217;s version per&amp;nbsp;host&lt;/li&gt;
&lt;li&gt;App&amp;#8217;s deployment environment (e.g. development, staging, production) per&amp;nbsp;host&lt;/li&gt;
&lt;li&gt;Python interpretor version per&amp;nbsp;host&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;a class="reference external image-reference" href="https://raw.githubusercontent.com/pilosus/prometheus-client-python-app-grafana-dashboard/master/docs/flask-app-2.png"&gt;&lt;img alt="Grfana dashboard: errors and resource usage" class="responsive" src="https://raw.githubusercontent.com/pilosus/prometheus-client-python-app-grafana-dashboard/master/docs/flask-app-2.png" /&gt;&lt;/a&gt;
&lt;p&gt;Dashboard also provides&amp;nbsp;variables:&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Prometheus&amp;nbsp;datasource&lt;/li&gt;
&lt;li&gt;Time&amp;nbsp;interval&lt;/li&gt;
&lt;li&gt;Kubernetes pod&amp;nbsp;name&lt;/li&gt;
&lt;li&gt;App&amp;#8217;s&amp;nbsp;endpoint&lt;/li&gt;
&lt;li&gt;&lt;span class="caps"&gt;HTTP&lt;/span&gt;&amp;nbsp;method&lt;/li&gt;
&lt;li&gt;Percentile&lt;/li&gt;
&lt;li&gt;&lt;span class="caps"&gt;HTTP&lt;/span&gt; status code for&amp;nbsp;errors&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;a class="reference external image-reference" href="https://raw.githubusercontent.com/pilosus/prometheus-client-python-app-grafana-dashboard/master/docs/flask-app-3.png"&gt;&lt;img alt="Grfana dashboard: app's information" class="responsive" src="https://raw.githubusercontent.com/pilosus/prometheus-client-python-app-grafana-dashboard/master/docs/flask-app-3.png" /&gt;&lt;/a&gt;
&lt;p&gt;The variables allow to change some panels charts grouing, intervals,
labels&amp;nbsp;selection.&lt;/p&gt;
&lt;p&gt;Usage is&amp;nbsp;easy:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Install &lt;a class="reference external" href="https://github.com/pilosus/flask_prometheus_metrics"&gt;flask_prometheus_metrics&lt;/a&gt; exporter to your Flask&amp;nbsp;application&lt;/li&gt;
&lt;li&gt;Make Prometheus scraping your app&amp;#8217;s &lt;tt class="docutils literal"&gt;/metrics&lt;/tt&gt; endpoint&lt;/li&gt;
&lt;li&gt;Import &lt;a class="reference external" href="https://github.com/pilosus/prometheus-client-python-app-grafana-dashboard/blob/master/flask-web-app.json"&gt;flask-web-app.json&lt;/a&gt; at &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;https://&amp;lt;your-grafana-domain&amp;gt;.tld/dashboard/import&lt;/span&gt;&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;If you do not deploy your app in Kubernetes you may need to tweak
&lt;a class="reference external" href="https://github.com/pilosus/prometheus-client-python-app-grafana-dashboard/blob/master/flask-web-app.json"&gt;flask-web-app.json&lt;/a&gt; &lt;tt class="docutils literal"&gt;pod&lt;/tt&gt; labels to meet your needs. Instead of
&lt;tt class="docutils literal"&gt;pod&lt;/tt&gt; you may use &lt;tt class="docutils literal"&gt;instance&lt;/tt&gt; or &lt;tt class="docutils literal"&gt;hostname&lt;/tt&gt; or other label name
depending on how your Prometheus handle your app&amp;#8217;s&amp;nbsp;hostname.&lt;/p&gt;
</content><category term="Blog"></category><category term="prometheus"></category><category term="grafana"></category><category term="visualization"></category><category term="metrics"></category></entry><entry><title>Pelican plugin: word count and reading time statistics</title><link href="https://blog.pilosus.org/posts/2019/05/28/pelican-plugin-word-count/" rel="alternate"></link><published>2019-05-28T12:03:00+03:00</published><updated>2019-05-28T12:03:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-05-28:/posts/2019/05/28/pelican-plugin-word-count/</id><summary type="html">&lt;p class="first last"&gt;An open-source plugin for Python Pelican blog platform. It
extends blog posts with reading statistics: number of words
and reading time in&amp;nbsp;minutes.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;I&amp;#8217;ve just released a tiny library for &lt;a class="reference external" href="https://docs.getpelican.com/en/stable/index.html"&gt;Pelican&lt;/a&gt; blog platform called
&lt;a class="reference external" href="https://github.com/pilosus/pilosus_pelican_word_count/"&gt;word count&lt;/a&gt;. It&amp;#8217;s a plugin that extends articles and pages with the
basic text statistics: number of words and approximate reading time in
minutes. You can use it then in your &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;HTML&lt;/span&gt;&lt;/tt&gt; template. My own
&lt;a class="reference external" href="https://github.com/pilosus/pilosus-pelican-theme/"&gt;theme&lt;/a&gt; supports it&amp;nbsp;too.&lt;/p&gt;
&lt;p&gt;It turned out that there is another plugin called &lt;a class="reference external" href="https://github.com/getpelican/pelican-plugins/tree/master/post_stats"&gt;post_stats&lt;/a&gt;. It
provides even more extensive stats. But I think it&amp;#8217;s an overkill for
my purposes: I don&amp;#8217;t need text readability features, they won&amp;#8217;t work
for non-English text, they slow down site generation. I also suspect
that &lt;tt class="docutils literal"&gt;post_stats&lt;/tt&gt; is run against all the contents, including
non-text ones, which is also not so good for plugin&amp;nbsp;performance.&lt;/p&gt;
&lt;p&gt;My &lt;a class="reference external" href="https://github.com/pilosus/pilosus_pelican_word_count/"&gt;word count&lt;/a&gt; plugin explicitly runs against text entities
(articles, pages, drafts and translations). It calculates basic
statistics I need for my blog. And that&amp;#8217;s&amp;nbsp;it.&lt;/p&gt;
&lt;p&gt;I prefer to add Pelican plugins as &lt;tt class="docutils literal"&gt;git submodule&lt;/tt&gt;. It makes it
easier to &lt;tt class="docutils literal"&gt;git clone&lt;/tt&gt; the entire blog with all its themes and
plugins on the new machine. It&amp;#8217;s also make it easier to version
plugins and themes you use. Just check out your submodule to the
version needed. Check out my article &lt;a class="reference external" href="https://blog.pilosus.org/posts/2019/05/01/pelican-blog-up-and-running/"&gt;Pelican blog: up and running&lt;/a&gt; for more&amp;nbsp;details.&lt;/p&gt;
&lt;p&gt;You can donwload (or better &lt;tt class="docutils literal"&gt;git clone&lt;/tt&gt;) &lt;tt class="docutils literal"&gt;word_count&lt;/tt&gt; plugin on
the &lt;a class="reference external" href="https://github.com/pilosus/pilosus_pelican_word_count/"&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
</content><category term="Blog"></category><category term="pelican"></category><category term="blog"></category><category term="python"></category><category term="plugin"></category></entry><entry><title>Kubernetes Ingress Troubleshooting: Error Obtaining Endpoints for Service</title><link href="https://blog.pilosus.org/posts/2019/05/26/k8s-ingress-troubleshooting/" rel="alternate"></link><published>2019-05-26T12:00:00+03:00</published><updated>2019-05-26T12:00:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-05-26:/posts/2019/05/26/k8s-ingress-troubleshooting/</id><summary type="html">&lt;p class="first last"&gt;Kubernetes introduces a bunch of abstractions. It&amp;#8217;s easy to
mess up with them in your manifest files. Yet Kubernetes
provides great tools for troubleshooting. Here is how you
can tackle problems with Ingress and Service&amp;nbsp;resources.&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Recently I&amp;#8217;ve set up an &lt;a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-nginx-ingress-with-cert-manager-on-digitalocean-kubernetes"&gt;Nginx Ingress Controller&lt;/a&gt; on my DigitalOcean
Kubernetes cluster. It&amp;#8217;s make up of a replica set of pods that run an
Nginx web server and watch for &lt;tt class="docutils literal"&gt;Ingress&lt;/tt&gt; resource
deployment. Controller also fires up a &lt;tt class="docutils literal"&gt;LoadBalancer&lt;/tt&gt; service that
routes and balances external traffic to the Nginx pods. In turn Nginx
pods route traffic to your app pods in accordance with rules from
app&amp;#8217;s Ingress manifest. All in all, the whole topology is the&amp;nbsp;following:&lt;/p&gt;
&lt;div class="figure"&gt;
&lt;a class="reference external image-reference" href="https://blog.pilosus.org/images/ingress.png"&gt;&lt;img alt="Kubernetes cluster with Nginx Ingress Controller" class="responsive" src="https://blog.pilosus.org/images/ingress.png" /&gt;&lt;/a&gt;
&lt;/div&gt;
&lt;p&gt;The problem is Kubernetes uses quite a few abstractions (Pods,
Deployments, Services, Ingress, Roles, etc.) so that it&amp;#8217;s easy to make
a mistake. The good news is Kubernetes gives you great tools to
troubleshoot problems you have bumped into. In my case the first
response I&amp;#8217;ve got after I set up an Ingress Controller was Nginx&amp;#8217;s 503
error code (service temporarily unavailable). Here is how I&amp;#8217;ve fixed&amp;nbsp;it.&lt;/p&gt;
&lt;div class="section" id="kubernetes-nginx-ingress-controller-troubleshooting"&gt;
&lt;h2&gt;Kubernetes Nginx Ingress Controller&amp;nbsp;Troubleshooting&lt;/h2&gt;
&lt;p&gt;Let&amp;#8217;s assume we are using &lt;a class="reference external" href="https://github.com/kubernetes/ingress-nginx"&gt;Kubernetes Nginx Ingress Controller&lt;/a&gt; as
there are other implementations too. Its components get deployed into
their own &lt;tt class="docutils literal"&gt;Namespace&lt;/tt&gt; called &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;ingress-nginx&lt;/span&gt;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;The first thing you are going to see to find out why a service
responds with 503 status code is Nginx logs. Let&amp;#8217;s see a list of pods
with&amp;nbsp;Nginx:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ ~ kubectl get pods --namespace ingress-nginx
NAME                                        READY   STATUS    RESTARTS   AGE
nginx-ingress-controller-5694ccb578-l82hc   1/1     Running   0          21h
&lt;/pre&gt;
&lt;p&gt;Having only a signle pod it&amp;#8217;s easier to skim through the logs with
&lt;tt class="docutils literal"&gt;kubectl logs&lt;/tt&gt;. If there were multiple pods it would be much more
convenient to have &lt;span class="caps"&gt;ELK&lt;/span&gt; (or &lt;a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-elasticsearch-fluentd-and-kibana-efk-logging-stack-on-kubernetes"&gt;&lt;span class="caps"&gt;EFK&lt;/span&gt;&lt;/a&gt;) stack running in the&amp;nbsp;cluster.&lt;/p&gt;
&lt;p&gt;Looking up the log we&amp;nbsp;see:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ kubectl logs -f nginx-ingress-controller-5694ccb578-l82hc --namespace ingress-nginx
...
Error obtaining Endpoints for Service &amp;quot;&amp;lt;namespace&amp;gt;/&amp;lt;your-app-service&amp;gt;&amp;quot;:
no object matching key &amp;quot;&amp;lt;namespace&amp;gt;/&amp;lt;your-app-service&amp;gt;&amp;quot; in local store
...
&lt;/pre&gt;
&lt;p&gt;Let&amp;#8217;s see what endpoints we&amp;nbsp;have:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ kubectl get endpoints --namespace &amp;lt;namespace&amp;gt;
...
&amp;lt;namespace&amp;gt; &amp;lt;your-app-service&amp;gt;  &amp;lt;none&amp;gt; 21h
...
&lt;/pre&gt;
&lt;p&gt;Indeed, our service have no endpoints. That means that a &lt;a class="reference external" href="https://kubernetes.io/docs/concepts/services-networking/service/"&gt;Service&lt;/a&gt;
deployed to expose your app&amp;#8217;s pods doesn&amp;#8217;t actually have a virtual &lt;span class="caps"&gt;IP&lt;/span&gt;
address. There are two cases when a service doesn&amp;#8217;t have an &lt;span class="caps"&gt;IP&lt;/span&gt;: it&amp;#8217;s
either &lt;a class="reference external" href="https://kubernetes.io/docs/concepts/services-networking/service/#headless-services"&gt;headless&lt;/a&gt; or you have messed up with &lt;a class="reference external" href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/#label-selectors"&gt;label selectors&lt;/a&gt;.
&lt;strong&gt;Check your label selectors carefully!&lt;/strong&gt; You know what you&amp;#8217;re doing
when using headless services. So most likely it&amp;#8217;s a wrong label name
or value that doesn&amp;#8217;t match your app&amp;#8217;s pods! So was in my own case, by
the&amp;nbsp;way.&lt;/p&gt;
&lt;p&gt;Once you fixed your labels reapply your app&amp;#8217;s service and check
endpoints once&amp;nbsp;again:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ kubectl get endpoints --namespace &amp;lt;namespace&amp;gt;
...
&amp;lt;namespace&amp;gt;  &amp;lt;your-app-service&amp;gt;  10.244.0.136:8080,10.244.0.144:8080,10.244.0.185:8080  21h
...
&lt;/pre&gt;
&lt;p&gt;Now our service exposes three local &lt;span class="caps"&gt;IP&lt;/span&gt;:port pairs of type
&lt;tt class="docutils literal"&gt;ClusterIP&lt;/tt&gt;! &lt;tt class="docutils literal"&gt;ClusterIP&lt;/tt&gt; is a &lt;a class="reference external" href="https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types"&gt;service type&lt;/a&gt; that fits best to
the setup with an Ingress Controller and a Load Balancer routing
external traffic to&amp;nbsp;it.&lt;/p&gt;
&lt;p&gt;Request to a service now returns 200 &lt;span class="caps"&gt;OK&lt;/span&gt;.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="k8s"></category><category term="ingress"></category><category term="digitalocean"></category></entry><entry><title>Kubernetes Persistent Volumes: How to List and Copy Files and Directories</title><link href="https://blog.pilosus.org/posts/2019/05/24/k8s-volumes-list-copy/" rel="alternate"></link><published>2019-05-24T20:15:00+03:00</published><updated>2019-05-24T20:15:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-05-24:/posts/2019/05/24/k8s-volumes-list-copy/</id><summary type="html">&lt;p&gt;You have created a Kubernetes workload, e.g. &lt;tt class="docutils literal"&gt;Deployment&lt;/tt&gt;, that uses
a &lt;tt class="docutils literal"&gt;PersistentVolume&lt;/tt&gt; and a &lt;tt class="docutils literal"&gt;PersistentVolumeClaim&lt;/tt&gt;. It&amp;#8217;s
provisioned by your cloud platform, say, DigitalOcean. You want to
know what space is available to you, you want to browse files and
directories on your Volume, and you want to copy …&lt;/p&gt;</summary><content type="html">&lt;p&gt;You have created a Kubernetes workload, e.g. &lt;tt class="docutils literal"&gt;Deployment&lt;/tt&gt;, that uses
a &lt;tt class="docutils literal"&gt;PersistentVolume&lt;/tt&gt; and a &lt;tt class="docutils literal"&gt;PersistentVolumeClaim&lt;/tt&gt;. It&amp;#8217;s
provisioned by your cloud platform, say, DigitalOcean. You want to
know what space is available to you, you want to browse files and
directories on your Volume, and you want to copy something from the
Volume to your host machine. How do you do&amp;nbsp;it?&lt;/p&gt;
&lt;p&gt;First, find out your pvc&amp;#8217;s &lt;tt class="docutils literal"&gt;mountPath&lt;/tt&gt;. Your data sits
there. Second, you can access it from the pod that uses the
&lt;tt class="docutils literal"&gt;PersistentVolumeClaim&lt;/tt&gt;. Fire up a terminal on the pod and use your
favourite tools like &lt;tt class="docutils literal"&gt;ls&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;df&lt;/tt&gt; to list files or see stats of
the volume usage. Just make sure that an image your pod container is
using has all the tools you&amp;nbsp;need.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# open bash on the pod&lt;/span&gt;
$ kubectl &lt;span class="nb"&gt;exec&lt;/span&gt; -it redis-master-0 bash

&lt;span class="c1"&gt;# see disk usage stats&lt;/span&gt;
&lt;span class="c1"&gt;# volume is mounted under /data&lt;/span&gt;
I have no name!@redis-master-0:/$ df -h
Filesystem                                                                Size  Used Avail Use% Mounted on
overlay                                                                   158G  &lt;span class="m"&gt;6&lt;/span&gt;.5G  145G   &lt;span class="m"&gt;5&lt;/span&gt;% /
tmpfs                                                                      64M     &lt;span class="m"&gt;0&lt;/span&gt;   64M   &lt;span class="m"&gt;0&lt;/span&gt;% /dev
tmpfs                                                                     &lt;span class="m"&gt;3&lt;/span&gt;.9G     &lt;span class="m"&gt;0&lt;/span&gt;  &lt;span class="m"&gt;3&lt;/span&gt;.9G   &lt;span class="m"&gt;0&lt;/span&gt;% /sys/fs/cgroup
/dev/vda1                                                                 158G  &lt;span class="m"&gt;6&lt;/span&gt;.5G  145G   &lt;span class="m"&gt;5&lt;/span&gt;% /health
/dev/disk/by-id/scsi-0DO_Volume_pvc-ae31a80d-7b23-11e9-bffb-0ab3124b7b1c  &lt;span class="m"&gt;7&lt;/span&gt;.9G   36M  &lt;span class="m"&gt;7&lt;/span&gt;.4G   &lt;span class="m"&gt;1&lt;/span&gt;% /data
shm                                                                        64M     &lt;span class="m"&gt;0&lt;/span&gt;   64M   &lt;span class="m"&gt;0&lt;/span&gt;% /dev/shm
tmpfs                                                                     &lt;span class="m"&gt;3&lt;/span&gt;.9G   12K  &lt;span class="m"&gt;3&lt;/span&gt;.9G   &lt;span class="m"&gt;1&lt;/span&gt;% /run/secrets/kubernetes.io/serviceaccount
tmpfs                                                                     &lt;span class="m"&gt;3&lt;/span&gt;.9G     &lt;span class="m"&gt;0&lt;/span&gt;  &lt;span class="m"&gt;3&lt;/span&gt;.9G   &lt;span class="m"&gt;0&lt;/span&gt;% /proc/acpi
tmpfs                                                                     &lt;span class="m"&gt;3&lt;/span&gt;.9G     &lt;span class="m"&gt;0&lt;/span&gt;  &lt;span class="m"&gt;3&lt;/span&gt;.9G   &lt;span class="m"&gt;0&lt;/span&gt;% /sys/firmware

&lt;span class="c1"&gt;# list files&lt;/span&gt;
$ ls -l /data
total &lt;span class="m"&gt;24&lt;/span&gt;
-rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;1001&lt;/span&gt; &lt;span class="m"&gt;1001&lt;/span&gt;   &lt;span class="m"&gt;130&lt;/span&gt; May &lt;span class="m"&gt;20&lt;/span&gt; &lt;span class="m"&gt;18&lt;/span&gt;:23 appendonly.aof
-rw-r--r-- &lt;span class="m"&gt;1&lt;/span&gt; &lt;span class="m"&gt;1001&lt;/span&gt; &lt;span class="m"&gt;1001&lt;/span&gt;   &lt;span class="m"&gt;175&lt;/span&gt; May &lt;span class="m"&gt;20&lt;/span&gt; &lt;span class="m"&gt;17&lt;/span&gt;:22 dump.rdb
drwxrws--- &lt;span class="m"&gt;2&lt;/span&gt; root &lt;span class="m"&gt;1001&lt;/span&gt; &lt;span class="m"&gt;16384&lt;/span&gt; May &lt;span class="m"&gt;20&lt;/span&gt; &lt;span class="m"&gt;17&lt;/span&gt;:22 lost+found
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Third, you can copy files or directories from or to a Kubernetes pod using &lt;tt class="docutils literal"&gt;kubectl cp&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;kubectl cp default/redis-master-0:/data/dump.rdb /home/vitaly/Downloads/dump.rdb
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See &lt;tt class="docutils literal"&gt;kubectl cp &lt;span class="pre"&gt;--help&lt;/span&gt;&lt;/tt&gt; for more&amp;nbsp;details.&lt;/p&gt;
</content><category term="Blog"></category><category term="k8s"></category><category term="kubectl"></category><category term="digitalocean"></category></entry><entry><title>Helm stable/redis chart: slave unable to connect to master</title><link href="https://blog.pilosus.org/posts/2019/05/20/helm-stable-redis-slave-crashloopbackoff/" rel="alternate"></link><published>2019-05-20T19:20:00+03:00</published><updated>2019-05-20T19:20:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-05-20:/posts/2019/05/20/helm-stable-redis-slave-crashloopbackoff/</id><summary type="html">&lt;p class="first last"&gt;Things to take care of when installing Helm&amp;#8217;s stable/redis
chart with master-slave topology&amp;nbsp;enabled&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Recently I&amp;#8217;ve tried to install &lt;a class="reference external" href="https://github.com/helm/charts/tree/master/stable/redis"&gt;stable/redis&lt;/a&gt; Helm chart version
8.0.1. I used production-ready values taken from the &lt;a class="reference external" href="https://github.com/helm/charts/blob/master/stable/redis/values-production.yaml"&gt;repo&lt;/a&gt; and
slightly modified for needs. I used enabled by default clusterisation,
but with only one slave node instead of&amp;nbsp;two.&lt;/p&gt;
&lt;p&gt;The release deployed sucessfully, but the slave node kept having
problem with liveness probe that eventually led to a
CrashLoopBackoff. The logs showed that my slave node is &amp;#8220;Unable to
connect to &lt;span class="caps"&gt;MASTER&lt;/span&gt;&amp;#8221;, although I could easily connect to the master from
the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;redis-client&lt;/span&gt;&lt;/tt&gt; node with &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;redis-cli&lt;/span&gt;&lt;/tt&gt;:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ kubectl run --namespace default redis-client --rm --tty -i --restart='Never' \
  --env REDIS_PASSWORD=my-redis-password \
 --image docker.io/bitnami/redis:5.0.5 -- bash

# redis-cli -h redis-master -a my-redis-password
redis-master:6379&amp;gt;
&lt;/pre&gt;
&lt;p&gt;It turned out that a &lt;tt class="docutils literal"&gt;networkPolicy&lt;/tt&gt; section in
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;values-production.yaml&lt;/span&gt;&lt;/tt&gt; was a culprit. &lt;tt class="docutils literal"&gt;networkPolicy.enable&lt;/tt&gt; is
set to &lt;tt class="docutils literal"&gt;true&lt;/tt&gt;, but &lt;tt class="docutils literal"&gt;networkPolicy.allowExternal: true&lt;/tt&gt; is
commented evaluating to &lt;tt class="docutils literal"&gt;false&lt;/tt&gt; by default. That makes redis nodes
only accessible from the pods with a label &lt;tt class="docutils literal"&gt;{{ template
&amp;quot;redis.fullname&amp;quot; . &lt;span class="pre"&gt;}}-client:&lt;/span&gt; &amp;quot;true&amp;quot;&lt;/tt&gt;.&lt;/p&gt;
&lt;p&gt;So make master accessible to slave you&amp;nbsp;either:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;set &lt;tt class="docutils literal"&gt;networkPolicy.enable: false&lt;/tt&gt; to turn off &lt;a class="reference external" href="https://kubernetes.io/docs/tasks/administer-cluster/declare-network-policy/"&gt;NetworkPolicy&lt;/a&gt;,&amp;nbsp;or&lt;/li&gt;
&lt;li&gt;set &lt;tt class="docutils literal"&gt;networkPolicy.allowExternal: true&lt;/tt&gt; (i.e. by commenting it out
in the &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;values-production.yaml&lt;/span&gt;&lt;/tt&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That&amp;#8217;s it. No more failed liveness probes or CrashLoopBackoff. It&amp;nbsp;works.&lt;/p&gt;
&lt;p&gt;&lt;span class="caps"&gt;P.S.&lt;/span&gt; I think that production values example in &lt;tt class="docutils literal"&gt;stable&lt;/tt&gt; should
probably be consistent. For example,
&lt;a class="reference external" href="https://github.com/helm/charts/blob/master/stable/postgresql/values-production.yaml"&gt;stable/postgresql production values file&lt;/a&gt;&amp;nbsp;contains:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;networkPolicy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;enabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;false&lt;/span&gt;
  &lt;span class="nt"&gt;allowExternal&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;while &lt;a class="reference external" href="https://github.com/helm/charts/blob/master/stable/redis/values-production.yaml"&gt;stable/redis production values file&lt;/a&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nt"&gt;networkPolicy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="nt"&gt;enabled&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;true&lt;/span&gt;
  &lt;span class="c1"&gt;#allowExternal: true&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
</content><category term="Blog"></category><category term="k8s"></category><category term="helm"></category><category term="chart"></category><category term="redis"></category></entry><entry><title>Helm Cheat Sheet: Personal Top of the Little Known Commands and Features</title><link href="https://blog.pilosus.org/posts/2019/05/20/helm-cheat-sheet-little-known-commands/" rel="alternate"></link><published>2019-05-20T11:12:00+03:00</published><updated>2019-05-20T15:50:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-05-20:/posts/2019/05/20/helm-cheat-sheet-little-known-commands/</id><summary type="html">&lt;p&gt;Helm is a package manager for Kubernetes. It&amp;#8217;s got an outstanding
&lt;a class="reference external" href="https://helm.sh/"&gt;official documentation&lt;/a&gt; and tons of tutorials on the
internet. Nonetheless Helm has some helpful commands and features that
are easily overlooked when reading the documentation. I won&amp;#8217;t even try
to cover them all, as it&amp;#8217;s quite …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Helm is a package manager for Kubernetes. It&amp;#8217;s got an outstanding
&lt;a class="reference external" href="https://helm.sh/"&gt;official documentation&lt;/a&gt; and tons of tutorials on the
internet. Nonetheless Helm has some helpful commands and features that
are easily overlooked when reading the documentation. I won&amp;#8217;t even try
to cover them all, as it&amp;#8217;s quite subjective what to count as
&amp;#8220;helpful&amp;#8221;. What I will try to do though is to give a direction on how
to find such features by&amp;nbsp;yourself.&lt;/p&gt;
&lt;div class="section" id="cli-help"&gt;
&lt;h2&gt;&lt;span class="caps"&gt;CLI&lt;/span&gt;&amp;nbsp;Help&lt;/h2&gt;
&lt;p&gt;Just like &lt;tt class="docutils literal"&gt;kubectl&lt;/tt&gt; and &lt;a class="reference external" href="https://blog.pilosus.org/posts/2019/05/18/minikube-cheat-sheet/"&gt;minikube&lt;/a&gt; Helm&amp;#8217;s &lt;span class="caps"&gt;CLI&lt;/span&gt; tool follows
the same help patterns for commands and&amp;nbsp;subcommands:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm --help
$ helm get --help
$ helm get values --help
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="shell-completion"&gt;
&lt;h2&gt;Shell&amp;nbsp;Completion&lt;/h2&gt;
&lt;p&gt;Again, just like &lt;tt class="docutils literal"&gt;kubectl&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;minikube&lt;/tt&gt; Helm provides shell
commands completion for &lt;tt class="docutils literal"&gt;bash&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;zsh&lt;/tt&gt;. See more in&amp;nbsp;help:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm completion --help
&lt;/pre&gt;
&lt;p&gt;Completion helps a lot both everyday interaction with Helm and its &lt;span class="caps"&gt;CLI&lt;/span&gt;&amp;nbsp;exploration.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="commands-aliases"&gt;
&lt;h2&gt;Commands&amp;nbsp;Aliases&lt;/h2&gt;
&lt;p&gt;Some Helm commands have aliases. You can see then in the corresponding
section in help. As an example these two commands are the&amp;nbsp;same:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm list
$ helm ls
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="chart-values"&gt;
&lt;h2&gt;Chart&amp;nbsp;Values&lt;/h2&gt;
&lt;p&gt;Helm charts usually get initialized with some default values. It&amp;#8217;s
worth inspect them before&amp;nbsp;installation:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm inspect values stable/postgresql
&lt;/pre&gt;
&lt;p&gt;Sometimes it&amp;#8217;s also very helpful to get values from the deployed
release, both explicitly set by user and taken from the&amp;nbsp;defaults:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm get values --all &amp;lt;your-release-name&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="chart-versions"&gt;
&lt;h2&gt;Chart&amp;nbsp;Versions&lt;/h2&gt;
&lt;p&gt;Every chart must have a &lt;a class="reference external" href="https://helm.sh/docs/charts/#charts-and-versioning"&gt;version number&lt;/a&gt;. Charts are versioned under
version control systems (&lt;span class="caps"&gt;VSC&lt;/span&gt;) and installed from the &lt;a class="reference external" href="https://helm.sh/docs/chart_repository/#the-chart-repository-guide"&gt;chart
repositories&lt;/a&gt;. You can list existing repos&amp;nbsp;with:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm repo list
&lt;/pre&gt;
&lt;p&gt;Don&amp;#8217;t forget to update packages information for your repos&amp;nbsp;with:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm repo update
&lt;/pre&gt;
&lt;p&gt;Sometimes you may want to install specific version of chart. List versions&amp;nbsp;first:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm search --versions stable/postgresql
&lt;/pre&gt;
&lt;p&gt;Now install the chart with a &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--version&lt;/span&gt;&lt;/tt&gt; argument:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm intall --version 3.17.0 stable/postgresql
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="chart-deletion"&gt;
&lt;h2&gt;Chart&amp;nbsp;deletion&lt;/h2&gt;
&lt;p&gt;If you ommit &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--name&lt;/span&gt; &lt;span class="pre"&gt;&amp;lt;your-release-name&amp;gt;&lt;/span&gt;&lt;/tt&gt; argument when doing &lt;tt class="docutils literal"&gt;helm
install&lt;/tt&gt; you get a random release name. Release names are reserved
even after your release is deleted, so that you can do a&amp;nbsp;rollback.&lt;/p&gt;
&lt;p&gt;If you are using a your own release name you can get into trouble when
reinstalling chart with the same name. In order to avoid name clash
delete your release like&amp;nbsp;so:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm delete --purge &amp;lt;your-release-name&amp;gt;
&lt;/pre&gt;
&lt;p&gt;In this case you won&amp;#8217;t be able to do a rollback&amp;nbsp;though.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="emulate-installation"&gt;
&lt;h2&gt;Emulate&amp;nbsp;Installation&lt;/h2&gt;
&lt;p&gt;We&amp;#8217;ve already covered &lt;tt class="docutils literal"&gt;inspect&lt;/tt&gt; a little bit. It allows you to see
chart&amp;#8217;s info, values and a &lt;span class="caps"&gt;README&lt;/span&gt; file. But sometimes you may want to
get dirty in chart&amp;#8217;s guts (actually, I always do as I don&amp;#8217;t really
like the idea of installing something I don&amp;#8217;t understand in my k8s
cluster). In this case you may want to emulate installation with
verbose&amp;nbsp;output:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ helm install --dry-run --debug --version 3.17.0 stable/postgresql
&lt;/pre&gt;
&lt;p&gt;Having chart manifests at your fingertips is a great way to save time
and effort browsing for the source&amp;nbsp;code.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Helm&amp;#8217;s got almost everything needed to start working with it in its
help. It&amp;#8217;s consistent and mimics other k8s &lt;span class="caps"&gt;CLI&lt;/span&gt; tools like &lt;tt class="docutils literal"&gt;kubectl&lt;/tt&gt;
and &lt;tt class="docutils literal"&gt;minikube&lt;/tt&gt;. Take your time to explore the help! I didn&amp;#8217;t really
try to cover everything here. I just scratched the surface with less
known things that you actually could found out by exploring the&amp;nbsp;help.&lt;/p&gt;
&lt;p&gt;I&amp;#8217;m going to update this post as I find new features worth&amp;nbsp;sharing.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="k8s"></category><category term="helm"></category></entry><entry><title>Minikube Cheat Sheet: most helpful commands and features I wish I knew from the start</title><link href="https://blog.pilosus.org/posts/2019/05/18/minikube-cheat-sheet/" rel="alternate"></link><published>2019-05-18T19:00:00+03:00</published><updated>2019-05-18T19:00:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-05-18:/posts/2019/05/18/minikube-cheat-sheet/</id><summary type="html">&lt;p class="first last"&gt;My personal top of Minikube&amp;#8217;s features that can save you&amp;nbsp;time&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Minikube is a tool for running Kubernetes cluster on your local
machine. Recently I&amp;#8217;ve posted about Minikube&amp;#8217;s &lt;a class="reference external" href="https://blog.pilosus.org/posts/2019/05/18/minikube-hight-cpu-usage-linux/"&gt;ugly parts&lt;/a&gt;. Now
it&amp;#8217;s time for the good&amp;nbsp;parts!&lt;/p&gt;
&lt;div class="section" id="disclaimer"&gt;
&lt;h2&gt;Disclaimer&lt;/h2&gt;
&lt;p&gt;At the time of writing I used Minikube version&amp;nbsp;1.0.0&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ minikube version
minikube version: v1.0.0
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It seems that Minikube is still under active development. So some
things may break for your version. You may also want to check every
now and then that you are using the latest version&amp;nbsp;available:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ minikube update-check
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="help"&gt;
&lt;h2&gt;Help&lt;/h2&gt;
&lt;p&gt;Minikube&amp;#8217;s online presence is strange. You can find some mentions in
&lt;a class="reference external" href="https://kubernetes.io/docs/home/"&gt;Kubernetes Documentation&lt;/a&gt;. You can find a bunch of markdown files
with &lt;a class="reference external" href="https://github.com/kubernetes/minikube/blob/master/docs/README.md"&gt;Advanced Topics&lt;/a&gt; in Minikube&amp;#8217;s GitHub repo. And that&amp;#8217;s it about
documentation. But Minikube&amp;#8217;s help is a great source of
knowledge. It&amp;#8217;s consistently written for every command and&amp;nbsp;subcommand:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ minikube --help
$ minikube start --help
$ minikube addons configure --help
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="minikube-shell-completion"&gt;
&lt;h2&gt;Minikube Shell&amp;nbsp;Completion&lt;/h2&gt;
&lt;p&gt;Minikube has a great &lt;span class="caps"&gt;CLI&lt;/span&gt;. But you can&amp;#8217;t really enjoy a &lt;span class="caps"&gt;CLI&lt;/span&gt; without
&lt;a class="reference external" href="https://github.com/scop/bash-completion"&gt;shell commands completion&lt;/a&gt;. That&amp;#8217;s why Minikube supports commands
completion for &lt;tt class="docutils literal"&gt;bash&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;zsh&lt;/tt&gt; shells. Again, everything you need
is in help&amp;nbsp;already:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ minikube completion --help
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="resources"&gt;
&lt;h2&gt;Resources&lt;/h2&gt;
&lt;p&gt;By default you have got 2 &lt;span class="caps"&gt;CPU&lt;/span&gt;, 2048M &lt;span class="caps"&gt;RAM&lt;/span&gt;, 20G disk allocated for your
k8s cluster. It&amp;#8217;s okay for the most cases. Still you may need to tweak
it depending on what are you doing. Use &lt;tt class="docutils literal"&gt;start&lt;/tt&gt; arguments to get
what you&amp;nbsp;want:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ minikube start --cpus 4 --memory 4096 --vm-driver kvm2
&lt;/pre&gt;
&lt;p&gt;By now you&amp;#8217;ve already got used to using &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;--help&lt;/span&gt;&lt;/tt&gt;, haven&amp;#8217;t&amp;nbsp;you?&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="configuration"&gt;
&lt;h2&gt;Configuration&lt;/h2&gt;
&lt;p&gt;If you experiment with your local k8s cluster a lot, deleting it and
starting all over with new settings, you may want to make some
settings permanent. They are saved under
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;~/.minikube/config/config.json&lt;/span&gt;&lt;/tt&gt;. You can edit it manually, but &lt;span class="caps"&gt;CLI&lt;/span&gt;
provides a better&amp;nbsp;alternative:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# get list of settings
$ minikube config view

# set cpus; changes will take effect upon cluster delete and start
$ minikube config set cpus 4
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="services"&gt;
&lt;h2&gt;Services&lt;/h2&gt;
&lt;p&gt;Your Kubernetes &lt;tt class="docutils literal"&gt;Service&lt;/tt&gt; that&amp;#8217;s provisioned to be available outside
of the cluster&amp;#8217;s network can be opened in your default browser from
the command&amp;nbsp;line:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ minikube service &amp;lt;your-service-name&amp;gt;
&lt;/pre&gt;
&lt;p&gt;To see the full list of services&amp;nbsp;do:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ minikube service list
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="monitoring"&gt;
&lt;h2&gt;Monitoring&lt;/h2&gt;
&lt;p&gt;Minikube&amp;#8217;s shipped with a bunch of great addons. You can list them,
configure, enable, disable and open&amp;nbsp;up:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ minikube addons list
$ minikube addons --help
&lt;/pre&gt;
&lt;p&gt;The most helpful addons I use daily to look up cluster&amp;#8217;s status are
&lt;tt class="docutils literal"&gt;dashboard&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;heapster&lt;/tt&gt;. Dashboard is a web &lt;span class="caps"&gt;UI&lt;/span&gt; enabled by
default. It&amp;#8217;s a great tool for monitoring both your pods
(&lt;tt class="docutils literal"&gt;Workloads&lt;/tt&gt; section) and the whole cluster (&lt;tt class="docutils literal"&gt;Cluster&lt;/tt&gt;
section). Fire up you dashboard&amp;nbsp;with:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ minikube dashboard
&lt;/pre&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;Heapster&lt;/tt&gt; is Grafana-based monitoring tool. Enable and open it&amp;nbsp;with:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
$ minikube addons enable heapster
$ minikube addons open heapster
&lt;/pre&gt;
&lt;p&gt;Sign in with &lt;tt class="docutils literal"&gt;admin/admin&lt;/tt&gt; credentials and go over &lt;tt class="docutils literal"&gt;Pods&lt;/tt&gt; or
&lt;tt class="docutils literal"&gt;Cluster&lt;/tt&gt; dashboards for super cool statistics&amp;nbsp;charts!&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="ssh"&gt;
&lt;h2&gt;&lt;span class="caps"&gt;SSH&lt;/span&gt;&lt;/h2&gt;
&lt;p&gt;When working with &lt;a class="reference external" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/"&gt;Persistent Volumes&lt;/a&gt; you may need to do some ops on
your cluster&amp;#8217;s file system. Use secure shell to do&amp;nbsp;it:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# log in `remotely`
$ minikube ssh

# set `docker` user password
&amp;gt; sudo passwd docker
&amp;gt; exit
&lt;/pre&gt;
&lt;p&gt;Now that you have logged in &amp;#8220;remotely&amp;#8221; you can create directories to
mount your Persistent Volume, copy files,&amp;nbsp;etc.:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# copy directory recursively from minikube cluster to the host machine
$ scp -i $(minikube ssh-key) -r docker&amp;#64;$(minikube ip):/mnt/data/ .
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="afterword"&gt;
&lt;h2&gt;Afterword&lt;/h2&gt;
&lt;p&gt;As with every complex piece of software in active development
Minikube&amp;#8217;s experience may be &lt;a class="reference external" href="https://blog.pilosus.org/posts/2019/05/18/minikube-hight-cpu-usage-linux/"&gt;frustrating&lt;/a&gt;. Still
Minikube is a great tool with a bunch of cool features. I wish I&amp;#8217;d
read an overview like this one when I first launched Minikube. Hope it
will help&amp;nbsp;someone.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="k8s"></category><category term="minikube"></category></entry><entry><title>Minikube high CPU usage even with no workload on Linux machine</title><link href="https://blog.pilosus.org/posts/2019/05/18/minikube-hight-cpu-usage-linux/" rel="alternate"></link><published>2019-05-18T11:00:00+03:00</published><updated>2019-05-18T11:00:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-05-18:/posts/2019/05/18/minikube-hight-cpu-usage-linux/</id><summary type="html">&lt;p&gt;Minikube is a tool that allows you to run Kubernetes for local
development. It&amp;#8217;s adviced to run all over the &lt;a class="reference external" href="https://kubernetes.io/docs/setup/minikube/"&gt;k8s documentation&lt;/a&gt;, in
the tech blogs. Still Minikube looks like a piece of software that is
not quite ready for a smooth development experience. At the time of
writing …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Minikube is a tool that allows you to run Kubernetes for local
development. It&amp;#8217;s adviced to run all over the &lt;a class="reference external" href="https://kubernetes.io/docs/setup/minikube/"&gt;k8s documentation&lt;/a&gt;, in
the tech blogs. Still Minikube looks like a piece of software that is
not quite ready for a smooth development experience. At the time of
writing minikube&amp;#8217;s got a bunch of &lt;a class="reference external" href="https://github.com/kubernetes/minikube/issues"&gt;issues&lt;/a&gt;. Some of them are open for
a long time, hardly reproducible and quite frustrating. &lt;span class="caps"&gt;CPU&lt;/span&gt; usage with
no workload to services is one of&amp;nbsp;them.&lt;/p&gt;
&lt;p&gt;Recently I&amp;#8217;ve bumped into a problem when an idle minikube process
consumes up to 100% of &lt;span class="caps"&gt;CPU&lt;/span&gt;. After a while &lt;tt class="docutils literal"&gt;apiserver&lt;/tt&gt; stops
responding making your cluster not really functioning. It turned out
I&amp;#8217;m &lt;a class="reference external" href="https://github.com/kubernetes/minikube/issues/3207"&gt;not alone&lt;/a&gt;. I run minikube on my Lenovo Thinkpad X1 Carbon
machine with 16G &lt;span class="caps"&gt;RAM&lt;/span&gt; and 8 cores (i7 8th gen) on board. I use Ubuntu
18.04 with &lt;tt class="docutils literal"&gt;kvm2&lt;/tt&gt; &lt;span class="caps"&gt;VM&lt;/span&gt; driver. So I found this high &lt;span class="caps"&gt;CPU&lt;/span&gt; consumption as
quite unexpected and annoying. I&amp;#8217;ve solved this problem. But as it
sometimes happens in the software development, I&amp;#8217;m still not sure what
exactly helped. So taking into account some black magic, let&amp;#8217;s see
what witch brew&amp;#8217;s ingredients &lt;em&gt;may&lt;/em&gt;&amp;nbsp;help.&lt;/p&gt;
&lt;div class="section" id="before-you-begin-monitoring"&gt;
&lt;h2&gt;Before you begin:&amp;nbsp;monitoring&lt;/h2&gt;
&lt;p&gt;&lt;span class="dquo"&gt;&amp;#8220;&lt;/span&gt;If you can&amp;#8217;t measure it, you can&amp;#8217;t improve it&amp;#8221;. Before making any
tweaks start measuring &lt;span class="caps"&gt;CPU&lt;/span&gt; usage. Altough &lt;tt class="docutils literal"&gt;top&lt;/tt&gt; tool is cool, it
just cannot beat its successor &lt;tt class="docutils literal"&gt;htop&lt;/tt&gt;. It allows you to tag
processes, filter and sort quickly, see processes and threads in a
flat and a tree&amp;nbsp;modes.&lt;/p&gt;
&lt;a class="reference external image-reference" href="https://blog.pilosus.org/images/htop-minikube.png"&gt;&lt;img alt="htop tool" class="responsive" src="https://blog.pilosus.org/images/htop-minikube.png" /&gt;&lt;/a&gt;
&lt;p&gt;On &lt;span class="caps"&gt;GNU&lt;/span&gt;/Linux you most likely want to track &lt;a class="reference external" href="https://wiki.archlinux.org/index.php/QEMU"&gt;&lt;span class="caps"&gt;QEMU&lt;/span&gt; processes&lt;/a&gt; resource&amp;nbsp;usage.&lt;/p&gt;
&lt;p&gt;Minikube&amp;#8217;s &lt;tt class="docutils literal"&gt;dashboard&lt;/tt&gt; plugin is also a great tool for monitoing
resources &amp;#8212; per pod (Overview section) or for the whole cluster
(Cluster section). To use dashboard, enable the addon and open&amp;nbsp;it:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
minikube addons enable dashboard
minikube dashboard
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="use-recommended-virtual-machine-drivers"&gt;
&lt;h2&gt;Use recommended Virtual Machine&amp;nbsp;drivers&lt;/h2&gt;
&lt;p&gt;Since I&amp;#8217;m on Ubuntu &lt;span class="caps"&gt;GNU&lt;/span&gt;/Linux I went for a &lt;tt class="docutils literal"&gt;kvm2&lt;/tt&gt; driver. Get the
recommended &lt;a class="reference external" href="https://github.com/kubernetes/minikube/blob/master/docs/drivers.md"&gt;&lt;span class="caps"&gt;VM&lt;/span&gt; driver&lt;/a&gt; for your specific&amp;nbsp;platform.&lt;/p&gt;
&lt;p&gt;Follow excellent Arch Linux Wiki &lt;a class="reference external" href="https://wiki.archlinux.org/index.php/KVM"&gt;&lt;span class="caps"&gt;KVM&lt;/span&gt; article&lt;/a&gt; to make sure you have
&lt;strong&gt;hardware and Linux kernel support for &lt;span class="caps"&gt;KVM&lt;/span&gt;&lt;/strong&gt;. You may enable
virtualisation support in your &lt;span class="caps"&gt;BIOS&lt;/span&gt; and/or load &lt;span class="caps"&gt;KVM&lt;/span&gt; kernel modules&amp;nbsp;needed.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="use-latest-os-virtualisation-libraries-qemu-tools-vm-drivers"&gt;
&lt;h2&gt;Use latest &lt;span class="caps"&gt;OS&lt;/span&gt; virtualisation libraries, &lt;span class="caps"&gt;QEMU&lt;/span&gt; tools, &lt;span class="caps"&gt;VM&lt;/span&gt;&amp;nbsp;drivers&lt;/h2&gt;
&lt;p&gt;This is what I believe really fixed my problem. Make sure&amp;nbsp;you:&lt;/p&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;Update your &lt;span class="caps"&gt;OS&lt;/span&gt; package&amp;nbsp;information:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# in my case of Ubuntu 18.04 I use
sudo apt update
&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Install the &lt;strong&gt;latest&lt;/strong&gt; libs and tools (like &lt;tt class="docutils literal"&gt;libvirt&lt;/tt&gt;, &lt;tt class="docutils literal"&gt;qemu&lt;/tt&gt;),
enable &lt;tt class="docutils literal"&gt;systemD&lt;/tt&gt; services needed as per &lt;a class="reference external" href="https://github.com/kubernetes/minikube/blob/master/docs/drivers.md#kvm2-driver"&gt;&lt;span class="caps"&gt;KVM&lt;/span&gt; drivers&amp;nbsp;guide&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Install the &lt;strong&gt;latest&lt;/strong&gt;&amp;nbsp;driver&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="run-minikube-with-correct-vm-drivers-and-resources"&gt;
&lt;h2&gt;Run Minikube with correct &lt;span class="caps"&gt;VM&lt;/span&gt; drivers and&amp;nbsp;resources&lt;/h2&gt;
&lt;p&gt;If you had already run minikube with the default &lt;tt class="docutils literal"&gt;virtualbox&lt;/tt&gt;
drivers, remove your cluster&amp;nbsp;with:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# don't forget ``--p &amp;lt;your-profile-name&amp;gt;``
# if you had started minikube with custom profile name
minikube delete
&lt;/pre&gt;
&lt;p&gt;Make sure you start your new cluster with drivers needed and resources
allocation that meets your services requirements. In my case I used
more &lt;tt class="docutils literal"&gt;memory&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;cpus&lt;/tt&gt; than it&amp;#8217;s set by&amp;nbsp;default:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
minikube start --vm-driver kvm2 --memory 4096 --cpus 4
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="use-only-the-addons-you-really-need"&gt;
&lt;h2&gt;Use only the addons you really&amp;nbsp;need&lt;/h2&gt;
&lt;p&gt;Minikube&amp;#8217;s shipped with a dozen of addons like &lt;tt class="docutils literal"&gt;dashboard&lt;/tt&gt; for web
&lt;span class="caps"&gt;UI&lt;/span&gt; or &lt;tt class="docutils literal"&gt;heapster&lt;/tt&gt; for Grafana-based monitoring. They may be cool and
useful, but don&amp;#8217;t try to enable them all at&amp;nbsp;once.&lt;/p&gt;
&lt;p&gt;In my case enabling &lt;tt class="docutils literal"&gt;efk&lt;/tt&gt; addons has led to a high &lt;span class="caps"&gt;CPU&lt;/span&gt; usage, so
that I have to disable&amp;nbsp;it.&lt;/p&gt;
&lt;p&gt;Make sure you enabled only the addons you really&amp;nbsp;need:&lt;/p&gt;
&lt;pre class="literal-block"&gt;
# get list of addons
minikube addons list

# check for addons in the global config too
# for the case of recreating your cluster
minikube config view
&lt;/pre&gt;
&lt;/div&gt;
&lt;div class="section" id="conclusion"&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Minikube&amp;#8217;s idea is cool. You can really save some money by running k8s
cluster on you laptop instead of setting it up in a cloud service for
testing. But all the abstractions that Kubernetes introduces,
virtualisation with &lt;span class="caps"&gt;KVM&lt;/span&gt; and &lt;span class="caps"&gt;QEMU&lt;/span&gt; on &lt;span class="caps"&gt;GNU&lt;/span&gt;/Linux make Minikube
complex. Minikube&amp;#8217;s niche (a developer&amp;#8217;s local machine) prevents it
from being quickly fixed as, say, cloud production-ready solutions
that earn their owners piles of money. So let&amp;#8217;s hope that magic I&amp;#8217;ve
posted here will work out for you too. I also hope the issue with high
&lt;span class="caps"&gt;CPU&lt;/span&gt; usage will be fixed by someone with proper&amp;nbsp;skills.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="k8s"></category><category term="minikube"></category></entry><entry><title>Python MRO and Mixin Classes</title><link href="https://blog.pilosus.org/posts/2019/05/02/python-mixin/" rel="alternate"></link><published>2019-05-02T13:50:00+03:00</published><updated>2019-05-02T13:50:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-05-02:/posts/2019/05/02/python-mixin/</id><summary type="html">&lt;p class="first last"&gt;Understanding Python&amp;#8217;s Method Resolution Order may be
helpful when using mixin&amp;nbsp;classes&lt;/p&gt;
</summary><content type="html">&lt;p&gt;In practice we don&amp;#8217;t usually think about how Python&amp;#8217;s &lt;span class="caps"&gt;MRO&lt;/span&gt;
works. Complex multiple inheritance legitemately considered to be a
bad thing. Usually we have very straight forward hierarchies like&amp;nbsp;this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;A&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;a&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;42&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;B&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;b&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="mi"&gt;43&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;43&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;42&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;But one application for relatively complex inheritance hierarchies is
&lt;a class="reference external" href="https://en.wikipedia.org/wiki/Mixin"&gt;mixin&lt;/a&gt; classes. We can use the
following so called &lt;em&gt;diamond inheritance&lt;/em&gt; to add some checks to the
method &lt;tt class="docutils literal"&gt;do&lt;/tt&gt; we are interested&amp;nbsp;in.&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Top&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Top class&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Top.do&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Left&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Top&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Left class&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Left.do&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="nb"&gt;isinstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Left.do expected integer values only&amp;#39;&lt;/span&gt;
        &lt;span class="c1"&gt;# We explicitly return parent&amp;#39;s do method.&lt;/span&gt;
        &lt;span class="c1"&gt;# If there was no such return, then Right.do would never be called&lt;/span&gt;
        &lt;span class="c1"&gt;# when Bottom.do() is called&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Right&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Top&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Right class&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Right.do&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Right.do expected positive numbers only&amp;#39;&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Bottom&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Left&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Right&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Bottom class&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Bottom.do&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can instantiate &lt;tt class="docutils literal"&gt;Top&lt;/tt&gt; class when no checks in &lt;tt class="docutils literal"&gt;do&lt;/tt&gt; method
needed, we can use class &lt;tt class="docutils literal"&gt;Left&lt;/tt&gt; when workgin with integers or we can
use &lt;tt class="docutils literal"&gt;Right&lt;/tt&gt; class when working with non-negative numbers. When both
checks are needed though, we use the &lt;tt class="docutils literal"&gt;Bottom&lt;/tt&gt; class.&lt;/p&gt;
&lt;p&gt;The initialization of the &lt;tt class="docutils literal"&gt;Bottom&lt;/tt&gt; class reveals it&amp;#8217;s &lt;span class="caps"&gt;MRO&lt;/span&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;Bottom&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;Bottom&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt;
&lt;span class="nc"&gt;Left&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt;
&lt;span class="nc"&gt;Right&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt;
&lt;span class="nc"&gt;Top&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt;

&lt;span class="nc"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;Bottom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mro&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Bottom&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Left&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Right&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;Top&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;object&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now let&amp;#8217;s see how multiple inheritance&amp;nbsp;works:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Bottom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;
&lt;span class="n"&gt;Left&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;
&lt;span class="n"&gt;Right&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;
&lt;span class="n"&gt;Top&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;10.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Bottom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;
&lt;span class="n"&gt;Left&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;
&lt;span class="o"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="ne"&gt;AssertionError&lt;/span&gt;                            &lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="n"&gt;eceeaaa850f&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="mf"&gt;10.5&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f358c005e4dd&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="mi"&gt;39&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
     &lt;span class="mi"&gt;40&lt;/span&gt;         &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Bottom.do&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;---&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;41&lt;/span&gt;         &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="mi"&gt;42&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f358c005e4dd&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="mi"&gt;14&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
     &lt;span class="mi"&gt;15&lt;/span&gt;         &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Left.do&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;---&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;16&lt;/span&gt;         &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="nb"&gt;isinstance&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;int&lt;/span&gt;&lt;span class="p"&gt;),&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Left.do expected integer values only&amp;#39;&lt;/span&gt;
     &lt;span class="mi"&gt;17&lt;/span&gt;         &lt;span class="c1"&gt;# We explicitly return parent&amp;#39;s do method.&lt;/span&gt;
     &lt;span class="mi"&gt;18&lt;/span&gt;         &lt;span class="c1"&gt;# If there was no such return, then Right.do would never be called&lt;/span&gt;

&lt;span class="ne"&gt;AssertionError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Left&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt; &lt;span class="n"&gt;expected&lt;/span&gt; &lt;span class="n"&gt;integer&lt;/span&gt; &lt;span class="n"&gt;values&lt;/span&gt; &lt;span class="n"&gt;only&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Bottom&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;
&lt;span class="n"&gt;Left&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;
&lt;span class="n"&gt;Right&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;
&lt;span class="o"&gt;---------------------------------------------------------------------------&lt;/span&gt;
&lt;span class="ne"&gt;AssertionError&lt;/span&gt;                            &lt;span class="n"&gt;Traceback&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;most&lt;/span&gt; &lt;span class="n"&gt;recent&lt;/span&gt; &lt;span class="n"&gt;call&lt;/span&gt; &lt;span class="n"&gt;last&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f82b823fc4ec&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;module&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;span class="o"&gt;----&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="n"&gt;b&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;10&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f358c005e4dd&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="mi"&gt;39&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
     &lt;span class="mi"&gt;40&lt;/span&gt;         &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Bottom.do&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;---&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;41&lt;/span&gt;         &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="mi"&gt;42&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f358c005e4dd&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="mi"&gt;18&lt;/span&gt;         &lt;span class="c1"&gt;# If there was no such return, then Right.do would never be called&lt;/span&gt;
     &lt;span class="mi"&gt;19&lt;/span&gt;         &lt;span class="c1"&gt;# when Bottom.do() is called&lt;/span&gt;
&lt;span class="o"&gt;---&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;20&lt;/span&gt;         &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="mi"&gt;21&lt;/span&gt;
     &lt;span class="mi"&gt;22&lt;/span&gt;

&lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;ipython&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="nb"&gt;input&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="n"&gt;f358c005e4dd&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="mi"&gt;28&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
     &lt;span class="mi"&gt;29&lt;/span&gt;         &lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Right.do&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="o"&gt;---&amp;gt;&lt;/span&gt; &lt;span class="mi"&gt;30&lt;/span&gt;         &lt;span class="k"&gt;assert&lt;/span&gt; &lt;span class="n"&gt;value&lt;/span&gt; &lt;span class="o"&gt;&amp;gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;Right.do expected positive numbers only&amp;#39;&lt;/span&gt;
     &lt;span class="mi"&gt;31&lt;/span&gt;         &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;super&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;value&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
     &lt;span class="mi"&gt;32&lt;/span&gt;

&lt;span class="ne"&gt;AssertionError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Right&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;do&lt;/span&gt; &lt;span class="n"&gt;expected&lt;/span&gt; &lt;span class="n"&gt;positive&lt;/span&gt; &lt;span class="n"&gt;numbers&lt;/span&gt; &lt;span class="n"&gt;only&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See more about the inner workings of the &lt;span class="caps"&gt;MRO&lt;/span&gt; in my article about &lt;a class="reference external" href="https://blog.pilosus.org/posts/2019/05/02/python-mro/"&gt;C3
linearisation algorithm&lt;/a&gt;.&lt;/p&gt;
</content><category term="Blog"></category><category term="python"></category><category term="mro"></category><category term="mixin"></category></entry><entry><title>Python Method Resolution Order and C3 linearization algorithm</title><link href="https://blog.pilosus.org/posts/2019/05/02/python-mro/" rel="alternate"></link><published>2019-05-02T12:10:00+03:00</published><updated>2019-05-02T12:10:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-05-02:/posts/2019/05/02/python-mro/</id><summary type="html">&lt;p class="first last"&gt;A naïve implementation of C3 linearization algorithm that
lies under the hood of Python&amp;#8217;s Method Resolution Order
(&lt;span class="caps"&gt;MRO&lt;/span&gt;)&lt;/p&gt;
</summary><content type="html">&lt;p&gt;Method Resolution Order (&lt;span class="caps"&gt;MRO&lt;/span&gt;) is a order in which methods should be
inherited in the case of multiple iheritance. &lt;a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization"&gt;C3 linearization
algorithm&lt;/a&gt; is how &lt;span class="caps"&gt;MRO&lt;/span&gt; works under the hood since &lt;a class="reference external" href="https://www.python.org/download/releases/2.3/mro/"&gt;version 2.3&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a class="reference external" href="https://en.wikipedia.org/wiki/C3_linearization"&gt;Wikipedia&lt;/a&gt; does a great job explaining the algorithm. It can be
reduced to the following&amp;nbsp;steps:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Linearization (i.e. resolution order) is a &lt;em&gt;class itself&lt;/em&gt; and a
&lt;em&gt;merge&lt;/em&gt; of the linearizations of its parents and a list of the
parents&amp;nbsp;itself&lt;/li&gt;
&lt;li&gt;Linearization of the class with no parents equals to the class&amp;nbsp;itself.&lt;/li&gt;
&lt;li&gt;Merge process is done by selecting the first head of the lists
which does not appear in the tail of any of the lists. Where &lt;em&gt;head&lt;/em&gt;
is the first element of the list, and &lt;em&gt;tail&lt;/em&gt; is all but first
elements of the list. The heads are repeatedly selected and added
to the resulting &lt;span class="caps"&gt;MRO&lt;/span&gt; until all the lists are&amp;nbsp;exhausted.&lt;/li&gt;
&lt;li&gt;If a head cannot be selected while not all the lists are exhausted
merge is impossible to compute due to inconsistent orderings of
dependencies in the inheritance hierarchy and no linearization of
the original class&amp;nbsp;exists.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class="figure"&gt;
&lt;img alt="Multiple Inheritance Example" class="responsive" src="https://blog.pilosus.org/images/c3_linearization.png" /&gt;
&lt;p class="caption"&gt;Complex multiple inheritance example, courtesy &lt;a class="reference external" href="https://commons.wikimedia.org/wiki/File:C3_linearization_example.svg"&gt;H2power&lt;/a&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;p&gt;Consider linearization process for a class &lt;tt class="docutils literal"&gt;K1&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;// first, find the linearizations of K1&amp;#39;s parents, L(A), L(B), and L(C),
// and merge them with the parent list [A, B, C]
L(K1) := [K1] + merge(L(A), L(B), L(C), [A, B, C])
// class A is a good candidate for the first merge step, because it only
// appears as the head of the first and last lists
       = [K1] + merge([A, O], [B, O], [C, O], [A, B, C])
// class O is not a good candidate for the next merge step, because it also
// appears in the tails of list 2 and 3; but class B is a good candidate
       = [K1, A] + merge([O], [B, O], [C, O], [B, C])
// class C is a good candidate; class O still appears in the tail of list 3
       = [K1, A, B] + merge([O], [O], [C, O], [C])
// finally, class O is a valid candidate, which also exhausts all remaining lists
       = [K1, A, B, C] + merge([O], [O], [O])
       = [K1, A, B, C, O]
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So at the higher level a naive implementation of the C3 linearization
algorith can be expressed as a simple&amp;nbsp;recursion:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;mro&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
  &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;  Return a list of classes in order corresponding to Python&amp;#39;s MRO.&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

  &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__bases__&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;
  &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;_merge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;mro&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;kls&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;kls&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__bases__&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__bases__&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then &lt;tt class="docutils literal"&gt;_merge&lt;/tt&gt; repeatedly checks if its lists are exhausted and
append appropriate heads to the resulting &lt;span class="caps"&gt;MRO&lt;/span&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;_merge&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;lists&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
  &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Optional&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;]]&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[]&lt;/span&gt;
  &lt;span class="n"&gt;linearizations&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;DependencyList&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;lists&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

  &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
      &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;linearizations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;exhausted&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;result&lt;/span&gt;

      &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;head&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;linearizations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;heads&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;head&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt; &lt;span class="ow"&gt;not&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;linearizations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tails&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;  &lt;span class="c1"&gt;# type: ignore&lt;/span&gt;
              &lt;span class="n"&gt;result&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;append&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
              &lt;span class="n"&gt;linearizations&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;

              &lt;span class="c1"&gt;# Once candidate is found, continue iteration&lt;/span&gt;
              &lt;span class="c1"&gt;# from the first element of the list&lt;/span&gt;
              &lt;span class="k"&gt;break&lt;/span&gt;
      &lt;span class="k"&gt;else&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
          &lt;span class="c1"&gt;# Loop never broke, no linearization could possibly be found&lt;/span&gt;
          &lt;span class="k"&gt;raise&lt;/span&gt; &lt;span class="ne"&gt;ValueError&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;Cannot compute linearization, a cycle found&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In order to hide some lists internals &lt;tt class="docutils literal"&gt;Dependency&lt;/tt&gt; and
&lt;tt class="docutils literal"&gt;DependencyList&lt;/tt&gt; abstractions are&amp;nbsp;used:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;collections&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;deque&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;itertools&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;islice&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;typing&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Tuple&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Optional&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;Dependency&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;deque&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
    &lt;span class="nd"&gt;@property&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;head&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;Optional&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="ne"&gt;IndexError&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;

    &lt;span class="nd"&gt;@property&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;tail&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;islice&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c1"&gt;# type: ignore&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Return islice object, which is suffice for iteration or calling `in`&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;try&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;islice&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__len__&lt;/span&gt;&lt;span class="p"&gt;())&lt;/span&gt;
        &lt;span class="k"&gt;except&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="ne"&gt;ValueError&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="ne"&gt;IndexError&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
            &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;islice&lt;/span&gt;&lt;span class="p"&gt;([],&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;


&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;DependencyList&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;    A class represents list of linearizations (dependencies)&lt;/span&gt;

&lt;span class="sd"&gt;    The last element of DependencyList is a list of parents.&lt;/span&gt;
&lt;span class="sd"&gt;    It&amp;#39;s needed  to the merge process preserves the local&lt;/span&gt;
&lt;span class="sd"&gt;    precedence order of direct parent classes.&lt;/span&gt;
&lt;span class="sd"&gt;    &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__init__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;lists&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Tuple&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;]])&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_lists&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Dependency&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;lists&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__contains__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Return True if any linearization&amp;#39;s tail contains an item&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;any&lt;/span&gt;&lt;span class="p"&gt;([&lt;/span&gt;&lt;span class="n"&gt;item&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;tail&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;l&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_lists&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt;  &lt;span class="c1"&gt;# type: ignore&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__len__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_lists&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;size&lt;/span&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="fm"&gt;__repr__&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_lists&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="fm"&gt;__repr__&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

    &lt;span class="nd"&gt;@property&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;heads&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="n"&gt;List&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;Optional&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;]]:&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;h&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;h&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_lists&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;

    &lt;span class="nd"&gt;@property&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;tails&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;DependencyList&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;  &lt;span class="c1"&gt;# type: ignore&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Return self so that __contains__ could be called&lt;/span&gt;

&lt;span class="sd"&gt;        Used for readability reasons only&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;

    &lt;span class="nd"&gt;@property&lt;/span&gt;
    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;exhausted&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="nb"&gt;bool&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Return True if all elements of the lists are exhausted&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="nb"&gt;all&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="nb"&gt;map&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="k"&gt;lambda&lt;/span&gt; &lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="nb"&gt;len&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;x&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_lists&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;

    &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;remove&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="n"&gt;Optional&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;])&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="bp"&gt;None&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
        &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
&lt;span class="sd"&gt;        Remove an item from the lists&lt;/span&gt;

&lt;span class="sd"&gt;        Once an item removed from heads, the leftmost elements of the tails&lt;/span&gt;
&lt;span class="sd"&gt;        get promoted to become the new heads.&lt;/span&gt;
&lt;span class="sd"&gt;        &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
        &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;in&lt;/span&gt; &lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;_lists&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
            &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt; &lt;span class="ow"&gt;and&lt;/span&gt; &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;head&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;item&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
                &lt;span class="n"&gt;i&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;popleft&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The whole codebase can be found in my &lt;a class="reference external" href="https://github.com/pilosus/c3linear"&gt;c3linear repository&lt;/a&gt;. You can
install it from the source code or via&amp;nbsp;PyPI:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;python setup.py install  &lt;span class="c1"&gt;# from the source code&lt;/span&gt;
pip install c3linear  &lt;span class="c1"&gt;# from the Cheese Shop&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then just import it and check against Python&amp;#8217;s object&amp;#8217;s &lt;tt class="docutils literal"&gt;mro&lt;/tt&gt; method:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;c3linear.mro&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;mro&lt;/span&gt;

&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;A&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;pass&lt;/span&gt;
&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;B&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt; &lt;span class="k"&gt;pass&lt;/span&gt;
&lt;span class="n"&gt;mro&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;mro&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Take a look at the &lt;a class="reference external" href="https://github.com/pilosus/c3linear/blob/master/tests/test_mro.py"&gt;tests&lt;/a&gt; to dive into more complex multiple inheritance&amp;nbsp;examples.&lt;/p&gt;
</content><category term="Blog"></category><category term="python"></category><category term="cpython"></category><category term="mro"></category><category term="algorithms"></category></entry><entry><title>Pelican blog: up and running</title><link href="https://blog.pilosus.org/posts/2019/05/01/pelican-blog-up-and-running/" rel="alternate"></link><published>2019-05-01T11:30:00+03:00</published><updated>2019-05-01T11:30:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-05-01:/posts/2019/05/01/pelican-blog-up-and-running/</id><summary type="html">&lt;p&gt;&lt;a class="reference external" href="https://docs.getpelican.com/en/stable/"&gt;Pelican&lt;/a&gt; is a static site generator written in Python. I use it for
&lt;a class="reference external" href="https://blog.pilosus.org"&gt;my personal blog&lt;/a&gt;. Pelican is easy to install, configure and
customize with themes and plugins. I was able to set up the blog with
my own &lt;a class="reference external" href="https://github.com/pilosus/pilosus-pelican-theme"&gt;custom theme&lt;/a&gt; and an &lt;a class="reference external" href="https://github.com/pilosus/pilosus_pelican_og"&gt;Open Graph plugin&lt;/a&gt; in a few&amp;nbsp;hours …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a class="reference external" href="https://docs.getpelican.com/en/stable/"&gt;Pelican&lt;/a&gt; is a static site generator written in Python. I use it for
&lt;a class="reference external" href="https://blog.pilosus.org"&gt;my personal blog&lt;/a&gt;. Pelican is easy to install, configure and
customize with themes and plugins. I was able to set up the blog with
my own &lt;a class="reference external" href="https://github.com/pilosus/pilosus-pelican-theme"&gt;custom theme&lt;/a&gt; and an &lt;a class="reference external" href="https://github.com/pilosus/pilosus_pelican_og"&gt;Open Graph plugin&lt;/a&gt; in a few&amp;nbsp;hours.&lt;/p&gt;
&lt;p&gt;Before Pelican I also used &lt;a class="reference external" href="https://jekyllrb.com/"&gt;Jekyll&lt;/a&gt; and &lt;a class="reference external" href="http://octopress.org/"&gt;Octopress&lt;/a&gt;. But since my
first language is Python and Ruby ecosystem seems to be in a decline,
I deciced to stick to a framework where I can express myself as
idiomatic as I can. Last but not least, having to write documentation
for Python code with &lt;a class="reference external" href="https://www.sphinx-doc.org/en/master/"&gt;Sphinx&lt;/a&gt; I also got used to &lt;a class="reference external" href="https://docutils.readthedocs.io/en/sphinx-docs/user/rst/quickstart.html"&gt;ReStructuredText&lt;/a&gt;
format, which is supported by Pelican out of the&amp;nbsp;box.&lt;/p&gt;
&lt;p&gt;In this post I&amp;#8217;m not going repeat the Pelican&amp;#8217;s great
documentation. Instead I will focus on the step that allows you&amp;nbsp;to:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;Set up your blog&amp;nbsp;quickly&lt;/li&gt;
&lt;li&gt;Add your own theme to&amp;nbsp;it&lt;/li&gt;
&lt;li&gt;Extend Pelican&amp;#8217;s basic functionality with a&amp;nbsp;plugin&lt;/li&gt;
&lt;li&gt;Automate build and deploy process,&amp;nbsp;and&lt;/li&gt;
&lt;li&gt;Host your static site with &lt;a class="reference external" href="https://pages.github.com/"&gt;GitHub Pages&lt;/a&gt; under your custom&amp;nbsp;domain&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I use Pelican verion 4.0.1, invoke 1.2.0 and ghp-import 0.5.5 in this&amp;nbsp;post.&lt;/p&gt;
&lt;div class="section" id="install-pelican"&gt;
&lt;h2&gt;Install&amp;nbsp;Pelican&lt;/h2&gt;
&lt;p&gt;Personally I use &lt;a class="reference external" href="https://github.com/pyenv/pyenv"&gt;pyenv&lt;/a&gt; for Python version management. I also use
&lt;a class="reference external" href="https://github.com/pyenv/pyenv-virtualenv"&gt;pyenv-virtualenv&lt;/a&gt; plugin to incorporate &lt;tt class="docutils literal"&gt;virtualenv&lt;/tt&gt; into it. So
my workflow for the Python projects that do not require
containerization is the&amp;nbsp;following:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="c1"&gt;# Create directory for the project, cd to it&lt;/span&gt;
$ mkdir my-project &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="nb"&gt;cd&lt;/span&gt; my-project

&lt;span class="c1"&gt;# Set up virtual env with Python version needed&lt;/span&gt;
$ pyenv virtualenv &lt;span class="m"&gt;3&lt;/span&gt;.7.2 venv

&lt;span class="c1"&gt;# Activate virtualenv&lt;/span&gt;
$ pyenv activate venv

&lt;span class="c1"&gt;# Initialize git reposotory, add README and basic .gitignore&lt;/span&gt;
$ git init
$ touch README.md
$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;*~&amp;#39;&lt;/span&gt; &amp;gt; .gitignore
$ git commit -m &lt;span class="s1"&gt;&amp;#39;Initial commit&amp;#39;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now that a repository for your project is ready, install &lt;tt class="docutils literal"&gt;pelican&lt;/tt&gt;
package, fix its version and initialize the&amp;nbsp;app:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ pip install pelican
$ pip freeze &lt;span class="p"&gt;|&lt;/span&gt; grep pelican &amp;gt; requirements.txt
$ git commit -a -m &lt;span class="s1"&gt;&amp;#39;Fix pelican version&amp;#39;&lt;/span&gt;
$ pelican-quickstart
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;All the questions are pretty straightforward. One thing I would advise
though is to confirm that you do want to &lt;strong&gt;automate site generation and
publication&lt;/strong&gt;. This step will create a &lt;tt class="docutils literal"&gt;Makefile&lt;/tt&gt; and invoke&amp;#8217;s
&lt;tt class="docutils literal"&gt;tasks.py&lt;/tt&gt;&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="custom-theme"&gt;
&lt;h2&gt;Custom&amp;nbsp;Theme&lt;/h2&gt;
&lt;p&gt;You can find a ton of Pelican themes in the wild. It&amp;#8217;s so
overwhelmingly huge amount of custom themes that I had just given up
on finding a theme that&amp;#8217;s just right for me. Instead I&amp;#8217;ve build my own
&lt;a class="reference external" href="https://github.com/pilosus/pilosus-pelican-theme"&gt;custom theme&lt;/a&gt;. It&amp;#8217;s responsive, lightweight and clean. For rapid
development I used &lt;a class="reference external" href="http://getskeleton.com/"&gt;Skeleton&lt;/a&gt;, which is a modern &lt;span class="caps"&gt;CSS&lt;/span&gt;&amp;nbsp;boilerplate.&lt;/p&gt;
&lt;p&gt;Although it&amp;#8217;s recommended to install your theme either by copying it
to the Pelican&amp;#8217;s theme path or by creating a symlink, I used &lt;tt class="docutils literal"&gt;git
submodule&lt;/tt&gt; add theme in my blog repo directory. Then I added a path
to the theme under &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;THEME&lt;/span&gt;&lt;/tt&gt; variable in &lt;tt class="docutils literal"&gt;pelicanconf.py&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; my-project
$ git submodule add https://github.com/pilosus/pilosus-pelican-theme.git themes/pilosus-pelican-theme
$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;THEME = &amp;#39;themes/pilosus-pelican-theme&amp;#39;&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; pelicanconf.py
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now my custom theme is versioned and can be easily developed
separately from the blog. The blog may be generated with whatever
theme version I like. I will only need to checkout my submodule to the
version I&amp;nbsp;need.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="plugins"&gt;
&lt;h2&gt;Plugins&lt;/h2&gt;
&lt;p&gt;The first thing I was disappointed in Pelican&amp;#8217;s default theme is a
lack of &lt;a class="reference external" href="http://ogp.me/"&gt;Open Graph&lt;/a&gt; tags. You cannot just add custom metadata to
your content files and use it in the theme. The easiest way to tackle
this problem is &lt;a class="reference external" href="https://docs.getpelican.com/en/stable/plugins.html"&gt;plugins&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I derived my &lt;a class="reference external" href="https://github.com/pilosus/pilosus_pelican_og"&gt;Open Graph plugin&lt;/a&gt; from &lt;a class="reference external" href="https://github.com/whiskyechobravo/pelican-open_graph"&gt;this one&lt;/a&gt; by tweaking the
things I didn&amp;#8217;t like. Say, the original plugin gets &lt;tt class="docutils literal"&gt;og:image&lt;/tt&gt; by
parsing images from the rendered &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;HTML&lt;/span&gt;&lt;/tt&gt; content, which is strange,
ineffective and will certainly produce low-quality results in many
cases. That&amp;#8217;s why I decided to develop my own&amp;nbsp;plugin.&lt;/p&gt;
&lt;p&gt;Again, I find installing plugin as a &lt;tt class="docutils literal"&gt;git submodule&lt;/tt&gt; a great way to
keep the code versioned, site deployments deterministic and
maintanence predictable and&amp;nbsp;easy.&lt;/p&gt;
&lt;p&gt;I place plugins under &lt;tt class="docutils literal"&gt;plugins&lt;/tt&gt; directory in my blog repo, then
define &lt;tt class="docutils literal"&gt;PLUGIN_PATHS&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;PLUGINS&lt;/span&gt;&lt;/tt&gt; variables in the&amp;nbsp;settings:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; my-project
$ git submodule add https://github.com/pilosus/pilosus_pelican_og plugins/pilosus_pelican_og
$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;PLUGIN_PATHS = [&amp;#39;plugins&amp;#39;]&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; pelicanconf.py
$ &lt;span class="nb"&gt;echo&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;PLUGINS = [&amp;#39;pilosus_pelican_og&amp;#39;,]&amp;quot;&lt;/span&gt; &amp;gt;&amp;gt; pelicanconf.py
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="build-and-deploy-automation"&gt;
&lt;h2&gt;Build and Deploy&amp;nbsp;Automation&lt;/h2&gt;
&lt;p&gt;Our goal is to generate a static site, that can be pushed and served
by the GitHub Pages with custom domain support. To make this process
less tedious some automation is&amp;nbsp;essential.&lt;/p&gt;
&lt;p&gt;If you have followed an advice in the &lt;a class="reference internal" href="#install-pelican"&gt;Install Pelican&lt;/a&gt; section to
opt for automation, then you&amp;#8217;ve got &lt;tt class="docutils literal"&gt;tasks.py&lt;/tt&gt; and &lt;tt class="docutils literal"&gt;Makefile&lt;/tt&gt;
installed. Although I do use &lt;tt class="docutils literal"&gt;Makefile&lt;/tt&gt; in some of my projects I
decided to give &lt;tt class="docutils literal"&gt;invoke&lt;/tt&gt; a try. So the following recipe is all about
&lt;tt class="docutils literal"&gt;tasks.py&lt;/tt&gt; that &lt;tt class="docutils literal"&gt;invoke&lt;/tt&gt; uses.&lt;/p&gt;
&lt;p&gt;We need to install &lt;tt class="docutils literal"&gt;invoke&lt;/tt&gt; package in your virtualenv, as well as
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;ghp-import&lt;/span&gt;&lt;/tt&gt; for GitHub Page push. Don&amp;#8217;t forget to fix all
dependencies in the &lt;tt class="docutils literal"&gt;requirements.txt&lt;/tt&gt;:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;$ &lt;span class="nb"&gt;cd&lt;/span&gt; my-project
$ pyenv activate venv
$ pip install invoke
$ pip freeze &lt;span class="p"&gt;|&lt;/span&gt; grep invoke &amp;gt;&amp;gt; requirements.txt
$ pip install ghp-import
$ pip freeze &lt;span class="p"&gt;|&lt;/span&gt; grep invoke &amp;gt;&amp;gt; requirements.txt
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now that we have all dependencies installed let&amp;#8217;s add a new task for
GitHub Pages&amp;nbsp;deployment:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@task&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;github&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Publish to GitHub Pages&amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;preview&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;cname&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
  &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;ghp-import -b {github_pages_branch} &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;-m {commit_message} &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;{deploy_path} -p&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;CONFIG&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
  &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;git push --force {github_repo} &amp;#39;&lt;/span&gt;
        &lt;span class="s1"&gt;&amp;#39;{github_pages_branch}:{github_repo_target_branch}&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;CONFIG&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;preview(c)&lt;/tt&gt; is a predefined &lt;tt class="docutils literal"&gt;invoke&lt;/tt&gt; task that generates static
files for production environment (i.e. with &lt;tt class="docutils literal"&gt;publishconf.py&lt;/tt&gt;
settings&amp;nbsp;file).&lt;/p&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;cname(c)&lt;/tt&gt; is a task that generates a file called &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;CNAME&lt;/span&gt;&lt;/tt&gt; with a
hostname of your custom&amp;nbsp;domain:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nd"&gt;@task&lt;/span&gt;
&lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;cname&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
  &lt;span class="sd"&gt;&amp;quot;&amp;quot;&amp;quot;Generate CNAME file with you custom domain name&lt;/span&gt;

&lt;span class="sd"&gt;  Its used in GitHub Pages. Otherwise custom domain name setting&lt;/span&gt;
&lt;span class="sd"&gt;  gets reset on each git push to GH Page repo.&lt;/span&gt;
&lt;span class="sd"&gt;  &amp;quot;&amp;quot;&amp;quot;&lt;/span&gt;
  &lt;span class="n"&gt;c&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;run&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;echo {custom_domain_name} &amp;gt; {deploy_path}/CNAME&amp;#39;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;**&lt;/span&gt;&lt;span class="n"&gt;CONFIG&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;cname&lt;/tt&gt; docstring says it all. You really need this&amp;nbsp;file!&lt;/p&gt;
&lt;p&gt;&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;ghp-import&lt;/span&gt;&lt;/tt&gt; command checks out you output directory (i.e. the one
used for generated static files) to the GitHub Pages branch of your
project. Then &lt;tt class="docutils literal"&gt;git push &lt;span class="pre"&gt;--force&lt;/span&gt;&lt;/tt&gt; pushes this branch to the
repository for static GitHub Pages (it should be named as
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;your-github-login.github.io&lt;/span&gt;&lt;/tt&gt;).&lt;/p&gt;
&lt;p&gt;Configuration you use throughout the invoke&amp;#8217;s &lt;tt class="docutils literal"&gt;tasks.py&lt;/tt&gt; may look like&amp;nbsp;this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;CONFIG&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
    &lt;span class="c1"&gt;# Local path to content directory&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;content_path&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;content&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="c1"&gt;# Local path configuration (can be absolute or relative to tasks.py)&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;deploy_path&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;output&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="c1"&gt;# Github Pages configuration&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;github_pages_branch&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;gh-pages&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;github_repo_target_branch&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;master&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;github_repo&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;git@github.com:pilosus/pilosus.github.io.git&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;custom_domain_name&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;blog.pilosus.org&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;commit_message&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;&amp;#39;Publish site on {}&amp;#39;&amp;quot;&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;format&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;datetime&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;date&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;today&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;isoformat&lt;/span&gt;&lt;span class="p"&gt;()),&lt;/span&gt;
    &lt;span class="c1"&gt;# Port for `serve`&lt;/span&gt;
    &lt;span class="s1"&gt;&amp;#39;port&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="mi"&gt;8080&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Keeping two separate repositories (one for the blog and another one
for the static files it generates) allows you to make your blog
repository private. You can keep some secrets or some code you don&amp;#8217;t
want to share. But still your generated files will be accessible to
others in the second&amp;nbsp;repository.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="pelican-workflow"&gt;
&lt;h2&gt;Pelican&amp;nbsp;Workflow&lt;/h2&gt;
&lt;p&gt;Now that we have defined all the &lt;tt class="docutils literal"&gt;invoke&lt;/tt&gt; tasks, we can discuss
Pelican&amp;#8217;s workflow. It&amp;#8217;s very straight&amp;nbsp;forward:&lt;/p&gt;
&lt;ol class="arabic simple"&gt;
&lt;li&gt;Write your &lt;a class="reference external" href="https://docs.getpelican.com/en/stable/content.html"&gt;content&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Rebuild the site with development settings: &lt;tt class="docutils literal"&gt;invoke rebuild&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Serve website at localhost: &lt;tt class="docutils literal"&gt;invoke serve&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Go to &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;http://localhost:8000&lt;/span&gt;&lt;/tt&gt; check if everything is&amp;nbsp;okay&lt;/li&gt;
&lt;li&gt;Clean output directory: &lt;tt class="docutils literal"&gt;invoke clean&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Build website with production settings and upload to the GitHub Pages: &lt;tt class="docutils literal"&gt;invoke github&lt;/tt&gt;&lt;/li&gt;
&lt;li&gt;Enjoy your&amp;nbsp;blog!&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="custom-domain"&gt;
&lt;h2&gt;Custom&amp;nbsp;Domain&lt;/h2&gt;
&lt;p&gt;By now you already have your static site live on
&lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;your-github-login.github.io&lt;/span&gt;&lt;/tt&gt;. In order to serve it under custom
domain you need to add a &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;CNAME&lt;/span&gt;&lt;/tt&gt; record in your &lt;tt class="docutils literal"&gt;&lt;span class="caps"&gt;DNS&lt;/span&gt;&lt;/tt&gt; and set
custom domain in the settings of &lt;tt class="docutils literal"&gt;&lt;span class="pre"&gt;your-github-login.github.io&lt;/span&gt;&lt;/tt&gt;
repository on GitHub. &lt;tt class="docutils literal"&gt;Enforce &lt;span class="caps"&gt;HTTPS&lt;/span&gt;&lt;/tt&gt; is also a great option to turn&amp;nbsp;on.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="what-s-next"&gt;
&lt;h2&gt;What&amp;#8217;s&amp;nbsp;next?&lt;/h2&gt;
&lt;p&gt;Althouh the set up and automation I described here are pretty
convenient, one thing could still be improved. We could use &lt;a class="reference external" href="https://travis-ci.org/"&gt;Travis &lt;span class="caps"&gt;CI&lt;/span&gt;&lt;/a&gt;
or &lt;a class="reference external" href="https://circleci.com/"&gt;Circle &lt;span class="caps"&gt;CI&lt;/span&gt;&lt;/a&gt; to generate static files and push to the proper
repository. &lt;span class="caps"&gt;CI&lt;/span&gt; pipeline should be triggered on each push to the remote
blog&amp;nbsp;repository.&lt;/p&gt;
&lt;/div&gt;
</content><category term="Blog"></category><category term="pelican"></category><category term="blog"></category><category term="python"></category></entry><entry><title>Method vs. Class Method Quirks in Python 3</title><link href="https://blog.pilosus.org/posts/2019/04/29/bound-class-method/" rel="alternate"></link><published>2019-04-29T17:30:00+03:00</published><updated>2019-04-29T17:30:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-04-29:/posts/2019/04/29/bound-class-method/</id><summary type="html">&lt;p class="first last"&gt;A little example of how bound/unbound methods behave in Python&amp;nbsp;3&lt;/p&gt;
</summary><content type="html">&lt;p&gt;A code snippet in Python 3 below has been discussed recently on the&amp;nbsp;internet:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;A&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;method&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="k"&gt;pass&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="nc"&gt;B&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="nd"&gt;@classmethod&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;     &lt;span class="k"&gt;def&lt;/span&gt; &lt;span class="nf"&gt;method&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="p"&gt;):&lt;/span&gt;
   &lt;span class="o"&gt;...&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;         &lt;span class="k"&gt;pass&lt;/span&gt;


&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;2&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;3&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The question is why &lt;tt class="docutils literal"&gt;A.method&lt;/tt&gt; returns the same object on each call
while &lt;tt class="docutils literal"&gt;B.method&lt;/tt&gt; returns the new&amp;nbsp;one?&lt;/p&gt;
&lt;p&gt;Let&amp;#8217;s explore first what &lt;tt class="docutils literal"&gt;A.method&lt;/tt&gt; really&amp;nbsp;is:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;4&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;function&lt;/span&gt; &lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;self&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;5&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;function&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;6&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;inspect&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;inspect&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ismethod&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;7&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Essentially, what that means is that &lt;tt class="docutils literal"&gt;A.method&lt;/tt&gt; is a &lt;em&gt;function&lt;/em&gt;,
i.e. &lt;tt class="docutils literal"&gt;unbound method&lt;/tt&gt; of the &lt;tt class="docutils literal"&gt;class A&lt;/tt&gt;. A great way to check if a
method is indeed unbound is to check if its function object and a
class instance&amp;nbsp;exist:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="nb"&gt;hasattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__func__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;13&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="nb"&gt;hasattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__self__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;14&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;See Python documentation for more details, specifically an &lt;a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#index-32"&gt;instance
method&lt;/a&gt; subsection of the &lt;tt class="docutils literal"&gt;Data model&lt;/tt&gt; section.&lt;/p&gt;
&lt;p&gt;On the other hand, &lt;tt class="docutils literal"&gt;B.method&lt;/tt&gt; is a &lt;tt class="docutils literal"&gt;class method&lt;/tt&gt;. It returns an
&lt;em&gt;instance of the bound method object&lt;/em&gt;. Let&amp;#8217;s check&amp;nbsp;it:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;15&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;bound&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="n"&gt;of&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="k"&gt;class&lt;/span&gt; &lt;span class="err"&gt;&amp;#39;&lt;/span&gt;&lt;span class="nc"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="sa"&gt;B&lt;/span&gt;&lt;span class="s1"&gt;&amp;#39;&amp;gt;&amp;gt;&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="nb"&gt;type&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;16&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;method&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;inspect&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;ismethod&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;17&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="nb"&gt;hasattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__func__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;18&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="nb"&gt;hasattr&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s1"&gt;&amp;#39;__self__&amp;#39;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;19&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__self__&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;20&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="bp"&gt;True&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="vm"&gt;__func__&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;21&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt;&lt;span class="n"&gt;function&lt;/span&gt; &lt;span class="n"&gt;__main__&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="bp"&gt;cls&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="o"&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That means on each &lt;tt class="docutils literal"&gt;B.method&lt;/tt&gt; invocation a new object is
created. You can achieve the same behaviour with &lt;tt class="docutils literal"&gt;A.method&lt;/tt&gt; once the
method gets&amp;nbsp;bound:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;22&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;23&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;140613204502216&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;24&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;140613210350280&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="nb"&gt;id&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;25&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="mi"&gt;140613209057096&lt;/span&gt;

&lt;span class="n"&gt;In&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt; &lt;span class="ow"&gt;is&lt;/span&gt; &lt;span class="n"&gt;a&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;method&lt;/span&gt;
&lt;span class="n"&gt;Out&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mi"&gt;26&lt;/span&gt;&lt;span class="p"&gt;]:&lt;/span&gt; &lt;span class="bp"&gt;False&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Again, every time you call &lt;tt class="docutils literal"&gt;a.method&lt;/tt&gt; a new bound method object is&amp;nbsp;created.&lt;/p&gt;
&lt;p&gt;The example above doesn&amp;#8217;t apply to Python 2.7 though. It seems that
Python 2.7 had different implementation, so that &lt;tt class="docutils literal"&gt;A.method&lt;/tt&gt; would
return different objects every time it&amp;#8217;s&amp;nbsp;called.&lt;/p&gt;
</content><category term="Blog"></category><category term="python"></category><category term="cpython"></category></entry><entry><title>Let’s get started!</title><link href="https://blog.pilosus.org/posts/2019/04/28/intro/" rel="alternate"></link><published>2019-04-28T16:30:00+03:00</published><updated>2019-04-28T16:45:00+03:00</updated><author><name>Vitaly Samigullin</name></author><id>tag:blog.pilosus.org,2019-04-28:/posts/2019/04/28/intro/</id><summary type="html">&lt;p&gt;My name is Vitaly R. Samigullin. I&amp;#8217;m a software developer, a team
leader, and a person who enjoys thinking about how and why things work
the way they work. Having lived in Austria and Spain, I got some
interesting immigration experience. I&amp;#8217;ve also started a small
publishing company …&lt;/p&gt;</summary><content type="html">&lt;p&gt;My name is Vitaly R. Samigullin. I&amp;#8217;m a software developer, a team
leader, and a person who enjoys thinking about how and why things work
the way they work. Having lived in Austria and Spain, I got some
interesting immigration experience. I&amp;#8217;ve also started a small
publishing company in 2008, which is run by my family&amp;nbsp;now.&lt;/p&gt;
&lt;p&gt;Over the last few years I&amp;#8217;ve written a bunch of texts in social media
that some people confessed to find though-provoking and
interesting. As social networks tend to disurupt the openness of their
services and the internet, making user&amp;#8217;s content ephemeral and hardly
discoverable, I decided to start a personal blog. It&amp;#8217;s somewhat
2000-ish. But still a great tool to categorize and back up texts that
I consider worth&amp;nbsp;saving.&lt;/p&gt;
&lt;img alt="Vitaly" class="align-left" src="https://blog.pilosus.org/images/me.jpg" style="height: 150px;" /&gt;
&lt;p&gt;Although stand-alone blogs never get even a fraction of attention that
social networks get, a blog post is still unbeatable when it comes
&amp;#8220;slow reading&amp;#8221;. It&amp;#8217;s an essential component of learning, actually for
both readers and an author. So I except the blogging to become a tool
to learn new things through explaining them to&amp;nbsp;others.&lt;/p&gt;
&lt;p&gt;I don&amp;#8217;t really want to limit this blog to technology and software
development. I enjoy a variety of topics ranging from arts and
architecture to literature and&amp;nbsp;philosophy.&lt;/p&gt;
&lt;p&gt;I speak a couple of natural languages. With Russian as my first
language, I&amp;#8217;m also fluent in English and have B1-level German. As
every unilingual person I would consider my mother tongue a
one-size-fits-all thing. Still there are some fields (like computer
science, kayaking or playing bass guitar) that easier to think about
in language you used to learn that field. I wouldn&amp;#8217;t even try to
translate my texts to all the languages I&amp;#8217;d mentioned. Rather I will
stick to the language that fits best to each post. So expect here a
Babylon-flavoured&amp;nbsp;mélange.&lt;/p&gt;
&lt;p&gt;How often will I post new posts? Will you find the blog completely
abandoned in a couple of years? I have no idea. But I do know that
quality is over&amp;nbsp;quantity.&lt;/p&gt;
&lt;p&gt;So let&amp;#8217;s get&amp;nbsp;started!&lt;/p&gt;
</content><category term="Blog"></category><category term="intro"></category></entry></feed>